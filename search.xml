<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>2022操作系统实验</title>
      <link href="/2022/09/30/2022-cao-zuo-xi-tong-shi-yan/"/>
      <url>/2022/09/30/2022-cao-zuo-xi-tong-shi-yan/</url>
      
        <content type="html"><![CDATA[<h1 id="作业1"><a href="#作业1" class="headerlink" title="作业1"></a>作业1</h1><h2 id="1"><a href="#1" class="headerlink" title="1"></a>1</h2><p>之前就玩过虚拟机，所以直接vscode上ssh远程连接来写</p><p>没有或者不用vscode的话也可以直接在虚拟机上vim来写，只不过黑框框可能用得比较难受</p><h2 id="2-sleep"><a href="#2-sleep" class="headerlink" title="2 sleep"></a>2 sleep</h2><figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">"kernel/types.h"</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">"kernel/stat.h"</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">"user/user.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc,<span class="type">char</span> **argv)</span></span>{</span><br><span class="line">    <span class="keyword">if</span>(argc&lt;<span class="number">2</span>){</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"usage: sleep &lt;ticks&gt;\n"</span>);</span><br><span class="line">    }</span><br><span class="line">    <span class="built_in">sleep</span>(<span class="built_in">atoi</span>(argv[<span class="number">1</span>]));</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><h2 id="3-pingpong"><a href="#3-pingpong" class="headerlink" title="3 pingpong"></a>3 pingpong</h2><p>单开一个管道的话，有可能我刚写进去就被自己读到了</p><p>所以开两个来进行操作</p><figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">"kernel/types.h"</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">"kernel/stat.h"</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">"user/user.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">signed</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc,<span class="type">char</span> **argv)</span></span>{</span><br><span class="line">    <span class="type">int</span> pp2c[<span class="number">2</span>],pc2p[<span class="number">2</span>];</span><br><span class="line">    <span class="built_in">pipe</span>(pp2c);</span><br><span class="line">    <span class="built_in">pipe</span>(pc2p);</span><br><span class="line">    <span class="keyword">if</span>(fork()==<span class="number">0</span>){</span><br><span class="line">        <span class="type">char</span> buf;</span><br><span class="line">        <span class="built_in">read</span>(pp2c[<span class="number">0</span>],&amp;buf,<span class="number">1</span>);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"%d: received ping\n"</span>,<span class="built_in">getpid</span>());</span><br><span class="line">        <span class="built_in">write</span>(pc2p[<span class="number">1</span>],&amp;buf,<span class="number">1</span>);</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">else</span>{</span><br><span class="line">        <span class="built_in">write</span>(pp2c[<span class="number">1</span>], <span class="string">"!"</span>,<span class="number">1</span>);</span><br><span class="line">        <span class="type">char</span> buf;</span><br><span class="line">        <span class="built_in">read</span>(pc2p[<span class="number">0</span>], &amp;buf,<span class="number">1</span>);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"%d: received pong\n"</span>,<span class="built_in">getpid</span>());</span><br><span class="line">        <span class="built_in">wait</span>(<span class="number">0</span>);</span><br><span class="line">    }</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">}</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure><img src="https://img-blog.csdnimg.cn/ba35e0ed159146c2bb59d502f2d4bdd1.png" alt="在这里插入图片描述" style="zoom:200%;"><h2 id="4-prime"><a href="#4-prime" class="headerlink" title="4 prime"></a>4 prime</h2><p>先写一个线性筛对比跑出来的结果</p><p>main塞完全部数字后塞入-1，如果读到-1就exit</p><figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">"kernel/types.h"</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">"kernel/stat.h"</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">"user/user.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N=<span class="number">36</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> N 36</span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> a[N],n,st[N];</span><br><span class="line"><span class="type">int</span> id=<span class="number">1</span>;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">prime</span><span class="params">()</span></span>{</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">2</span>;i&lt;N;i++){</span><br><span class="line">        <span class="keyword">if</span>(!st[i])a[++n]=i;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">1</span>;a[j]*i&lt;=N;j++){</span><br><span class="line">            st[a[j]*i]=<span class="number">1</span>;</span><br><span class="line">            <span class="keyword">if</span>(i%a[j]==<span class="number">0</span>)<span class="keyword">break</span>;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">dfs</span><span class="params">(<span class="type">int</span> l[<span class="number">2</span>])</span></span>{</span><br><span class="line">    <span class="type">int</span> p;</span><br><span class="line">    <span class="built_in">read</span>(l[<span class="number">0</span>],&amp;p,<span class="keyword">sizeof</span> p);</span><br><span class="line">    <span class="keyword">if</span>(p==<span class="number">-1</span>)<span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"NO.%d prime is %d\n"</span>,id++,p);</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> r[<span class="number">2</span>];</span><br><span class="line">    <span class="built_in">pipe</span>(r);</span><br><span class="line">    <span class="keyword">if</span>(fork()==<span class="number">0</span>){</span><br><span class="line">        <span class="built_in">close</span>(l[<span class="number">0</span>]);</span><br><span class="line">        <span class="built_in">close</span>(r[<span class="number">1</span>]);</span><br><span class="line">        <span class="built_in">dfs</span>(r);</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">else</span>{</span><br><span class="line">        <span class="built_in">close</span>(r[<span class="number">0</span>]);</span><br><span class="line">        <span class="type">int</span> buf;</span><br><span class="line">        <span class="keyword">while</span>(<span class="built_in">read</span>(l[<span class="number">0</span>],&amp;buf,<span class="built_in">sizeof</span> (buf))&amp;&amp;id&lt;n){</span><br><span class="line">            <span class="keyword">if</span>(buf%p==<span class="number">0</span>)<span class="keyword">continue</span>;</span><br><span class="line">            <span class="built_in">write</span>(r[<span class="number">1</span>],&amp;buf,<span class="built_in">sizeof</span> (buf));</span><br><span class="line">        }</span><br><span class="line">        <span class="built_in">write</span>(r[<span class="number">1</span>],&amp;buf,<span class="keyword">sizeof</span> buf);</span><br><span class="line">        <span class="built_in">close</span>(l[<span class="number">0</span>]);</span><br><span class="line">        <span class="built_in">wait</span>(<span class="number">0</span>);</span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">signed</span> <span class="title">main</span><span class="params">()</span></span>{</span><br><span class="line">    <span class="built_in">prime</span>();</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;i++)<span class="built_in">printf</span>(<span class="string">"NO.%d :%d\n"</span>,i,a[i]);</span><br><span class="line">    <span class="comment">// puts("");</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"-----------------------------------\n"</span>);</span><br><span class="line">    <span class="type">int</span> input_pipe[<span class="number">2</span>];</span><br><span class="line">    <span class="built_in">pipe</span>(input_pipe);</span><br><span class="line">    <span class="keyword">if</span>(fork()==<span class="number">0</span>){</span><br><span class="line">        <span class="built_in">close</span>(input_pipe[<span class="number">1</span>]);</span><br><span class="line">        <span class="built_in">dfs</span>(input_pipe);</span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">else</span>{</span><br><span class="line">        <span class="built_in">close</span>(input_pipe[<span class="number">0</span>]);</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">2</span>;i&lt;=<span class="number">35</span>;i++){</span><br><span class="line">            <span class="built_in">write</span>(input_pipe[<span class="number">1</span>],&amp;i,<span class="built_in">sizeof</span>(i));</span><br><span class="line">        }</span><br><span class="line">        <span class="comment">// write(input_pipe[1],-1,sizeof (-1));</span></span><br><span class="line">        <span class="type">int</span> x=<span class="number">-1</span>;</span><br><span class="line">        <span class="built_in">write</span>(input_pipe[<span class="number">1</span>],&amp;x,<span class="built_in">sizeof</span> (x));</span><br><span class="line">    }</span><br><span class="line">    <span class="built_in">wait</span>(<span class="number">0</span>);</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><img src="https://img-blog.csdnimg.cn/86bb812647cf47b78a43f9c66d38467f.png" alt="在这里插入图片描述" style="zoom:200%;"><h2 id="5-总结"><a href="#5-总结" class="headerlink" title="5 总结"></a>5 总结</h2><p>这段时间ccpc预选赛和icpc预选赛所以很晚才开始写，不过之前在acwing上写过小项目所以对vim很熟悉（虽然很久很久没用过了）</p><p>在朋友的推荐下尝试了vscode来操作，确实更快而且更人性化</p><h1 id="作业2"><a href="#作业2" class="headerlink" title="作业2"></a>作业2</h1>]]></content>
      
      
      <categories>
          
          <category> 操作系统 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>2022 ICPC网络预选赛1</title>
      <link href="/2022/09/30/2022-icpc-wang-luo-yu-xuan-sai-1/"/>
      <url>/2022/09/30/2022-icpc-wang-luo-yu-xuan-sai-1/</url>
      
        <content type="html"><![CDATA[<h1 id="2022-ICPC网络预选赛1"><a href="#2022-ICPC网络预选赛1" class="headerlink" title="2022 ICPC网络预选赛1"></a>2022 ICPC网络预选赛1</h1><p><img src="https://img-blog.csdnimg.cn/9e86f103621a4de79533cc5ad410285d.png" alt="在这里插入图片描述"></p><h2 id="A"><a href="#A" class="headerlink" title="A"></a>A</h2><p>最难的一点就是没有处理环形后效性</p><p>比如询问L=1R=9 -&gt;111000111应该是长度为6的连续一段1,贡献为6/2=3而不是2+2=4</p><p>做法就是预处理L右边最近的0的下标x，预处理R左边最近的0的下标y，然后把一段区间分成三份求解，中间就直接贡献sum[y]-sum[x-1]</p><p>然后把左边和右边连续的1加起来除于2</p><p>做法1，dp处理前缀和贡献</p><figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N=<span class="number">1e6</span>+<span class="number">10</span>;</span><br><span class="line"><span class="type">char</span> s[N];</span><br><span class="line"><span class="type">int</span> n,m,sum[N],L[N],R[N];</span><br><span class="line"><span class="type">int</span> f[N],l,r;</span><br><span class="line"><span class="function"><span class="type">signed</span> <span class="title">main</span><span class="params">()</span></span>{</span><br><span class="line">    ios::<span class="built_in">sync_with_stdio</span>(<span class="number">0</span>);cin.<span class="built_in">tie</span>(<span class="number">0</span>);cout.<span class="built_in">tie</span>(<span class="number">0</span>);</span><br><span class="line">    cin&gt;&gt;n&gt;&gt;m&gt;&gt;s+<span class="number">1</span>;</span><br><span class="line">    <span class="type">int</span> cnt=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;i++){</span><br><span class="line">        <span class="keyword">if</span>(s[i]==<span class="string">'1'</span>)cnt++;</span><br><span class="line">        <span class="keyword">else</span> cnt=<span class="number">0</span>;</span><br><span class="line">        f[i]=f[i-cnt<span class="number">-1</span>]+(cnt+<span class="number">1</span>)/<span class="number">2</span>;</span><br><span class="line">    }</span><br><span class="line">    L[<span class="number">0</span>]=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;i++){</span><br><span class="line">        <span class="keyword">if</span>(s[i]==<span class="string">'1'</span>)L[i]=L[i<span class="number">-1</span>];</span><br><span class="line">        <span class="keyword">else</span> L[i]=i;</span><br><span class="line">    }</span><br><span class="line">    R[n+<span class="number">1</span>]=n+<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=n;i&gt;=<span class="number">1</span>;i--){</span><br><span class="line">        <span class="keyword">if</span>(s[i]==<span class="string">'1'</span>)R[i]=R[i+<span class="number">1</span>];</span><br><span class="line">        <span class="keyword">else</span> R[i]=i;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">while</span>(m--){</span><br><span class="line">        cin&gt;&gt;l&gt;&gt;r;</span><br><span class="line">        <span class="type">int</span> len=r-l+<span class="number">1</span>;</span><br><span class="line">        <span class="type">int</span> cnt1=r-L[r]+R[l]-l;</span><br><span class="line">        <span class="type">int</span> t=f[L[r]]-f[R[l]<span class="number">-1</span>]+(cnt1+<span class="number">1</span>)/<span class="number">2</span>;</span><br><span class="line">        cout&lt;&lt;<span class="built_in">max</span>(<span class="number">0</span>,len/<span class="number">3</span>-t)&lt;&lt;<span class="string">'\n'</span>;</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure><p>做法2，对一段连续的1采取贡献差分，也就是+1+0+1+0+1+0，然后前缀和</p><p>这样可以保证奇数的时候上取整，偶数下取整</p><figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N=<span class="number">1e6</span>+<span class="number">10</span>;</span><br><span class="line"><span class="type">char</span> s[N];</span><br><span class="line"><span class="type">int</span> n,m,sum[N],L[N],R[N];</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">cal</span><span class="params">(<span class="type">int</span> l,<span class="type">int</span> r)</span></span>{</span><br><span class="line">    <span class="type">int</span> ll=R[l];</span><br><span class="line">    <span class="type">int</span> rr=L[r];</span><br><span class="line">    <span class="keyword">if</span>(ll&gt;=rr)<span class="keyword">return</span> (r-l+<span class="number">1</span>)/<span class="number">2</span>;</span><br><span class="line">    <span class="type">int</span> len1=(r-rr)+(ll-l);</span><br><span class="line">    <span class="keyword">return</span> sum[rr]-sum[ll<span class="number">-1</span>]+(len1+<span class="number">1</span>)/<span class="number">2</span>;</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="type">signed</span> <span class="title">main</span><span class="params">()</span></span>{</span><br><span class="line">    ios::<span class="built_in">sync_with_stdio</span>(<span class="number">0</span>);cin.<span class="built_in">tie</span>(<span class="number">0</span>);cout.<span class="built_in">tie</span>(<span class="number">0</span>);</span><br><span class="line">    cin&gt;&gt;n&gt;&gt;m&gt;&gt;s+<span class="number">1</span>;</span><br><span class="line">    <span class="comment">// for(int i=1;i&lt;=n;i++){</span></span><br><span class="line">    <span class="comment">//     if(s[i]=='1'&amp;&amp;s[i-1]!='1')sum[i]=1;</span></span><br><span class="line">    <span class="comment">//     sum[i]+=sum[i-1];</span></span><br><span class="line">    <span class="comment">// }</span></span><br><span class="line">    <span class="type">int</span> last=<span class="number">-1</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n ; i ++ ) </span><br><span class="line">    {</span><br><span class="line">        <span class="keyword">if</span>(s[i] == <span class="string">'1'</span>)</span><br><span class="line">        {</span><br><span class="line">            <span class="keyword">if</span>(last != i - <span class="number">1</span>) sum[i] = <span class="number">1</span>, last = i;</span><br><span class="line">            <span class="keyword">else</span> last = <span class="number">-1</span>;</span><br><span class="line">        }</span><br><span class="line">        sum[i] += sum[i - <span class="number">1</span>];</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;i++){</span><br><span class="line">        <span class="keyword">if</span>(s[i]==<span class="string">'0'</span>)L[i]=i;</span><br><span class="line">        <span class="keyword">else</span> L[i]=L[i<span class="number">-1</span>];</span><br><span class="line">    }</span><br><span class="line">    R[n+<span class="number">1</span>]=n+<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=n;i&gt;=<span class="number">1</span>;i--){</span><br><span class="line">        <span class="keyword">if</span>(s[i]==<span class="string">'0'</span>)R[i]=i;</span><br><span class="line">        <span class="keyword">else</span> R[i]=R[i+<span class="number">1</span>];</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">while</span>(m--){</span><br><span class="line">        <span class="type">int</span> l,r;</span><br><span class="line">        cin&gt;&gt;l&gt;&gt;r;</span><br><span class="line">        <span class="type">int</span> len=r-l+<span class="number">1</span>;</span><br><span class="line">        <span class="type">int</span> t=<span class="built_in">cal</span>(l,r);</span><br><span class="line">        cout&lt;&lt;<span class="built_in">max</span>(<span class="number">0</span>,len/<span class="number">3</span>-t)&lt;&lt;<span class="string">'\n'</span>;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><h2 id="B"><a href="#B" class="headerlink" title="B"></a>B</h2><p>先预处理我要选x个tower的状态，pushback进vector里面</p><p>开一个优先队列对一个个时间片，先拿出来，t=t+a[i]，然后放进去</p><p>dfs爆搜</p><figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N=<span class="number">16</span>,M=(<span class="number">1</span>&lt;&lt;N)+<span class="number">10</span>;</span><br><span class="line"><span class="type">int</span> n,a[N],b[N],ans=<span class="number">1e9</span>;</span><br><span class="line">vector&lt;<span class="type">int</span>&gt;v[M];</span><br><span class="line"><span class="keyword">typedef</span> pair&lt;<span class="type">int</span>,<span class="type">int</span>&gt;PII;</span><br><span class="line">priority_queue&lt;PII,vector&lt;PII&gt;,greater&lt;PII&gt;&gt;q;</span><br><span class="line"><span class="meta">#<span class="keyword">define</span> t first</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> u second</span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">cal</span><span class="params">(<span class="type">int</span> x)</span></span>{</span><br><span class="line">    <span class="type">int</span> ans=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;n;i++)ans+=x&gt;&gt;i&amp;<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">return</span> ans;</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">dfs</span><span class="params">(<span class="type">int</span> s,<span class="type">int</span> T)</span></span>{</span><br><span class="line">    <span class="keyword">if</span>(s+<span class="number">1</span>==<span class="number">1</span>&lt;&lt;n)<span class="keyword">return</span> T;</span><br><span class="line">    <span class="type">int</span> sum=<span class="number">0</span>;</span><br><span class="line">    T=q.<span class="built_in">top</span>().t;</span><br><span class="line">    <span class="keyword">while</span>(q.<span class="built_in">size</span>()&amp;&amp;q.<span class="built_in">top</span>().t==T){</span><br><span class="line">        <span class="type">int</span> u=q.<span class="built_in">top</span>().u;</span><br><span class="line">        <span class="type">int</span> t=q.<span class="built_in">top</span>().t;</span><br><span class="line">        sum+=b[u];</span><br><span class="line">        q.<span class="built_in">pop</span>();</span><br><span class="line">        q.<span class="built_in">push</span>({T+a[u],u});</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">if</span>(sum+<span class="built_in">cal</span>(s)&gt;=n)<span class="keyword">return</span> T;</span><br><span class="line">    <span class="type">int</span> ans=<span class="number">1e9</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">auto</span> x:v[sum]){</span><br><span class="line">        <span class="keyword">if</span>(x&amp;s)<span class="keyword">continue</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;n;i++){</span><br><span class="line">            <span class="keyword">if</span>(x&gt;&gt;i&amp;<span class="number">1</span>)q.<span class="built_in">push</span>({a[i]+T,i});</span><br><span class="line">        }</span><br><span class="line">        ans=<span class="built_in">min</span>(ans,<span class="built_in">dfs</span>(s|x,T));</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> ans;</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="type">signed</span> <span class="title">main</span><span class="params">()</span></span>{</span><br><span class="line">    cin&gt;&gt;n;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;<span class="number">1</span>&lt;&lt;n;i++){</span><br><span class="line">        v[<span class="built_in">cal</span>(i)].<span class="built_in">push_back</span>(i);</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;n;i++)cin&gt;&gt;a[i]&gt;&gt;b[i];</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;n;i++){</span><br><span class="line">        <span class="keyword">while</span>(q.<span class="built_in">size</span>())q.<span class="built_in">pop</span>();</span><br><span class="line">        q.<span class="built_in">push</span>({a[i],i});</span><br><span class="line">        ans=<span class="built_in">min</span>(ans,<span class="built_in">dfs</span>(<span class="number">1</span>&lt;&lt;i,<span class="number">0</span>));</span><br><span class="line">    }</span><br><span class="line">    cout&lt;&lt;ans;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><h2 id="C"><a href="#C" class="headerlink" title="C"></a>C</h2><p>结论题，去理解题意，感受一下为什么</p><p>没有特判n==1wa了一发，没有清空度数数组wa了一发</p><h2 id="D"><a href="#D" class="headerlink" title="D"></a>D</h2><p>我写的爆搜要剪很多枝才能刚好冲过去,vp的时候一直超时，改完就一发a了</p><p>而且代码很丑</p><p>说白了就是枚举长度len，枚举后缀零个数x，然后放一个1去挡，然后最前面也是一个1，dfs爆搜放y-2个1的情况，对询问二分</p><figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line">set&lt;<span class="type">int</span>&gt;S;</span><br><span class="line"><span class="type">int</span> T,l,r,len;</span><br><span class="line"><span class="type">int</span> a[<span class="number">31</span>];</span><br><span class="line"><span class="comment">// vector&lt;int&gt;ans;</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">dfs</span><span class="params">(<span class="type">int</span> l,<span class="type">int</span> r,<span class="type">int</span> y)</span></span>{</span><br><span class="line">    <span class="keyword">if</span>(l&gt;r){</span><br><span class="line">        <span class="keyword">if</span>(y==<span class="number">0</span>){</span><br><span class="line">            <span class="type">int</span> x=<span class="number">0</span>;</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;len;i++)x+=a[i]&lt;&lt;i;</span><br><span class="line">            S.<span class="built_in">insert</span>(x);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">return</span>;</span><br><span class="line">    }</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span>(y==<span class="number">0</span>){<span class="built_in">dfs</span>(r+<span class="number">1</span>,r,y);<span class="keyword">return</span>;}</span><br><span class="line">    <span class="keyword">if</span>(y==r-l+<span class="number">1</span>){</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=l;i&lt;=r;i++)a[i]=<span class="number">1</span>;</span><br><span class="line">        <span class="built_in">dfs</span>(r+<span class="number">1</span>,r,<span class="number">0</span>);</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=l;i&lt;=r;i++)a[i]=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">if</span>(y&gt;r-l+<span class="number">1</span>)<span class="keyword">return</span>;</span><br><span class="line">    <span class="keyword">if</span>(y)a[l]=<span class="number">1</span>,<span class="built_in">dfs</span>(l+<span class="number">1</span>,r,y<span class="number">-1</span>);</span><br><span class="line">    a[l]=<span class="number">0</span>,<span class="built_in">dfs</span>(l+<span class="number">1</span>,r,y);</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="type">signed</span> <span class="title">main</span><span class="params">()</span></span>{</span><br><span class="line">    ios::<span class="built_in">sync_with_stdio</span>(<span class="number">0</span>);cin.<span class="built_in">tie</span>(<span class="number">0</span>);cout.<span class="built_in">tie</span>(<span class="number">0</span>);</span><br><span class="line">    S.<span class="built_in">insert</span>(<span class="number">2</span>);</span><br><span class="line">    <span class="keyword">for</span>(len=<span class="number">4</span>;len&lt;=<span class="number">30</span>;len++){</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;len;i++)a[i]=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> x=<span class="number">2</span>;x&lt;=len/<span class="number">2</span>;x++){</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;x;i++)a[i]=<span class="number">0</span>;</span><br><span class="line">            a[x]=<span class="number">1</span>;</span><br><span class="line">            a[len<span class="number">-1</span>]=<span class="number">1</span>;</span><br><span class="line">            <span class="type">int</span> y=x<span class="number">-2</span>;<span class="comment">//要放y个1</span></span><br><span class="line">            <span class="built_in">dfs</span>(x+<span class="number">1</span>,len<span class="number">-2</span>,y);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    cin&gt;&gt;T;</span><br><span class="line">    <span class="keyword">while</span>(T--){</span><br><span class="line">        cin&gt;&gt;l&gt;&gt;r;</span><br><span class="line">        <span class="keyword">auto</span> it=S.<span class="built_in">lower_bound</span>(l);</span><br><span class="line">        <span class="keyword">if</span>(it==S.<span class="built_in">end</span>()||*it&gt;r)cout&lt;&lt;<span class="string">"-1"</span>&lt;&lt;<span class="string">'\n'</span>;</span><br><span class="line">        <span class="keyword">else</span> cout&lt;&lt;*it&lt;&lt;<span class="string">'\n'</span>;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>看到有个人写了个很优美的折半搜索</p><figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line">set&lt;<span class="type">int</span>&gt;S;</span><br><span class="line"><span class="type">int</span> T,l,r,len;</span><br><span class="line"><span class="type">int</span> a[<span class="number">31</span>];</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">dfs</span><span class="params">(<span class="type">int</span> x,<span class="type">int</span> cnt,<span class="type">int</span> p)</span></span>{</span><br><span class="line">    <span class="keyword">if</span>(cnt==<span class="number">0</span>){</span><br><span class="line">        <span class="keyword">if</span>(x&lt;=<span class="number">1e9</span>)S.<span class="built_in">insert</span>(x);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">if</span>(p==<span class="number">30</span>)<span class="keyword">return</span>;</span><br><span class="line">    <span class="built_in">dfs</span>(x|<span class="number">1</span>&lt;&lt;p,cnt<span class="number">-1</span>,p+<span class="number">1</span>);</span><br><span class="line">    <span class="built_in">dfs</span>(x,cnt,p+<span class="number">1</span>);</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="type">signed</span> <span class="title">main</span><span class="params">()</span></span>{</span><br><span class="line">    ios::<span class="built_in">sync_with_stdio</span>(<span class="number">0</span>);cin.<span class="built_in">tie</span>(<span class="number">0</span>);cout.<span class="built_in">tie</span>(<span class="number">0</span>);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=<span class="number">16</span>;i++)<span class="built_in">dfs</span>(<span class="number">1</span>&lt;&lt;i,i<span class="number">-1</span>,i+<span class="number">1</span>);</span><br><span class="line">    cin&gt;&gt;T;</span><br><span class="line">    <span class="keyword">while</span>(T--){</span><br><span class="line">        cin&gt;&gt;l&gt;&gt;r;</span><br><span class="line">        <span class="keyword">auto</span> it=S.<span class="built_in">lower_bound</span>(l);</span><br><span class="line">        <span class="keyword">if</span>(it==S.<span class="built_in">end</span>()||*it&gt;r)cout&lt;&lt;<span class="string">"-1"</span>&lt;&lt;<span class="string">'\n'</span>;</span><br><span class="line">        <span class="keyword">else</span> cout&lt;&lt;*it&lt;&lt;<span class="string">'\n'</span>;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><h2 id="G"><a href="#G" class="headerlink" title="G"></a>G</h2><p>没读题</p><p>感觉读懂硬搞能写</p><figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> rep(i, a, b) for(int i = (a); i &lt; (b); i++)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> _for(i, a, b) for(int i = (a); i &lt;= (b); i++)</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">typedef</span> <span class="type">long</span> <span class="type">long</span> ll;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N = <span class="number">110</span>;</span><br><span class="line">ll dp[<span class="number">6</span>][<span class="number">55</span>][<span class="number">35</span>][<span class="number">27</span>][<span class="number">22</span>], k[<span class="number">5</span>], x[<span class="number">5</span>], s[N];</span><br><span class="line"><span class="type">int</span> n, T;</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>{ </span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">"%d%d"</span>, &amp;n, &amp;T);</span><br><span class="line">    _for(i, <span class="number">1</span>, <span class="number">4</span>)</span><br><span class="line">    {</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">"%lld"</span>, &amp;x[i]);</span><br><span class="line">        k[i] = k[i - <span class="number">1</span>] + x[i];</span><br><span class="line">    }</span><br><span class="line">    _for(i, <span class="number">1</span>, n)</span><br><span class="line">    {</span><br><span class="line">        ll x; <span class="built_in">scanf</span>(<span class="string">"%lld"</span>, &amp;x);</span><br><span class="line">        s[i] = s[i - <span class="number">1</span>] + x;</span><br><span class="line">    }</span><br><span class="line"> </span><br><span class="line">    ll ans = <span class="number">0</span>;</span><br><span class="line">    _for(i, <span class="number">1</span>, n)</span><br><span class="line">        _for(p1, <span class="number">0</span>, n / <span class="number">2</span> + <span class="number">1</span>)</span><br><span class="line">             _for(p2, <span class="number">0</span>, n / <span class="number">3</span> + <span class="number">1</span>)</span><br><span class="line">                _for(p3, <span class="number">0</span>, n / <span class="number">4</span> + <span class="number">1</span>)</span><br><span class="line">                    _for(p4, <span class="number">0</span>, n / <span class="number">5</span> + <span class="number">1</span>)</span><br><span class="line">                    {</span><br><span class="line">                        <span class="keyword">if</span>(p1 * k[<span class="number">1</span>] + p2 * k[<span class="number">2</span>] + p3 * k[<span class="number">3</span>] + p4 * k[<span class="number">4</span>] &gt; T) <span class="keyword">break</span>;</span><br><span class="line"> </span><br><span class="line">                        ll res = dp[(i - <span class="number">1</span> + <span class="number">6</span>) % <span class="number">6</span>][p1][p2][p3][p4];</span><br><span class="line">                        <span class="keyword">if</span>(p1 - <span class="number">1</span> &gt;= <span class="number">0</span> &amp;&amp; i - <span class="number">2</span> &gt;= <span class="number">-1</span>) res = <span class="built_in">max</span>(res, dp[(i - <span class="number">2</span> + <span class="number">6</span>) % <span class="number">6</span>][p1 - <span class="number">1</span>][p2][p3][p4] + s[i] - s[i - <span class="number">1</span>]);</span><br><span class="line">                        <span class="keyword">if</span>(p2 - <span class="number">1</span> &gt;= <span class="number">0</span> &amp;&amp; i - <span class="number">3</span> &gt;= <span class="number">-1</span>) res = <span class="built_in">max</span>(res, dp[(i - <span class="number">3</span> + <span class="number">6</span>) % <span class="number">6</span>][p1][p2 - <span class="number">1</span>][p3][p4] + s[i] - s[i - <span class="number">2</span>]);</span><br><span class="line">                        <span class="keyword">if</span>(p3 - <span class="number">1</span> &gt;= <span class="number">0</span> &amp;&amp; i - <span class="number">4</span> &gt;= <span class="number">-1</span>) res = <span class="built_in">max</span>(res, dp[(i - <span class="number">4</span> + <span class="number">6</span>) % <span class="number">6</span>][p1][p2][p3 - <span class="number">1</span>][p4] + s[i] - s[i - <span class="number">3</span>]);</span><br><span class="line">                        <span class="keyword">if</span>(p4 - <span class="number">1</span> &gt;= <span class="number">0</span> &amp;&amp; i - <span class="number">5</span> &gt;= <span class="number">-1</span>) res = <span class="built_in">max</span>(res, dp[(i - <span class="number">5</span> + <span class="number">6</span>) % <span class="number">6</span>][p1][p2][p3][p4 - <span class="number">1</span>] + s[i] - s[i - <span class="number">4</span>]);</span><br><span class="line"> </span><br><span class="line">                        dp[i % <span class="number">6</span>][p1][p2][p3][p4] = res;</span><br><span class="line">                        <span class="keyword">if</span>(i == n) ans = <span class="built_in">max</span>(ans, dp[i % <span class="number">6</span>][p1][p2][p3][p4]);</span><br><span class="line">                    }</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"%lld\n"</span>, ans);</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><h2 id="H"><a href="#H" class="headerlink" title="H"></a>H</h2><p>赛时沛桐过的，写个递归就好了，如果紧张的话很大概率写不好</p><figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="keyword">define</span> int long long</span></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> mod=<span class="number">20220911</span>;</span><br><span class="line"><span class="type">int</span> ans;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">dfs</span><span class="params">()</span></span>{</span><br><span class="line">    <span class="type">int</span> ans=<span class="number">0</span>;</span><br><span class="line">    string s;</span><br><span class="line">    <span class="keyword">while</span>(cin&gt;&gt;s&amp;&amp;s!=<span class="string">"for"</span>){</span><br><span class="line">        <span class="keyword">if</span>(s[<span class="number">0</span>]==<span class="string">'l'</span>)ans++;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(s[<span class="number">0</span>]==<span class="string">'r'</span>)ans+=<span class="built_in">dfs</span>();</span><br><span class="line">    }</span><br><span class="line">    <span class="type">int</span> x;</span><br><span class="line">    cin&gt;&gt;x;</span><br><span class="line">    <span class="keyword">return</span> x*ans%mod;</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="type">signed</span> <span class="title">main</span><span class="params">()</span></span>{</span><br><span class="line">    ios::<span class="built_in">sync_with_stdio</span>(<span class="number">0</span>);cin.<span class="built_in">tie</span>(<span class="number">0</span>);cout.<span class="built_in">tie</span>(<span class="number">0</span>);</span><br><span class="line">    string s;</span><br><span class="line">    <span class="keyword">while</span>(cin&gt;&gt;s&amp;&amp;s!=<span class="string">"fin"</span>){</span><br><span class="line">        <span class="keyword">if</span>(s[<span class="number">0</span>]==<span class="string">'l'</span>)ans++;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(s[<span class="number">0</span>]==<span class="string">'r'</span>)ans+=<span class="built_in">dfs</span>();</span><br><span class="line">        ans%=mod;</span><br><span class="line">    }</span><br><span class="line">    cout&lt;&lt;ans;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><h2 id="J"><a href="#J" class="headerlink" title="J"></a>J</h2><p>非常好的期望题</p><p>根据样例猜构造方式，需要刷题量足够多足够敏感</p><p>设第一个为A，然后想到错位相消就很快了</p><p>记得特判算出来的A不合法的情况和超出范围的情况</p><figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> int long long</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">int</span> x,y,s,A,a,b,n,m;</span><br><span class="line"><span class="function"><span class="type">signed</span> <span class="title">main</span><span class="params">()</span></span>{</span><br><span class="line">    cin&gt;&gt;x&gt;&gt;y;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">2</span>;i&lt;x;i++)s+=i;</span><br><span class="line">    <span class="keyword">for</span>(m=<span class="number">2</span>;;m++){</span><br><span class="line">        n=m-x+<span class="number">3</span>;</span><br><span class="line">        <span class="keyword">if</span>(n&lt;=<span class="number">1</span>||n&gt;m)<span class="keyword">continue</span>;</span><br><span class="line">        a=m*y-n*x+x-s;</span><br><span class="line">        b=m-s-n*x+x;</span><br><span class="line">        <span class="type">int</span> d=__gcd(a,b);</span><br><span class="line">        a/=d;</span><br><span class="line">        b/=d;</span><br><span class="line">        <span class="keyword">if</span>(a*b&lt;=<span class="number">0</span>||a&gt;b)<span class="keyword">continue</span>;</span><br><span class="line">        <span class="keyword">if</span>(a&gt;<span class="number">10000</span>||b&gt;<span class="number">10000</span>)<span class="keyword">continue</span>;</span><br><span class="line">        cout&lt;&lt;a&lt;&lt;<span class="string">" "</span>&lt;&lt;b&lt;&lt;<span class="string">'\n'</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=m;i&gt;=n;i--)cout&lt;&lt;<span class="number">1</span>&lt;&lt;<span class="string">" "</span>&lt;&lt;i&lt;&lt;<span class="string">'\n'</span>;</span><br><span class="line">        cout&lt;&lt;<span class="string">"1 1"</span>&lt;&lt;<span class="string">'\n'</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><h2 id="L"><a href="#L" class="headerlink" title="L"></a>L</h2><p>赛时无法解决操作的前缀限制关系，即app，ppa会对应不同的方案，然后就不会了</p><p>结果发现题解是预处理了一个限制数组</p><p>，理解不是特别困难但就是想不到</p><figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N=<span class="number">5e5</span>+<span class="number">10</span>;</span><br><span class="line"><span class="type">int</span> f[N][<span class="number">30</span>],vis[<span class="number">30</span>],dont[<span class="number">30</span>][<span class="number">30</span>],n,m;</span><br><span class="line"><span class="type">char</span> a[N],b[N];</span><br><span class="line"><span class="function"><span class="type">signed</span> <span class="title">main</span><span class="params">()</span></span>{</span><br><span class="line">    ios::<span class="built_in">sync_with_stdio</span>(<span class="number">0</span>);cin.<span class="built_in">tie</span>(<span class="number">0</span>);cout.<span class="built_in">tie</span>(<span class="number">0</span>);</span><br><span class="line">    cin&gt;&gt;a+<span class="number">1</span>&gt;&gt;b+<span class="number">1</span>;</span><br><span class="line">    n=<span class="built_in">strlen</span>(a+<span class="number">1</span>);</span><br><span class="line">    m=<span class="built_in">strlen</span>(b+<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=m;i++){</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">0</span>;j&lt;<span class="number">26</span>;j++){</span><br><span class="line">            <span class="keyword">if</span>(vis[j])dont[j][b[i]-<span class="string">'a'</span>]=<span class="number">1</span>;</span><br><span class="line">        }</span><br><span class="line">        vis[b[i]-<span class="string">'a'</span>]=<span class="number">1</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;i++)f[i][a[i]-<span class="string">'a'</span>]=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;i++){</span><br><span class="line">        <span class="type">int</span> x=a[i]-<span class="string">'a'</span>;</span><br><span class="line">        <span class="keyword">if</span>(!vis[x]){</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">0</span>;j&lt;<span class="number">26</span>;j++)f[i][j]=f[i<span class="number">-1</span>][j]+<span class="number">1</span>;</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">else</span>{</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">0</span>;j&lt;<span class="number">26</span>;j++){</span><br><span class="line">                f[i][j]=<span class="built_in">max</span>(f[i][j],f[i<span class="number">-1</span>][j]);</span><br><span class="line">                <span class="keyword">if</span>(dont[j][x])<span class="keyword">continue</span>;</span><br><span class="line">                f[i][x]=<span class="built_in">max</span>(f[i][x],f[i<span class="number">-1</span>][j]+<span class="number">1</span>);</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="type">int</span> ans=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">0</span>;j&lt;<span class="number">26</span>;j++)ans=<span class="built_in">max</span>(ans,f[n][j]);</span><br><span class="line">    cout&lt;&lt;ans;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>感觉区域赛的dp还是非常考验大抽象级别的思维量，非常的灵活</p><p>比较有特点的是去年威海站的打砖块，某div2F题red and black</p><p>acwing宝藏和昨晚的cf#281 E题</p>]]></content>
      
      
      <categories>
          
          <category> ICPC </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 训练 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>2022国庆acm刷题训练</title>
      <link href="/2022/09/30/2022-guo-qing-acm-shua-ti-xun-lian/"/>
      <url>/2022/09/30/2022-guo-qing-acm-shua-ti-xun-lian/</url>
      
        <content type="html"><![CDATA[<h1 id="预期题单"><a href="#预期题单" class="headerlink" title="预期题单"></a>预期题单</h1><ul><li><a href="https://www.zhihu.com/column/c_1553475105409449984">题单1</a></li><li><a href="https://zhuanlan.zhihu.com/p/464001560">题单2</a></li><li>edu</li><li>arc</li><li>abc</li></ul><h2 id="9月30号"><a href="#9月30号" class="headerlink" title="9月30号"></a>9月30号</h2><h3 id="Codeforces-Beta-Round-19-D"><a href="#Codeforces-Beta-Round-19-D" class="headerlink" title="Codeforces Beta Round #19 D"></a><a href="https://codeforces.com/contest/19/problem/D">Codeforces Beta Round #19 D</a></h3><p>数组离散化unique的时候是伪删除会把重复元素放到数组后面<br>这道题采取树套树的思想，线段树套一个set</p><figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N=<span class="number">4e5</span>+<span class="number">10</span>;</span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ls u&lt;&lt;1</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> rs u&lt;&lt;1|1</span></span><br><span class="line"><span class="keyword">typedef</span> pair&lt;<span class="type">int</span>,<span class="type">int</span>&gt;PII;</span><br><span class="line"><span class="type">int</span> T,x,y,cnt,a[N],b[N],s[N*<span class="number">4</span>];</span><br><span class="line">string op;</span><br><span class="line">set&lt;<span class="type">int</span>&gt;S[N*<span class="number">4</span>];</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Query</span>{</span><br><span class="line">    string op;</span><br><span class="line">    <span class="type">int</span> x,y;</span><br><span class="line">}Q[N];</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">pushup</span><span class="params">(<span class="type">int</span> u)</span></span>{s[u]=<span class="built_in">max</span>(s[ls],s[rs]);}</span><br><span class="line"><span class="type">int</span> len;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">modify</span><span class="params">(<span class="type">int</span> u,<span class="type">int</span> x,<span class="type">int</span> y,<span class="type">int</span> op=<span class="number">1</span>,<span class="type">int</span> l=<span class="number">0</span>,<span class="type">int</span> r=len)</span></span>{</span><br><span class="line">    <span class="keyword">if</span>(l==r){</span><br><span class="line">        <span class="keyword">if</span>(op==<span class="number">1</span>)S[u].<span class="built_in">insert</span>(y);</span><br><span class="line">        <span class="keyword">else</span> S[u].<span class="built_in">erase</span>(y);</span><br><span class="line">        <span class="keyword">if</span>(S[u].<span class="built_in">size</span>()==<span class="number">0</span>)s[u]=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">else</span> s[u]=*(--S[u].<span class="built_in">end</span>());</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="type">int</span> mid=l+r&gt;&gt;<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">if</span>(x&lt;=mid)<span class="built_in">modify</span>(ls,x,y,op,l,mid);</span><br><span class="line">    <span class="keyword">else</span> <span class="built_in">modify</span>(rs,x,y,op,mid+<span class="number">1</span>,r);</span><br><span class="line">    <span class="built_in">pushup</span>(u);</span><br><span class="line">}</span><br><span class="line"><span class="keyword">auto</span> p=<span class="built_in">make_pair</span>(<span class="number">-1</span>,<span class="number">-1</span>);</span><br><span class="line"><span class="function">PII <span class="title">q</span><span class="params">(<span class="type">int</span> u,<span class="type">int</span> x,<span class="type">int</span> y,<span class="type">int</span> l=<span class="number">0</span>,<span class="type">int</span> r=len)</span></span>{</span><br><span class="line">    <span class="keyword">if</span>(r&lt;x)<span class="keyword">return</span> p;</span><br><span class="line">    <span class="keyword">if</span>(s[u]&lt;y)<span class="keyword">return</span> p;</span><br><span class="line">    <span class="keyword">if</span>(l==r)<span class="keyword">return</span> <span class="built_in">make_pair</span>(l,*S[u].<span class="built_in">lower_bound</span>(y));</span><br><span class="line">    <span class="type">int</span> mid=l+r&gt;&gt;<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">auto</span> L=<span class="built_in">q</span>(ls,x,y,l,mid);</span><br><span class="line">    <span class="keyword">if</span>(L==p)<span class="keyword">return</span> <span class="built_in">q</span>(rs,x,y,mid+<span class="number">1</span>,r);</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">return</span> L;</span><br><span class="line">}</span><br><span class="line"><span class="type">int</span> mp[N];</span><br><span class="line"><span class="function"><span class="type">signed</span> <span class="title">main</span><span class="params">()</span></span>{</span><br><span class="line">    ios::<span class="built_in">sync_with_stdio</span>(<span class="number">0</span>);cin.<span class="built_in">tie</span>(<span class="number">0</span>);cout.<span class="built_in">tie</span>(<span class="number">0</span>);</span><br><span class="line">    cin&gt;&gt;T;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=T;i++){</span><br><span class="line">        cin&gt;&gt;op&gt;&gt;x&gt;&gt;y;</span><br><span class="line">        Q[i]={op,x,y};</span><br><span class="line">        a[cnt++]=x,a[cnt++]=y;</span><br><span class="line">    }</span><br><span class="line">    <span class="built_in">sort</span>(a,a+cnt);</span><br><span class="line">    len=<span class="built_in">unique</span>(a,a+cnt)-a;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=T;i++){</span><br><span class="line">        op=Q[i].op,x=Q[i].x,y=Q[i].y;</span><br><span class="line">        <span class="type">int</span> k=<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span>(op==<span class="string">"remove"</span>)k=<span class="number">-1</span>;</span><br><span class="line">        <span class="keyword">if</span>(op==<span class="string">"find"</span>){</span><br><span class="line">            x=<span class="built_in">lower_bound</span>(a,a+len,x+<span class="number">1</span>)-a;</span><br><span class="line">            y=<span class="built_in">lower_bound</span>(a,a+len,y+<span class="number">1</span>)-a;</span><br><span class="line">            <span class="keyword">auto</span> t=<span class="built_in">q</span>(<span class="number">1</span>,x,y);</span><br><span class="line">            <span class="keyword">if</span>(t==p)cout&lt;&lt;<span class="number">-1</span>&lt;&lt;<span class="string">'\n'</span>;</span><br><span class="line">            <span class="keyword">else</span> cout&lt;&lt;a[t.first]&lt;&lt;<span class="string">" "</span>&lt;&lt;a[t.second]&lt;&lt;<span class="string">'\n'</span>;</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">else</span>{</span><br><span class="line">            x=<span class="built_in">lower_bound</span>(a,a+len,x)-a;</span><br><span class="line">            y=<span class="built_in">lower_bound</span>(a,a+len,y)-a;</span><br><span class="line">            <span class="built_in">modify</span>(<span class="number">1</span>,x,y,k);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><hr>]]></content>
      
      
      <categories>
          
          <category> ICPC </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 训练 </tag>
            
            <tag> 知乎 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>四分树</title>
      <link href="/2022/05/31/si-fen-shu/"/>
      <url>/2022/05/31/si-fen-shu/</url>
      
        <content type="html"><![CDATA[<h1 id="ZOJ-1788-Quad-Trees"><a href="#ZOJ-1788-Quad-Trees" class="headerlink" title="ZOJ 1788 Quad Trees"></a>ZOJ 1788 Quad Trees</h1><p><img src="https://img-blog.csdnimg.cn/cb0ad1d6c8d642eaa6a0fa7dbbcc751a.png" alt="在这里插入图片描述"></p><p><img src="https://img-blog.csdnimg.cn/88a5b695643043b9a42fd7327e71f949.png" alt="在这里插入图片描述"><br>在acm竞赛里面，用指针写的题解一般都是过不了的<br>但是翻看了题解区和咱老师在例如云上的题解几乎都是这样写的<br>强迫症逼得我写了篇动态开点得题解</p><figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">int</span> T,n,o,idx;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N=<span class="number">600</span>;</span><br><span class="line"><span class="type">char</span> a[N][N];</span><br><span class="line">unordered_map&lt;<span class="type">int</span>,string&gt;mp;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">node</span>{</span><br><span class="line">    string v;</span><br><span class="line">    <span class="type">int</span> child[<span class="number">4</span>];</span><br><span class="line">    <span class="meta">#<span class="keyword">define</span> s0 tr[tr[u].child[0]]</span></span><br><span class="line">    <span class="meta">#<span class="keyword">define</span> s1 tr[tr[u].child[1]]</span></span><br><span class="line">    <span class="meta">#<span class="keyword">define</span> s2 tr[tr[u].child[2]]</span></span><br><span class="line">    <span class="meta">#<span class="keyword">define</span> s3 tr[tr[u].child[3]]</span></span><br><span class="line">}tr[<span class="number">1000010</span>];</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">dfs</span><span class="params">(<span class="type">int</span> x,<span class="type">int</span> y,<span class="type">int</span> l)</span></span>{</span><br><span class="line">    <span class="type">int</span> u=++o;</span><br><span class="line">    <span class="keyword">if</span>(l==<span class="number">1</span>){</span><br><span class="line">        tr[u].v=<span class="string">"0"</span>;</span><br><span class="line">        tr[u].v+=a[x][y];</span><br><span class="line">        <span class="keyword">return</span> u;</span><br><span class="line">    }</span><br><span class="line">    l/=<span class="number">2</span>;</span><br><span class="line">    tr[u].child[<span class="number">0</span>]=<span class="built_in">dfs</span>(x,y,l);</span><br><span class="line">    tr[u].child[<span class="number">1</span>]=<span class="built_in">dfs</span>(x,y+l,l);</span><br><span class="line">    tr[u].child[<span class="number">2</span>]=<span class="built_in">dfs</span>(x+l,y,l);</span><br><span class="line">    tr[u].child[<span class="number">3</span>]=<span class="built_in">dfs</span>(x+l,y+l,l);</span><br><span class="line">    <span class="type">bool</span> flag=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">if</span>(s0.v==<span class="string">"1"</span>)flag=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span>(s1.v==<span class="string">"1"</span>)flag=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span>(s2.v==<span class="string">"1"</span>)flag=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span>(s3.v==<span class="string">"1"</span>)flag=<span class="number">0</span>;</span><br><span class="line">    <span class="comment">// for(int i=0;i&lt;4;i++){</span></span><br><span class="line">    <span class="comment">//     if(tr[tr[u].child[i]].v=="1")flag=0;</span></span><br><span class="line">    <span class="comment">// }</span></span><br><span class="line">    <span class="keyword">if</span>(s1.v!=s0.v)flag=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span>(s2.v!=s0.v)flag=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span>(s3.v!=s0.v)flag=<span class="number">0</span>;</span><br><span class="line">    <span class="comment">// for(int i=1;i&lt;4;i++){</span></span><br><span class="line">    <span class="comment">//     if(tr[tr[u].child[i]].v!=s0.v)flag=0;</span></span><br><span class="line">    <span class="comment">// }</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span>(flag)tr[u].v=s0.v;</span><br><span class="line">    <span class="keyword">else</span> tr[u].v=<span class="string">"1"</span>;</span><br><span class="line">    <span class="keyword">return</span> u;</span><br><span class="line">}</span><br><span class="line"><span class="function">string <span class="title">bfs</span><span class="params">(<span class="type">int</span> u)</span></span>{</span><br><span class="line">    string ans;</span><br><span class="line">    <span class="keyword">if</span>(tr[u].v[<span class="number">0</span>]==<span class="string">'0'</span>)<span class="keyword">return</span> ans=tr[u].v[<span class="number">1</span>];</span><br><span class="line">    queue&lt;<span class="type">int</span>&gt;q;</span><br><span class="line">    q.<span class="built_in">push</span>(u);</span><br><span class="line">    <span class="keyword">while</span>(q.<span class="built_in">size</span>()){</span><br><span class="line">        <span class="type">int</span> x=q.<span class="built_in">front</span>();</span><br><span class="line">        q.<span class="built_in">pop</span>();</span><br><span class="line">        <span class="keyword">if</span>(tr[x].v[<span class="number">0</span>]==<span class="string">'0'</span>)ans+=tr[x].v;</span><br><span class="line">        <span class="keyword">else</span>{</span><br><span class="line">            ans+=tr[x].v;</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;<span class="number">4</span>;i++)q.<span class="built_in">push</span>(tr[x].child[i]);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> ans;</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">solve</span><span class="params">()</span></span>{</span><br><span class="line">    cin&gt;&gt;n;</span><br><span class="line">    o=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;n;i++){</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">0</span>;j&lt;n;j++)cin&gt;&gt;a[i][j];</span><br><span class="line">    }</span><br><span class="line">    <span class="type">int</span> u=<span class="built_in">dfs</span>(<span class="number">0</span>,<span class="number">0</span>,n);</span><br><span class="line">    string ans=<span class="built_in">bfs</span>(u);</span><br><span class="line">    <span class="type">int</span> len=ans.<span class="built_in">length</span>();</span><br><span class="line">    <span class="keyword">if</span>(len%<span class="number">4</span>==<span class="number">1</span>)ans=<span class="string">"000"</span>+ans;</span><br><span class="line">    <span class="keyword">if</span>(len%<span class="number">4</span>==<span class="number">2</span>)ans=<span class="string">"00"</span>+ans;</span><br><span class="line">    <span class="keyword">if</span>(len%<span class="number">4</span>==<span class="number">3</span>)ans=<span class="string">"0"</span>+ans;</span><br><span class="line">    <span class="comment">//cout&lt;&lt;"ans="&lt;&lt;ans&lt;&lt;'\n';</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;ans.<span class="built_in">length</span>();i+=<span class="number">4</span>){</span><br><span class="line">        <span class="type">int</span> t=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">0</span>,p=<span class="number">8</span>;j&lt;<span class="number">4</span>;j++,p/=<span class="number">2</span>)t+=p*(ans[i+j]-<span class="string">'0'</span>);</span><br><span class="line">        <span class="keyword">if</span>(t&lt;<span class="number">10</span>)cout&lt;&lt;t;</span><br><span class="line">        <span class="keyword">else</span> cout&lt;&lt;mp[t];</span><br><span class="line">    }</span><br><span class="line">    cout&lt;&lt;<span class="string">'\n'</span>;</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="type">signed</span> <span class="title">main</span><span class="params">()</span></span>{</span><br><span class="line">    mp[<span class="number">10</span>]=<span class="string">"A"</span>;</span><br><span class="line">    mp[<span class="number">11</span>]=<span class="string">"B"</span>;</span><br><span class="line">    mp[<span class="number">12</span>]=<span class="string">"C"</span>;</span><br><span class="line">    mp[<span class="number">13</span>]=<span class="string">"D"</span>;</span><br><span class="line">    mp[<span class="number">14</span>]=<span class="string">"E"</span>;</span><br><span class="line">    mp[<span class="number">15</span>]=<span class="string">"F"</span>;</span><br><span class="line">    ios::<span class="built_in">sync_with_stdio</span>(<span class="number">0</span>);cin.<span class="built_in">tie</span>(<span class="number">0</span>);cout.<span class="built_in">tie</span>(<span class="number">0</span>);</span><br><span class="line">    cin&gt;&gt;T;</span><br><span class="line">    <span class="keyword">while</span>(T--)<span class="built_in">solve</span>();</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><hr><p><img src="https://img-blog.csdnimg.cn/fdc285556900451b86d7fcc4783a051b.png" alt="在这里插入图片描述"><br>按道理来说我的run time（46ms）应该是更小的，但是还是跑的比指针（19ms）写的慢<br>可能是我常数比较大吧hh</p><hr><figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N=<span class="number">200</span>;</span><br><span class="line"><span class="type">int</span> g[N][N],n,m,o,ans1,ans2;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">node</span>{</span><br><span class="line">    <span class="type">int</span> a,b,c,d;</span><br><span class="line">    <span class="function"><span class="type">bool</span> <span class="title">equal</span><span class="params">(<span class="type">int</span> aa,<span class="type">int</span> bb,<span class="type">int</span> cc,<span class="type">int</span> dd)</span></span>{</span><br><span class="line">        <span class="keyword">return</span> a==aa&amp;&amp;b==bb&amp;&amp;c==cc&amp;&amp;d==dd;</span><br><span class="line">    }</span><br><span class="line">}tr[<span class="number">100010</span>];</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">dfs</span><span class="params">(<span class="type">int</span> x,<span class="type">int</span> y,<span class="type">int</span> l)</span></span>{</span><br><span class="line">    <span class="type">int</span> pre=ans2;</span><br><span class="line">    ans1++,ans2++;</span><br><span class="line">    <span class="keyword">if</span>(l==<span class="number">1</span>)<span class="keyword">return</span> g[x][y];</span><br><span class="line">    </span><br><span class="line">    l/=<span class="number">2</span>;</span><br><span class="line">    <span class="type">int</span> a=<span class="built_in">dfs</span>(x,y,l);</span><br><span class="line">    <span class="type">int</span> b=<span class="built_in">dfs</span>(x,y+l,l);</span><br><span class="line">    <span class="type">int</span> c=<span class="built_in">dfs</span>(x+l,y,l);</span><br><span class="line">    <span class="type">int</span> d=<span class="built_in">dfs</span>(x+l,y+l,l);</span><br><span class="line">    <span class="keyword">if</span>(a==b&amp;&amp;a==c&amp;&amp;a==d&amp;&amp;a==<span class="number">0</span>){</span><br><span class="line">        ans1-=<span class="number">4</span>,ans2-=<span class="number">4</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">if</span>(a==b&amp;&amp;a==c&amp;&amp;a==d&amp;&amp;a==<span class="number">1</span>){</span><br><span class="line">        ans1-=<span class="number">4</span>,ans2-=<span class="number">4</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    }</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">2</span>;i&lt;o;i++){</span><br><span class="line">        <span class="keyword">if</span>(tr[i].<span class="built_in">equal</span>(a,b,c,d)){</span><br><span class="line">            ans2=pre;</span><br><span class="line">            <span class="keyword">return</span> i;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    tr[o++]={a,b,c,d};</span><br><span class="line">    <span class="keyword">return</span> o<span class="number">-1</span>;</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="type">signed</span> <span class="title">main</span><span class="params">()</span></span>{</span><br><span class="line">    ios::<span class="built_in">sync_with_stdio</span>(<span class="number">0</span>);cin.<span class="built_in">tie</span>(<span class="number">0</span>);cout.<span class="built_in">tie</span>(<span class="number">0</span>);</span><br><span class="line">    <span class="keyword">while</span>(cin&gt;&gt;n&gt;&gt;m&amp;&amp;n&amp;&amp;m){</span><br><span class="line">        <span class="built_in">memset</span>(g,<span class="number">0</span>,<span class="keyword">sizeof</span> g);</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;n;i++){</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">0</span>;j&lt;m;j++){</span><br><span class="line">                <span class="type">char</span> c;</span><br><span class="line">                cin&gt;&gt;c;</span><br><span class="line">                g[i][j]=c-<span class="string">'0'</span>;</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">        o=<span class="number">2</span>;</span><br><span class="line">        ans1=<span class="number">0</span>;</span><br><span class="line">        ans2=<span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> len=<span class="number">1</span>;</span><br><span class="line">        n=<span class="built_in">max</span>(n,m);</span><br><span class="line">        <span class="keyword">while</span>(len&lt;n)len*=<span class="number">2</span>;</span><br><span class="line">        <span class="built_in">dfs</span>(<span class="number">0</span>,<span class="number">0</span>,len);</span><br><span class="line">        cout&lt;&lt;ans1&lt;&lt;<span class="string">" "</span>&lt;&lt;ans2&lt;&lt;<span class="string">'\n'</span>;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>]]></content>
      
      
      <categories>
          
          <category> 算法 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 数据结构 </tag>
            
            <tag> 四分树 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>空气污染预测</title>
      <link href="/2022/05/17/kong-qi-wu-ran-yu-ce/"/>
      <url>/2022/05/17/kong-qi-wu-ran-yu-ce/</url>
      
        <content type="html"><![CDATA[<h1 id="空气污染预测"><a href="#空气污染预测" class="headerlink" title="空气污染预测"></a>空气污染预测</h1><h2 id="摘要"><a href="#摘要" class="headerlink" title="摘要"></a>摘要</h2><p>作者：胡耀文</p><p>本文用北京2010年到2014年气压风向雨雪量等相关物理量的数据集，用LSTM做模型优化，来预测PM2.5浓度。</p><p>目前均方差在34左右，还有优化空间。后续会爬取广州的相关天气信息，来预测广州的空气污染程度。</p><h2 id="第一，数据集"><a href="#第一，数据集" class="headerlink" title="第一，数据集"></a>第一，数据集</h2><p><img src="https://img-blog.csdnimg.cn/ce84acf58e204100a2cbdfcb17effac8.png" alt="在这里插入图片描述"></p><p>数据集是kaggle上找的，是北京2010年1月1日到2014年12月31日的数据</p><p><img src="https://img-blog.csdnimg.cn/0e8b011c399540738da07338e4f422a7.png" alt="在这里插入图片描述"></p><p>No是编号</p><p>year是年</p><p>month是月</p><p>day是日</p><p>hour是小时</p><p>PM2.5是预测值</p><p>DEWP是露点</p><p>TEMP是温度</p><p>PRES是大气压</p><p>cbwd是风向</p><p>lws是风速</p><p>Is是累积雨量</p><p>lr是累计雪量</p><p>每隔一小时就会采取一次数据</p><h3 id="数据预处理"><a href="#数据预处理" class="headerlink" title="数据预处理"></a>数据预处理</h3><ul><li><p>对NAN空值如果删掉的话会影响数据集的序列结构，所以这里采取前向填充</p></li><li><p>删掉编号，将年月日时用datetime压成一维作为唯一索引</p></li><li><p>风向有4个，用独热编码处理，从而删掉风向cbwd这一特征</p></li><li><p>至此，总计11个特征，用这11个特征来作为预测指标</p></li></ul><p><img src="https://img-blog.csdnimg.cn/150905a9d63841f2884be2345ed20117.png" alt="在这里插入图片描述"></p><h3 id="策略采取"><a href="#策略采取" class="headerlink" title="策略采取"></a>策略采取</h3><p>预测的时候，由于选择过早的数据或者过少的数据都是不对的</p><p>比如，仅仅用今天这一天的数据来预测明天的值是不恰的</p><p>或者用前一个月的值来预测明天的值也是过于浪费</p><p>用前一个星期的值就差不多了</p><p>在这里，我用了前五天的数据来预测第六天第24h的数据</p><p><img src="https://img-blog.csdnimg.cn/2b11428f911949189363d083a3743b29.png" alt="在这里插入图片描述"></p><p>总数据集的百分之80作为训练数据，百分之20作为测试数据</p><p>至此，数据集部分处理完毕，</p><p>现在让我们看看要预测的PM2.5长啥样</p><p>下图是最后1000组PM2.5的数据</p><p><img src="https://img-blog.csdnimg.cn/61bc53be76754227bd4d0c331f8a7b59.png" alt="在这里插入图片描述"></p><p>（emm如果你在北京为了肺好，建议昼伏夜出hhh~~</p><h2 id="第二，模型训练，传统卷积和LSTM的比较"><a href="#第二，模型训练，传统卷积和LSTM的比较" class="headerlink" title="第二，模型训练，传统卷积和LSTM的比较"></a>第二，模型训练，传统卷积和LSTM的比较</h2><p>这是最简单的卷积层</p><p><img src="https://img-blog.csdnimg.cn/2c4611cc77e346569d28a2a57afb4867.png" alt="在这里插入图片描述"></p><p><img src="https://img-blog.csdnimg.cn/d77e9bc52ed740549f12277e0517701f.png" alt="在这里插入图片描述"></p><p>50epoch之后总差值大于在5000，均方差大约在52左右</p><p><img src="https://img-blog.csdnimg.cn/cee877a1f6ee4a97896ab4e3a559d26b.png" alt="在这里插入图片描述"></p><p>接下来看看LSTM</p><p><img src="https://img-blog.csdnimg.cn/90300848f9914597b7e53357763fedb2.png" alt="在这里插入图片描述"></p><p>我在看官方文档的时候抄错好几次reduceLROnPlateau！！！！然后很莫名其妙的报了好多错</p><p>看来以后还是直接copy文档</p><p><img src="https://img-blog.csdnimg.cn/6161ed7c58f34e26985d489f26fa6a97.png" alt="在这里插入图片描述"></p><p>我没记错的话LSTM特别的一个地方就是输入到输出这个过程会产生一组序列，叫中间状态，参与下一轮的输入到输出的计算</p><p>然后循环产生输出</p><p>这种特殊的运算结构让它特别擅长捕捉时间变化的趋势，比如对于星期一这样的数据，星期二会变成这样，对于星期二这样的数据，星期三会变成这样，……..，进而对星期六的数据进行较为精准的预测</p><p>我的理解就是：</p><p>如果这种时间戳的相对关系是对于要预测的指标是存在某种关系的话，那么LSTM在预测时会把这层关系计算进去，</p><p>在同等方法里面会很有优势，但如果根本不存在这种关系的话，就会出现“用了等于没用”的情况，</p><p>所以针对不同情况，要搭配不同的模型去计算，去预测，</p><p>这也是为什么人工智能行业一直在更迅捷的发展，</p><p>因为对于某种特定情况，可能目前为止没有哪一种模型更为契合，那么你就要“设计”一种方法，一种计算方法，</p><p>如果跑出来的结果比T0要好，那么你就是新的T0了哈哈</p><p>下图是开50epoch的时候跑出来的结果：</p><p><img src="https://img-blog.csdnimg.cn/7df975e7ac9543c5a30c104b5e7ff7d7.png" alt="在这里插入图片描述"></p><p>最后发现总方差在2966，均方差在34，从结果来看确实更好一点</p><p>LSTM使用的时候有两个点要注意一下：</p><ul><li>LSTM网络接受的是三维数据（batch，时间观测，特征）</li><li>堆叠LSTM网络，需要设置return_sequences=True,意思是对每个序列预测结果进行输出</li></ul><h2 id="第三，模型评价，多组数据预测和单组数据预测"><a href="#第三，模型评价，多组数据预测和单组数据预测" class="headerlink" title="第三，模型评价，多组数据预测和单组数据预测"></a>第三，模型评价，多组数据预测和单组数据预测</h2><p>多组数据预测，可以直接用那把百分之20的test_x</p><p><img src="https://img-blog.csdnimg.cn/6776f7b73b0740b8a2ea71abec864996.png" alt="在这里插入图片描述"></p><p>最后发现这8732条数据总方差在2966，均方差在34，</p><p>对单组数据进行预测</p><p><img src="https://img-blog.csdnimg.cn/9b88911e0a9e4a6788d65cb62ca1c97b.png" alt="在这里插入图片描述"></p><p>我们用最后的数据来预测2015年1月1日23时的情况</p><p><img src="https://img-blog.csdnimg.cn/fc23c3fb5f1f462c9d1cff75d2a7c54a.png" alt="在这里插入图片描述"></p><p>跑出来的结果是41</p><p>我们现在去官网查看北京历史空气污染数据</p><p><img src="https://img-blog.csdnimg.cn/599f0886bcb34af18cef279f8855f7d3.png" alt="在这里插入图片描述"></p><p>这里的数据是一整天的平均PM2.5浓度</p><p>2015年1月1日 平均浓度是41</p><p>2015年1月2日 平均浓度是51</p><p>预测1月1日23时的浓度时41</p><p>差值较小，跑出来的模型灰常ojbk！</p><h2 id="第四，广州天气情况的爬取"><a href="#第四，广州天气情况的爬取" class="headerlink" title="第四，广州天气情况的爬取"></a>第四，广州天气情况的爬取</h2><p>只写了一点点，</p><p>爬取中国气象网</p><p><a href="http://www.weather.com.cn/weather1d/101280101.shtml">http://www.weather.com.cn/weather1d/101280101.shtml</a></p><p>上面这个网址是广东的天气信息</p><p>下面是爬取到当天24h的信息</p><p><img src="https://img-blog.csdnimg.cn/7ec34b6162f041a082fa24bb992b2b57.png" alt="在这里插入图片描述"></p><p>大约18，19摄氏度这样子，今天看看这个中国气象网有没有骗人。</p><h2 id="第五，总结与思考"><a href="#第五，总结与思考" class="headerlink" title="第五，总结与思考"></a>第五，总结与思考</h2><p>只要有相关特征，对某一指标的预测都可以用LSTM网络，都是ok的，</p><p>很多小tips都是在当前所学上进行一个小的拓展，</p><p>比如我在学openvino的时候，看人脸骨骼关键点检测，用这个东西你可以针对某些特定的关节点进行讨论</p><p>来完成一些奇奇怪怪的检测，比如看这个人有没有张嘴，或者看这个人眼睛有没有闭上，然后美其名曰：<br>人类公共场所喧哗检测，网课是否打瞌睡智能检测……</p><p>这些都是比较初级的，更高级一点的就是表情检测，导入某些表情参数，通过对人脸的识别判断是angry还是happy还是sad</p><p>等等。</p><p>回到这个空气污染预测，其实是这些指标能够较为充分的描述和概括PM2.5这个指标，所以有了比较好的预测结果，</p><p>预测气温，预测天气，预测空气湿度也是同样的道理，比如说如果是空气湿度，先去百度、知网找一找相关论文，看</p><p>空气湿度跟哪些因素有关，然后找一找网上有没有现成数据集，没有的话要去哪里爬取</p><p>整合成数据集然后进行特征提取训练……巴拉巴拉一大堆，然后你的一个小项目就水完了。</p><p>但很多时候不是一帆风顺的</p><p>在写的时候难免会遇到很多坑点</p><p>比如新版本有一些奇奇怪怪的错误，你去stack overflow搜的时候看到 “I also meet this problem, </p><p>I think what is about the upgrade , I had send email to them but they didnt give me a feedback”</p><p>那才是最最崩溃的。</p><h3 id="kaggle与colab的区别"><a href="#kaggle与colab的区别" class="headerlink" title="kaggle与colab的区别"></a>kaggle与colab的区别</h3><p>这次的全部代码我都是用colab敲的，自从升级成win11之后，我本地搭建的jupyter notebook跑一点点就宕机了，</p><p>昨晚第一次使用colab，给我的感觉就是白嫖真的香！很简约风，免费版的算力只有一般CPU的两倍，付费版的能达到6.5倍</p><p>要搭梯子，好不好用取决于你的梯子OK不OK，数据集的话不像kaggle那样自己弄了个dataset平台，很轻量级，</p><p>当然要用的话也可以用kaggle提供的API下载。</p><p>kaggle的话貌似不用搭梯子，里面有很多现成的数据集可以使用，这一点比colab方便很多，功能比较全更像是一个小型github</p><p>唯一的痛点就是要注册，而且真的很麻烦，我当时注册的时候反正就一直verify不成功，网上也没有好的解决方案，然后发邮件</p><p>过了十几个小时这样子那边 i am sorry to trouble 巴拉巴拉一大堆，反正终于ok终于注册成功了！</p><p>如果有更高追求的话，可以没有colab但不能没有kaggle，还是建议两边都去弄一个号。</p><p>最后代码挂在github上，题解报告也挂在了博客里，需要可自取</p><p><a href="https://github.com/hyw200199/AI">hyw200199/AI (github.com)</a></p>]]></content>
      
      
      <categories>
          
          <category> 人工智能 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> LSTM </tag>
            
            <tag> 特征预测 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>树链剖分</title>
      <link href="/2022/05/13/shu-lian-pou-fen/"/>
      <url>/2022/05/13/shu-lian-pou-fen/</url>
      
        <content type="html"><![CDATA[<h1 id="树链剖分"><a href="#树链剖分" class="headerlink" title="树链剖分"></a>树链剖分</h1><h2 id="模板"><a href="#模板" class="headerlink" title="模板"></a>模板</h2><p><img src="https://img-blog.csdnimg.cn/96a07af9162444938e2820cbef21f8eb.png" alt="在这里插入图片描述"></p><figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="keyword">define</span> int long long</span></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N = <span class="number">100010</span> , M=N*<span class="number">2</span>;</span><br><span class="line"><span class="type">int</span> n,m;</span><br><span class="line"><span class="type">int</span> w[N],h[N],ne[M],e[M],idx;</span><br><span class="line"><span class="type">int</span> id[N],nw[N],cnt;</span><br><span class="line"><span class="type">int</span> dep[N],sz[N],top[N],fa[N],son[N];</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Tree</span>{</span><br><span class="line">    <span class="type">int</span> l,r;</span><br><span class="line">    <span class="type">int</span> add,sum;</span><br><span class="line">}tr[N*<span class="number">4</span>];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">add</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> b)</span>  </span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">    e[idx] = b, ne[idx] = h[a], h[a] = idx ++ ;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">dfs1</span><span class="params">(<span class="type">int</span> u,<span class="type">int</span> father,<span class="type">int</span> depth)</span></span>{</span><br><span class="line">    dep[u]=depth,fa[u]=father,sz[u]=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=h[u];~i;i=ne[i]){</span><br><span class="line">        <span class="type">int</span> j=e[i];</span><br><span class="line">        <span class="keyword">if</span>(j==father)<span class="keyword">continue</span>;</span><br><span class="line">        <span class="built_in">dfs1</span>(j,u,depth+<span class="number">1</span>);</span><br><span class="line">        sz[u]+=sz[j];</span><br><span class="line">        <span class="keyword">if</span>(sz[son[u]&lt;sz[j]])son[u]=j;</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">dfs2</span><span class="params">(<span class="type">int</span> u,<span class="type">int</span> t)</span></span>{</span><br><span class="line">    id[u]=++cnt,nw[cnt]=w[u],top[u]=t;</span><br><span class="line">    <span class="keyword">if</span>(!son[u])<span class="keyword">return</span>;</span><br><span class="line">    <span class="built_in">dfs2</span>(son[u],t);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=h[u];~i;i=ne[i]){</span><br><span class="line">        <span class="type">int</span> j=e[i];</span><br><span class="line">        <span class="keyword">if</span>(j==fa[u]||j==son[u])<span class="keyword">continue</span>;</span><br><span class="line">        <span class="built_in">dfs2</span>(j,j);</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">pushup</span><span class="params">(<span class="type">int</span> u)</span></span>{</span><br><span class="line">    tr[u].sum=tr[u&lt;&lt;<span class="number">1</span>].sum+tr[u&lt;&lt;<span class="number">1</span>|<span class="number">1</span>].sum;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">pushdown</span><span class="params">(<span class="type">int</span> u)</span></span>{</span><br><span class="line">    <span class="keyword">auto</span> &amp;root=tr[u], &amp;left=tr[u&lt;&lt;<span class="number">1</span>], &amp;right=tr[u&lt;&lt;<span class="number">1</span>|<span class="number">1</span>];</span><br><span class="line">    <span class="keyword">if</span>(root.add){</span><br><span class="line">        left.add+=root.add;</span><br><span class="line">        left.sum+=root.add*(left.r-left.l+<span class="number">1</span>);</span><br><span class="line">        right.add+=root.add;</span><br><span class="line">        right.sum+=root.add*(right.r-right.l+<span class="number">1</span>);</span><br><span class="line">        root.add=<span class="number">0</span>;</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">build</span><span class="params">(<span class="type">int</span> u,<span class="type">int</span> l,<span class="type">int</span> r)</span></span>{</span><br><span class="line">    tr[u]={l,r,<span class="number">0</span>,nw[l]};</span><br><span class="line">    <span class="keyword">if</span>(l==r)<span class="keyword">return</span>;</span><br><span class="line">    <span class="type">int</span> mid=l+r&gt;&gt;<span class="number">1</span>;</span><br><span class="line">    <span class="built_in">build</span>(u&lt;&lt;<span class="number">1</span>,l,mid),<span class="built_in">build</span>(u&lt;&lt;<span class="number">1</span>|<span class="number">1</span>,mid+<span class="number">1</span>,r);</span><br><span class="line">    <span class="built_in">pushup</span>(u);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">update</span><span class="params">(<span class="type">int</span> u,<span class="type">int</span> l,<span class="type">int</span> r,<span class="type">int</span> k)</span></span>{</span><br><span class="line">    <span class="keyword">if</span>(l&lt;=tr[u].l&amp;&amp;r&gt;=tr[u].r){</span><br><span class="line">        tr[u].add+=k;</span><br><span class="line">        tr[u].sum+=k*(tr[u].r-tr[u].l+<span class="number">1</span>);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="built_in">pushdown</span>(u);</span><br><span class="line">    <span class="type">int</span> mid=tr[u].l+tr[u].r&gt;&gt;<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">if</span>(l&lt;=mid)<span class="built_in">update</span>(u&lt;&lt;<span class="number">1</span>,l,r,k);</span><br><span class="line">    <span class="keyword">if</span>(r&gt;mid)<span class="built_in">update</span>(u&lt;&lt;<span class="number">1</span>|<span class="number">1</span>,l,r,k);</span><br><span class="line">    <span class="built_in">pushup</span>(u);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">query</span><span class="params">(<span class="type">int</span> u,<span class="type">int</span> l,<span class="type">int</span> r)</span></span>{</span><br><span class="line">    <span class="keyword">if</span>(l&lt;=tr[u].l&amp;&amp;tr[u].r&lt;=r)<span class="keyword">return</span> tr[u].sum;</span><br><span class="line">    <span class="built_in">pushdown</span>(u);</span><br><span class="line">    <span class="type">int</span> mid=tr[u].l+tr[u].r&gt;&gt;<span class="number">1</span>;</span><br><span class="line">    <span class="type">int</span> ans=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span>(l&lt;=mid)ans+=<span class="built_in">query</span>(u&lt;&lt;<span class="number">1</span>,l,r);</span><br><span class="line">    <span class="keyword">if</span>(r&gt;mid)ans+=<span class="built_in">query</span>(u&lt;&lt;<span class="number">1</span>|<span class="number">1</span>,l,r);</span><br><span class="line">    <span class="keyword">return</span> ans;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">update_path</span><span class="params">(<span class="type">int</span> u, <span class="type">int</span> v, <span class="type">int</span> k)</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">    <span class="keyword">while</span> (top[u] != top[v])</span><br><span class="line">    {</span><br><span class="line">        <span class="keyword">if</span> (dep[top[u]] &lt; dep[top[v]]) <span class="built_in">swap</span>(u, v);</span><br><span class="line">        <span class="built_in">update</span>(<span class="number">1</span>, id[top[u]], id[u], k);</span><br><span class="line">        u = fa[top[u]];</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">if</span> (dep[u] &lt; dep[v]) <span class="built_in">swap</span>(u, v);</span><br><span class="line">    <span class="built_in">update</span>(<span class="number">1</span>, id[v], id[u], k);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">query_path</span><span class="params">(<span class="type">int</span> u, <span class="type">int</span> v)</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">    <span class="type">int</span> res = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span> (top[u] != top[v])</span><br><span class="line">    {</span><br><span class="line">        <span class="keyword">if</span> (dep[top[u]] &lt; dep[top[v]]) <span class="built_in">swap</span>(u, v);</span><br><span class="line">        res += <span class="built_in">query</span>(<span class="number">1</span>, id[top[u]], id[u]);</span><br><span class="line">        u = fa[top[u]];</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">if</span> (dep[u] &lt; dep[v]) <span class="built_in">swap</span>(u, v);</span><br><span class="line">    res += <span class="built_in">query</span>(<span class="number">1</span>, id[v], id[u]);</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">update_tree</span><span class="params">(<span class="type">int</span> u, <span class="type">int</span> k)</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">    <span class="built_in">update</span>(<span class="number">1</span>, id[u], id[u] + sz[u] - <span class="number">1</span>, k);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">query_tree</span><span class="params">(<span class="type">int</span> u)</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">query</span>(<span class="number">1</span>, id[u], id[u] + sz[u] - <span class="number">1</span>);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">signed</span> <span class="title">main</span><span class="params">()</span></span>{</span><br><span class="line">    ios::<span class="built_in">sync_with_stdio</span>(<span class="number">0</span>);</span><br><span class="line">    cin.<span class="built_in">tie</span>(<span class="number">0</span>);</span><br><span class="line">    cout.<span class="built_in">tie</span>(<span class="number">0</span>);</span><br><span class="line">    <span class="built_in">memset</span>(h,<span class="number">-1</span>,<span class="keyword">sizeof</span> h);</span><br><span class="line">    cin&gt;&gt;n;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;i++)cin&gt;&gt;w[i];</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;n;i++){</span><br><span class="line">        <span class="type">int</span> a,b;</span><br><span class="line">        cin&gt;&gt;a&gt;&gt;b;</span><br><span class="line">        <span class="built_in">add</span>(a,b),<span class="built_in">add</span>(b,a);</span><br><span class="line">    }</span><br><span class="line">    <span class="built_in">dfs1</span>(<span class="number">1</span>,<span class="number">-1</span>,<span class="number">1</span>);</span><br><span class="line">    <span class="built_in">dfs2</span>(<span class="number">1</span>,<span class="number">1</span>);</span><br><span class="line">    <span class="built_in">build</span>(<span class="number">1</span>,<span class="number">1</span>,n);</span><br><span class="line">    cin&gt;&gt;m;</span><br><span class="line">    <span class="keyword">while</span>(m--){</span><br><span class="line">        <span class="type">int</span> t,u,v,k;</span><br><span class="line">        cin&gt;&gt;t&gt;&gt;u;</span><br><span class="line">        <span class="keyword">if</span>(t==<span class="number">1</span>){</span><br><span class="line">            cin&gt;&gt;v&gt;&gt;k;</span><br><span class="line">            <span class="built_in">update_path</span>(u,v,k);</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(t==<span class="number">2</span>){</span><br><span class="line">            cin&gt;&gt;k;</span><br><span class="line">            <span class="built_in">update_tree</span>(u,k);</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(t==<span class="number">3</span>){</span><br><span class="line">            cin&gt;&gt;v;</span><br><span class="line">            cout&lt;&lt;<span class="built_in">query_path</span>(u,v)&lt;&lt;endl;</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">else</span> cout&lt;&lt;<span class="built_in">query_tree</span>(u)&lt;&lt;endl;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><hr><h2 id="换根"><a href="#换根" class="headerlink" title="换根"></a>换根</h2><p><img src="https://img-blog.csdnimg.cn/8e681ba1db43432c9b7bae14d33c3b0e.png" alt="在这里插入图片描述"></p><figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">long</span> <span class="type">long</span> LL;</span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N = <span class="number">1e5</span> + <span class="number">10</span>, M = N &lt;&lt; <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> n, m;</span><br><span class="line"><span class="type">int</span> h[N], e[M], ne[M], w[M], idx;</span><br><span class="line"><span class="type">int</span> id[N], nw[N], cnt;</span><br><span class="line"><span class="type">int</span> dep[N], sz[N], top[N], fa[N], son[N];</span><br><span class="line"><span class="type">int</span> root;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">SegmentTree</span></span><br><span class="line">{</span><br><span class="line">    <span class="type">int</span> l, r;</span><br><span class="line">    LL sum, flag;</span><br><span class="line">}tr[N &lt;&lt; <span class="number">2</span>];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">add</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> b)</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">    e[idx] = b, ne[idx] = h[a], h[a] = idx ++ ;</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">dfs1</span><span class="params">(<span class="type">int</span> u, <span class="type">int</span> father, <span class="type">int</span> depth)</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">    dep[u] = depth, fa[u] = father, sz[u] = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = h[u]; ~i; i = ne[i])</span><br><span class="line">    {</span><br><span class="line">        <span class="type">int</span> j = e[i];</span><br><span class="line">        <span class="keyword">if</span> (j == father) <span class="keyword">continue</span>;</span><br><span class="line">        <span class="built_in">dfs1</span>(j, u, depth + <span class="number">1</span>);</span><br><span class="line">        sz[u] += sz[j];</span><br><span class="line">        <span class="keyword">if</span> (sz[son[u]] &lt; sz[j]) son[u] = j;</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">dfs2</span><span class="params">(<span class="type">int</span> u, <span class="type">int</span> t)</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">    id[u] = ++ cnt, nw[cnt] = w[u], top[u] = t;</span><br><span class="line">    <span class="keyword">if</span> (!son[u]) <span class="keyword">return</span>;</span><br><span class="line">    <span class="built_in">dfs2</span>(son[u], t);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = h[u]; ~i; i = ne[i])</span><br><span class="line">    {</span><br><span class="line">        <span class="type">int</span> j = e[i];</span><br><span class="line">        <span class="keyword">if</span> (j == fa[u] || j == son[u]) <span class="keyword">continue</span>;</span><br><span class="line">        <span class="built_in">dfs2</span>(j, j);</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"><span class="comment">//------------------------线段树的部分------------------------\\</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">pushup</span><span class="params">(<span class="type">int</span> u)</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">    tr[u].sum = tr[u &lt;&lt; <span class="number">1</span>].sum + tr[u &lt;&lt; <span class="number">1</span> | <span class="number">1</span>].sum;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">pushdown</span><span class="params">(<span class="type">int</span> u)</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">    <span class="keyword">auto</span> &amp;root = tr[u], &amp;left = tr[u &lt;&lt; <span class="number">1</span>], &amp;right = tr[u &lt;&lt; <span class="number">1</span> | <span class="number">1</span>];</span><br><span class="line">    <span class="keyword">if</span> (root.flag)</span><br><span class="line">    {</span><br><span class="line">        left.sum += root.flag * (left.r - left.l + <span class="number">1</span>);</span><br><span class="line">        left.flag += root.flag;</span><br><span class="line">        right.sum += root.flag * (right.r - right.l + <span class="number">1</span>);</span><br><span class="line">        right.flag += root.flag;</span><br><span class="line">        root.flag = <span class="number">0</span>;</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">build</span><span class="params">(<span class="type">int</span> u, <span class="type">int</span> l, <span class="type">int</span> r)</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">    tr[u] = {l, r, nw[r], <span class="number">0</span>};</span><br><span class="line">    <span class="keyword">if</span> (l == r) <span class="keyword">return</span>;</span><br><span class="line">    <span class="type">int</span> mid = l + r &gt;&gt; <span class="number">1</span>;</span><br><span class="line">    <span class="built_in">build</span>(u &lt;&lt; <span class="number">1</span>, l, mid), <span class="built_in">build</span>(u &lt;&lt; <span class="number">1</span> | <span class="number">1</span>, mid + <span class="number">1</span>, r);</span><br><span class="line">    <span class="built_in">pushup</span>(u);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">update</span><span class="params">(<span class="type">int</span> u, <span class="type">int</span> l, <span class="type">int</span> r, <span class="type">int</span> k)</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">    <span class="keyword">if</span> (l &lt;= tr[u].l &amp;&amp; r &gt;= tr[u].r)</span><br><span class="line">    {</span><br><span class="line">        tr[u].flag += k;</span><br><span class="line">        tr[u].sum += k * (tr[u].r - tr[u].l + <span class="number">1</span>);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="built_in">pushdown</span>(u);</span><br><span class="line">    <span class="type">int</span> mid = tr[u].l + tr[u].r &gt;&gt; <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">if</span> (l &lt;= mid) <span class="built_in">update</span>(u &lt;&lt; <span class="number">1</span>, l, r, k);</span><br><span class="line">    <span class="keyword">if</span> (r &gt; mid) <span class="built_in">update</span>(u &lt;&lt; <span class="number">1</span> | <span class="number">1</span>, l, r, k);</span><br><span class="line">    <span class="built_in">pushup</span>(u);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function">LL <span class="title">query</span><span class="params">(<span class="type">int</span> u, <span class="type">int</span> l, <span class="type">int</span> r)</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">    <span class="keyword">if</span> (l &lt;= tr[u].l &amp;&amp; r &gt;= tr[u].r) <span class="keyword">return</span> tr[u].sum;</span><br><span class="line">    <span class="built_in">pushdown</span>(u);</span><br><span class="line">    <span class="type">int</span> mid = tr[u].l + tr[u].r &gt;&gt; <span class="number">1</span>;</span><br><span class="line">    LL res = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span> (l &lt;= mid) res += <span class="built_in">query</span>(u &lt;&lt; <span class="number">1</span>, l, r);</span><br><span class="line">    <span class="keyword">if</span> (r &gt; mid) res += <span class="built_in">query</span>(u &lt;&lt; <span class="number">1</span> | <span class="number">1</span>, l, r);</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">}</span><br><span class="line"><span class="comment">//------------------------线段树的部分------------------------\\</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">lca</span><span class="params">(<span class="type">int</span> u, <span class="type">int</span> v)</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">    <span class="keyword">while</span> (top[u] != top[v])</span><br><span class="line">    {</span><br><span class="line">        <span class="keyword">if</span> (dep[top[u]] &lt; dep[top[v]]) <span class="built_in">swap</span>(u, v);</span><br><span class="line">        u = fa[top[u]];</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">if</span> (dep[u] &gt; dep[v]) <span class="built_in">swap</span>(u, v);</span><br><span class="line">    <span class="keyword">return</span> u;</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">update_path</span><span class="params">(<span class="type">int</span> u, <span class="type">int</span> v, <span class="type">int</span> k)</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">    <span class="keyword">while</span> (top[u] != top[v])</span><br><span class="line">    {</span><br><span class="line">        <span class="keyword">if</span> (dep[top[u]] &lt; dep[top[v]]) <span class="built_in">swap</span>(u, v);</span><br><span class="line">        <span class="built_in">update</span>(<span class="number">1</span>, id[top[u]], id[u], k);</span><br><span class="line">        u = fa[top[u]];</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">if</span> (dep[u] &lt; dep[v]) <span class="built_in">swap</span>(u, v);</span><br><span class="line">    <span class="built_in">update</span>(<span class="number">1</span>, id[v], id[u], k);</span><br><span class="line">}</span><br><span class="line"><span class="function">LL <span class="title">query_path</span><span class="params">(<span class="type">int</span> u, <span class="type">int</span> v)</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">    LL res = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span> (top[u] != top[v])</span><br><span class="line">    {</span><br><span class="line">        <span class="keyword">if</span> (dep[top[u]] &lt; dep[top[v]]) <span class="built_in">swap</span>(u, v);</span><br><span class="line">        res += <span class="built_in">query</span>(<span class="number">1</span>, id[top[u]], id[u]);</span><br><span class="line">        u = fa[top[u]];</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">if</span> (dep[u] &lt; dep[v]) <span class="built_in">swap</span>(u, v);</span><br><span class="line">    res += <span class="built_in">query</span>(<span class="number">1</span>, id[v], id[u]);</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">update_tree</span><span class="params">(<span class="type">int</span> u, <span class="type">int</span> k)</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">    <span class="keyword">if</span> (u == root) <span class="built_in">update</span>(<span class="number">1</span>, <span class="number">1</span>, n, k);</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (<span class="built_in">lca</span>(u, root) == u)</span><br><span class="line">    {</span><br><span class="line">        <span class="built_in">update</span>(<span class="number">1</span>, <span class="number">1</span>, n, k);</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = h[u]; ~i; i = ne[i])</span><br><span class="line">        {</span><br><span class="line">            <span class="type">int</span> j = e[i];</span><br><span class="line">            <span class="keyword">if</span> (<span class="built_in">lca</span>(j, root) == j)</span><br><span class="line">            {</span><br><span class="line">                <span class="built_in">update</span>(<span class="number">1</span>, id[j], id[j] + sz[j] - <span class="number">1</span>, -k);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">else</span> <span class="built_in">update</span>(<span class="number">1</span>, id[u], id[u] + sz[u] - <span class="number">1</span>, k);</span><br><span class="line">}</span><br><span class="line"><span class="function">LL <span class="title">query_tree</span><span class="params">(<span class="type">int</span> u)</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">    <span class="keyword">if</span> (u == root) <span class="keyword">return</span> <span class="built_in">query</span>(<span class="number">1</span>, <span class="number">1</span>, n);</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (<span class="built_in">lca</span>(u, root) == u)</span><br><span class="line">    {</span><br><span class="line">        LL res = <span class="built_in">query</span>(<span class="number">1</span>, <span class="number">1</span>, n);</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = h[u]; ~i; i = ne[i])</span><br><span class="line">        {</span><br><span class="line">            <span class="type">int</span> j = e[i];</span><br><span class="line">            <span class="keyword">if</span> (<span class="built_in">lca</span>(j, root) == j)</span><br><span class="line">            {</span><br><span class="line">                res -= <span class="built_in">query</span>(<span class="number">1</span>, id[j], id[j] + sz[j] - <span class="number">1</span>);</span><br><span class="line">                <span class="keyword">return</span> res;</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">return</span> <span class="built_in">query</span>(<span class="number">1</span>, id[u], id[u] + sz[u] - <span class="number">1</span>);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">"%d"</span>, &amp;n);</span><br><span class="line">    <span class="built_in">memset</span>(h, <span class="number">-1</span>, <span class="keyword">sizeof</span> h);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i ++ ) <span class="built_in">scanf</span>(<span class="string">"%d"</span>, &amp;w[i]);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">2</span>; i &lt;= n; i ++ )</span><br><span class="line">    {</span><br><span class="line">        <span class="type">int</span> a;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">"%d"</span>, &amp;a);</span><br><span class="line">        <span class="built_in">add</span>(a, i);</span><br><span class="line">    }</span><br><span class="line">    <span class="built_in">dfs1</span>(<span class="number">1</span>, <span class="number">-1</span>, <span class="number">1</span>);</span><br><span class="line">    <span class="built_in">dfs2</span>(<span class="number">1</span>, <span class="number">1</span>);</span><br><span class="line">    <span class="built_in">build</span>(<span class="number">1</span>, <span class="number">1</span>, n);</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">"%d"</span>, &amp;m);</span><br><span class="line">    <span class="keyword">while</span> (m -- )</span><br><span class="line">    {</span><br><span class="line">        <span class="type">int</span> t, u, v, k;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">"%d%d"</span>, &amp;t, &amp;u);</span><br><span class="line">        <span class="keyword">if</span> (t == <span class="number">1</span>) root = u;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (t == <span class="number">2</span>)</span><br><span class="line">        {</span><br><span class="line">            <span class="built_in">scanf</span>(<span class="string">"%d%d"</span>, &amp;v, &amp;k);</span><br><span class="line">            <span class="built_in">update_path</span>(u, v, k);</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (t == <span class="number">3</span>)</span><br><span class="line">        {</span><br><span class="line">            <span class="built_in">scanf</span>(<span class="string">"%d"</span>, &amp;k);</span><br><span class="line">            <span class="built_in">update_tree</span>(u, k);</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (t == <span class="number">4</span>)</span><br><span class="line">        {</span><br><span class="line">            <span class="built_in">scanf</span>(<span class="string">"%d"</span>, &amp;v);</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">"%lld\n"</span>, <span class="built_in">query_path</span>(u, v));</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">else</span> <span class="built_in">printf</span>(<span class="string">"%lld\n"</span>, <span class="built_in">query_tree</span>(u));</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><hr><h2 id="线段树动态开点"><a href="#线段树动态开点" class="headerlink" title="线段树动态开点"></a>线段树动态开点</h2><p><img src="https://img-blog.csdnimg.cn/c325021524f74c8bac2d4cc95b4a31a3.png" alt="在这里插入图片描述"></p><p>这道题不能开1e5个线段树，只能动态开点</p><figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="keyword">define</span> swpa swap</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> remove _</span></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N = <span class="number">2e6</span>+<span class="number">10</span>, M=N*<span class="number">2</span>;</span><br><span class="line"><span class="type">int</span> n,m,cnt2;</span><br><span class="line"><span class="type">int</span> w[N],h[N],ne[M],e[M],idx;</span><br><span class="line"><span class="type">int</span> id[N],nw[N],cnt;</span><br><span class="line"><span class="type">int</span> dep[N],sz[N],top[N],fa[N],son[N];</span><br><span class="line"><span class="type">int</span> root[N];</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Tree</span>{</span><br><span class="line">    <span class="type">int</span> ls,rs;</span><br><span class="line">    <span class="type">int</span> sum,mx;</span><br><span class="line">}tr[N*<span class="number">4</span>];</span><br><span class="line"><span class="type">int</span> c[N];</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">add</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> b)</span>  </span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">    e[idx] = b, ne[idx] = h[a], h[a] = idx ++ ;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">dfs1</span><span class="params">(<span class="type">int</span> u,<span class="type">int</span> father,<span class="type">int</span> depth)</span></span>{</span><br><span class="line">    dep[u]=depth,fa[u]=father,sz[u]=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=h[u];~i;i=ne[i]){</span><br><span class="line">        <span class="type">int</span> j=e[i];</span><br><span class="line">        <span class="keyword">if</span>(j==father)<span class="keyword">continue</span>;</span><br><span class="line">        <span class="built_in">dfs1</span>(j,u,depth+<span class="number">1</span>);</span><br><span class="line">        sz[u]+=sz[j];</span><br><span class="line">        <span class="keyword">if</span>(sz[son[u]]&lt;sz[j])son[u]=j;</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">dfs2</span><span class="params">(<span class="type">int</span> u,<span class="type">int</span> t)</span></span>{</span><br><span class="line">    id[u]=++cnt,nw[cnt]=w[u],top[u]=t;</span><br><span class="line">    <span class="comment">//who[cnt]=u;</span></span><br><span class="line">    <span class="keyword">if</span>(!son[u])<span class="keyword">return</span>;</span><br><span class="line">    <span class="built_in">dfs2</span>(son[u],t);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=h[u];~i;i=ne[i]){</span><br><span class="line">        <span class="type">int</span> j=e[i];</span><br><span class="line">        <span class="keyword">if</span>(j==fa[u]||j==son[u])<span class="keyword">continue</span>;</span><br><span class="line">        <span class="built_in">dfs2</span>(j,j);</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">pushup</span><span class="params">(<span class="type">int</span> u)</span></span>{</span><br><span class="line">    tr[u].sum=tr[tr[u].ls].sum+tr[tr[u].rs].sum;</span><br><span class="line">    tr[u].mx=<span class="built_in">max</span>(tr[tr[u].ls].mx,tr[tr[u].rs].mx);</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">pushdown</span><span class="params">(<span class="type">int</span> u)</span></span>{</span><br><span class="line">    </span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">modify</span><span class="params">(<span class="type">int</span> &amp;o,<span class="type">int</span> l,<span class="type">int</span> r,<span class="type">int</span> i,<span class="type">int</span> k)</span></span>{</span><br><span class="line">    <span class="keyword">if</span>(!o)o=++cnt2;</span><br><span class="line">    tr[o].mx=tr[o].sum=k;</span><br><span class="line">    <span class="keyword">if</span>(l==r)<span class="keyword">return</span>;</span><br><span class="line">    <span class="comment">//pushdown(o);</span></span><br><span class="line">    <span class="type">int</span> mid=l+r&gt;&gt;<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">if</span>(i&lt;=mid)<span class="built_in">modify</span>(tr[o].ls,l,mid,i,k);</span><br><span class="line">    <span class="keyword">else</span> <span class="built_in">modify</span>(tr[o].rs,mid+<span class="number">1</span>,r,i,k);</span><br><span class="line">    <span class="built_in">pushup</span>(o);</span><br><span class="line">    <span class="comment">//if(tr[o].sum==0)o=0;</span></span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">remove</span><span class="params">(<span class="type">int</span> &amp;o,<span class="type">int</span> l,<span class="type">int</span> r,<span class="type">int</span> i,<span class="type">int</span> k=<span class="number">0</span>)</span></span>{</span><br><span class="line">    <span class="keyword">if</span>(l==r){tr[o].sum=tr[o].mx=<span class="number">0</span>;<span class="keyword">return</span>;}</span><br><span class="line">    <span class="type">int</span> mid=l+r&gt;&gt;<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">if</span>(i&lt;=mid)<span class="built_in">remove</span>(tr[o].ls,l,mid,i,k);</span><br><span class="line">    <span class="keyword">else</span> <span class="built_in">remove</span>(tr[o].rs,mid+<span class="number">1</span>,r,i,k);</span><br><span class="line">    <span class="built_in">pushup</span>(o);</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">query_max</span><span class="params">(<span class="type">int</span> u,<span class="type">int</span> ql,<span class="type">int</span> qr,<span class="type">int</span> l,<span class="type">int</span> r)</span></span>{</span><br><span class="line">    <span class="keyword">if</span>(!u)<span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    <span class="keyword">if</span>(qr&lt;l||ql&gt;r)<span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    <span class="keyword">if</span>(l&gt;=ql&amp;&amp;r&lt;=qr)<span class="keyword">return</span> tr[u].mx;</span><br><span class="line">    <span class="comment">//pushdown(u);</span></span><br><span class="line">    <span class="type">int</span> mid=l+r&gt;&gt;<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">max</span>(<span class="built_in">query_max</span>(tr[u].ls,ql,qr,l,mid),</span><br><span class="line">               <span class="built_in">query_max</span>(tr[u].rs,ql,qr,mid+<span class="number">1</span>,r));</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">query_sum</span><span class="params">(<span class="type">int</span> u,<span class="type">int</span> ql,<span class="type">int</span> qr,<span class="type">int</span> l,<span class="type">int</span> r)</span></span>{</span><br><span class="line">    <span class="keyword">if</span>(!u)<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span>(qr&lt;l||ql&gt;r)<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span>(l&gt;=ql&amp;&amp;r&lt;=qr)<span class="keyword">return</span> tr[u].sum;</span><br><span class="line">    <span class="comment">//pushdown(u);</span></span><br><span class="line">    <span class="type">int</span> mid=l+r&gt;&gt;<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">query_sum</span>(tr[u].ls,ql,qr,l,mid)+<span class="built_in">query_sum</span>(tr[u].rs,ql,qr,mid+<span class="number">1</span>,r);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">query_path_sum</span><span class="params">(<span class="type">int</span> o,<span class="type">int</span> u, <span class="type">int</span> v)</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">    <span class="type">int</span> res = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span> (top[u] != top[v])</span><br><span class="line">    {</span><br><span class="line">        <span class="keyword">if</span> (dep[top[u]]&lt;dep[top[v]])<span class="built_in">swap</span>(u, v);</span><br><span class="line">        res+=<span class="built_in">query_sum</span>(root[o],id[top[u]],id[u],<span class="number">1</span>,n);</span><br><span class="line">        u=fa[top[u]];</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">if</span> (dep[u]&gt;dep[v])<span class="built_in">swap</span>(u, v);</span><br><span class="line">    res+=<span class="built_in">query_sum</span>(root[o],id[u],id[v],<span class="number">1</span>,n);</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">query_path_max</span><span class="params">(<span class="type">int</span> o,<span class="type">int</span> u,<span class="type">int</span> v)</span></span>{</span><br><span class="line">    <span class="type">int</span> res=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(top[u]!=top[v]){</span><br><span class="line">        <span class="keyword">if</span>(dep[top[u]]&lt;dep[top[v]])<span class="built_in">swpa</span>(u,v);</span><br><span class="line">        res=<span class="built_in">max</span>(res,<span class="built_in">query_max</span>(root[o],id[top[u]],id[u],<span class="number">1</span>,n));</span><br><span class="line">        u=fa[top[u]];</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">if</span>(dep[u]&gt;dep[v])<span class="built_in">swap</span>(u,v);</span><br><span class="line">    res=<span class="built_in">max</span>(res,<span class="built_in">query_max</span>(root[o],id[u],id[v],<span class="number">1</span>,n));</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="type">signed</span> <span class="title">main</span><span class="params">()</span></span>{</span><br><span class="line">    ios::<span class="built_in">sync_with_stdio</span>(<span class="number">0</span>);cin.<span class="built_in">tie</span>(<span class="number">0</span>);cout.<span class="built_in">tie</span>(<span class="number">0</span>);</span><br><span class="line">    <span class="built_in">memset</span>(h,<span class="number">-1</span>,<span class="keyword">sizeof</span> h);</span><br><span class="line">    cin&gt;&gt;n&gt;&gt;m;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;i++)cin&gt;&gt;w[i]&gt;&gt;c[i];</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;n;i++){</span><br><span class="line">        <span class="type">int</span> a,b;</span><br><span class="line">        cin&gt;&gt;a&gt;&gt;b;</span><br><span class="line">        <span class="built_in">add</span>(a,b),<span class="built_in">add</span>(b,a);</span><br><span class="line">    }</span><br><span class="line">    <span class="built_in">dfs1</span>(<span class="number">1</span>,<span class="number">-1</span>,<span class="number">1</span>);</span><br><span class="line">    <span class="built_in">dfs2</span>(<span class="number">1</span>,<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;i++)<span class="built_in">modify</span>(root[c[i]],<span class="number">1</span>,n,id[i],w[i]);</span><br><span class="line">    <span class="keyword">while</span>(m--){</span><br><span class="line">        string op;</span><br><span class="line">        <span class="type">int</span> x,y;</span><br><span class="line">        cin&gt;&gt;op&gt;&gt;x&gt;&gt;y;</span><br><span class="line">        <span class="keyword">if</span>(op[<span class="number">1</span>]==<span class="string">'C'</span>)<span class="built_in">remove</span>(root[c[x]],<span class="number">1</span>,n,id[x]),<span class="built_in">modify</span>(root[y],<span class="number">1</span>,n,id[x],w[x]),c[x]=y;</span><br><span class="line">        <span class="keyword">if</span>(op[<span class="number">1</span>]==<span class="string">'W'</span>)<span class="built_in">remove</span>(root[c[x]],<span class="number">1</span>,n,id[x]),<span class="built_in">modify</span>(root[c[x]],<span class="number">1</span>,n,id[x],y),w[x]=y;</span><br><span class="line">        <span class="keyword">if</span>(op[<span class="number">1</span>]==<span class="string">'S'</span>)cout&lt;&lt;<span class="built_in">query_path_sum</span>(c[x],x,y)&lt;&lt;<span class="string">'\n'</span>;</span><br><span class="line">        <span class="keyword">if</span>(op[<span class="number">1</span>]==<span class="string">'M'</span>)cout&lt;&lt;<span class="built_in">query_path_max</span>(c[x],x,y)&lt;&lt;<span class="string">'\n'</span>;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><hr><p><img src="https://img-blog.csdnimg.cn/49937fde554f4e4589edf8f3b4634b66.png" alt="在这里插入图片描述"></p><p>这种题可以套板子来写</p><p>如果有颜色的限制就开个color数组读入颜色，如果没有颜色的限制就把color数组全部置为1</p><p>注意如果点权有负数的情况更新最大值的时候是要把-1和0变为-1e9</p><figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="keyword">define</span> swpa swap</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> remove _</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> int long long</span></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N = <span class="number">2e6</span>+<span class="number">10</span>, M=N*<span class="number">2</span>;</span><br><span class="line"><span class="type">int</span> n,m,cnt2;</span><br><span class="line"><span class="type">int</span> w[N],h[N],ne[M],e[M],idx;</span><br><span class="line"><span class="type">int</span> id[N],nw[N],cnt;</span><br><span class="line"><span class="type">int</span> dep[N],sz[N],top[N],fa[N],son[N];</span><br><span class="line"><span class="type">int</span> root[N];</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Tree</span>{</span><br><span class="line">    <span class="type">int</span> ls,rs;</span><br><span class="line">    <span class="type">int</span> sum,mx;</span><br><span class="line">}tr[N*<span class="number">4</span>];</span><br><span class="line"><span class="type">int</span> c[N];</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">add</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> b)</span>  </span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">    e[idx] = b, ne[idx] = h[a], h[a] = idx ++ ;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">dfs1</span><span class="params">(<span class="type">int</span> u,<span class="type">int</span> father,<span class="type">int</span> depth)</span></span>{</span><br><span class="line">    dep[u]=depth,fa[u]=father,sz[u]=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=h[u];~i;i=ne[i]){</span><br><span class="line">        <span class="type">int</span> j=e[i];</span><br><span class="line">        <span class="keyword">if</span>(j==father)<span class="keyword">continue</span>;</span><br><span class="line">        <span class="built_in">dfs1</span>(j,u,depth+<span class="number">1</span>);</span><br><span class="line">        sz[u]+=sz[j];</span><br><span class="line">        <span class="keyword">if</span>(sz[son[u]]&lt;sz[j])son[u]=j;</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">dfs2</span><span class="params">(<span class="type">int</span> u,<span class="type">int</span> t)</span></span>{</span><br><span class="line">    id[u]=++cnt,nw[cnt]=w[u],top[u]=t;</span><br><span class="line">    <span class="comment">//who[cnt]=u;</span></span><br><span class="line">    <span class="keyword">if</span>(!son[u])<span class="keyword">return</span>;</span><br><span class="line">    <span class="built_in">dfs2</span>(son[u],t);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=h[u];~i;i=ne[i]){</span><br><span class="line">        <span class="type">int</span> j=e[i];</span><br><span class="line">        <span class="keyword">if</span>(j==fa[u]||j==son[u])<span class="keyword">continue</span>;</span><br><span class="line">        <span class="built_in">dfs2</span>(j,j);</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">pushup</span><span class="params">(<span class="type">int</span> u)</span></span>{</span><br><span class="line">    tr[u].sum=tr[tr[u].ls].sum+tr[tr[u].rs].sum;</span><br><span class="line">    tr[u].mx=<span class="built_in">max</span>(tr[tr[u].ls].mx,tr[tr[u].rs].mx);</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">pushdown</span><span class="params">(<span class="type">int</span> u)</span></span>{</span><br><span class="line">    </span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">modify</span><span class="params">(<span class="type">int</span> &amp;o,<span class="type">int</span> l,<span class="type">int</span> r,<span class="type">int</span> i,<span class="type">int</span> k)</span></span>{</span><br><span class="line">    <span class="keyword">if</span>(!o)o=++cnt2;</span><br><span class="line">    tr[o].mx=tr[o].sum=k;</span><br><span class="line">    <span class="keyword">if</span>(l==r)<span class="keyword">return</span>;</span><br><span class="line">    <span class="comment">//pushdown(o);</span></span><br><span class="line">    <span class="type">int</span> mid=l+r&gt;&gt;<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">if</span>(i&lt;=mid)<span class="built_in">modify</span>(tr[o].ls,l,mid,i,k);</span><br><span class="line">    <span class="keyword">else</span> <span class="built_in">modify</span>(tr[o].rs,mid+<span class="number">1</span>,r,i,k);</span><br><span class="line">    <span class="built_in">pushup</span>(o);</span><br><span class="line">    <span class="comment">//if(tr[o].sum==0)o=0;</span></span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">remove</span><span class="params">(<span class="type">int</span> &amp;o,<span class="type">int</span> l,<span class="type">int</span> r,<span class="type">int</span> i,<span class="type">int</span> k=<span class="number">0</span>)</span></span>{</span><br><span class="line">    <span class="keyword">if</span>(l==r){tr[o].sum=tr[o].mx=<span class="number">0</span>;<span class="keyword">return</span>;}</span><br><span class="line">    <span class="type">int</span> mid=l+r&gt;&gt;<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">if</span>(i&lt;=mid)<span class="built_in">remove</span>(tr[o].ls,l,mid,i,k);</span><br><span class="line">    <span class="keyword">else</span> <span class="built_in">remove</span>(tr[o].rs,mid+<span class="number">1</span>,r,i,k);</span><br><span class="line">    <span class="built_in">pushup</span>(o);</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">query_max</span><span class="params">(<span class="type">int</span> u,<span class="type">int</span> ql,<span class="type">int</span> qr,<span class="type">int</span> l,<span class="type">int</span> r)</span></span>{</span><br><span class="line">    <span class="keyword">if</span>(!u)<span class="keyword">return</span> <span class="number">-1e9</span>;</span><br><span class="line">    <span class="keyword">if</span>(qr&lt;l||ql&gt;r)<span class="keyword">return</span> <span class="number">-1e9</span>;</span><br><span class="line">    <span class="keyword">if</span>(l&gt;=ql&amp;&amp;r&lt;=qr)<span class="keyword">return</span> tr[u].mx;</span><br><span class="line">    <span class="comment">//pushdown(u);</span></span><br><span class="line">    <span class="type">int</span> mid=l+r&gt;&gt;<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">max</span>(<span class="built_in">query_max</span>(tr[u].ls,ql,qr,l,mid),</span><br><span class="line">               <span class="built_in">query_max</span>(tr[u].rs,ql,qr,mid+<span class="number">1</span>,r));</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">query_sum</span><span class="params">(<span class="type">int</span> u,<span class="type">int</span> ql,<span class="type">int</span> qr,<span class="type">int</span> l,<span class="type">int</span> r)</span></span>{</span><br><span class="line">    <span class="keyword">if</span>(!u)<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span>(qr&lt;l||ql&gt;r)<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span>(l&gt;=ql&amp;&amp;r&lt;=qr)<span class="keyword">return</span> tr[u].sum;</span><br><span class="line">    <span class="comment">//pushdown(u);</span></span><br><span class="line">    <span class="type">int</span> mid=l+r&gt;&gt;<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">query_sum</span>(tr[u].ls,ql,qr,l,mid)+<span class="built_in">query_sum</span>(tr[u].rs,ql,qr,mid+<span class="number">1</span>,r);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">query_path_sum</span><span class="params">(<span class="type">int</span> o,<span class="type">int</span> u, <span class="type">int</span> v)</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">    <span class="type">int</span> res = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span> (top[u] != top[v])</span><br><span class="line">    {</span><br><span class="line">        <span class="keyword">if</span> (dep[top[u]]&lt;dep[top[v]])<span class="built_in">swap</span>(u, v);</span><br><span class="line">        res+=<span class="built_in">query_sum</span>(root[o],id[top[u]],id[u],<span class="number">1</span>,n);</span><br><span class="line">        u=fa[top[u]];</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">if</span> (dep[u]&gt;dep[v])<span class="built_in">swap</span>(u, v);</span><br><span class="line">    res+=<span class="built_in">query_sum</span>(root[o],id[u],id[v],<span class="number">1</span>,n);</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">query_path_max</span><span class="params">(<span class="type">int</span> o,<span class="type">int</span> u,<span class="type">int</span> v)</span></span>{</span><br><span class="line">    <span class="type">int</span> res=<span class="number">-1e9</span>;</span><br><span class="line">    <span class="keyword">while</span>(top[u]!=top[v]){</span><br><span class="line">        <span class="keyword">if</span>(dep[top[u]]&lt;dep[top[v]])<span class="built_in">swpa</span>(u,v);</span><br><span class="line">        res=<span class="built_in">max</span>(res,<span class="built_in">query_max</span>(root[o],id[top[u]],id[u],<span class="number">1</span>,n));</span><br><span class="line">        u=fa[top[u]];</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">if</span>(dep[u]&gt;dep[v])<span class="built_in">swap</span>(u,v);</span><br><span class="line">    res=<span class="built_in">max</span>(res,<span class="built_in">query_max</span>(root[o],id[u],id[v],<span class="number">1</span>,n));</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="type">signed</span> <span class="title">main</span><span class="params">()</span></span>{</span><br><span class="line">    ios::<span class="built_in">sync_with_stdio</span>(<span class="number">0</span>);cin.<span class="built_in">tie</span>(<span class="number">0</span>);cout.<span class="built_in">tie</span>(<span class="number">0</span>);</span><br><span class="line">    <span class="built_in">memset</span>(h,<span class="number">-1</span>,<span class="keyword">sizeof</span> h);</span><br><span class="line">    cin&gt;&gt;n;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;n;i++){</span><br><span class="line">        <span class="type">int</span> a,b;</span><br><span class="line">        cin&gt;&gt;a&gt;&gt;b;</span><br><span class="line">        <span class="built_in">add</span>(a,b),<span class="built_in">add</span>(b,a);</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;i++)cin&gt;&gt;w[i];</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;i++)c[i]=<span class="number">1</span>;</span><br><span class="line">    <span class="built_in">dfs1</span>(<span class="number">1</span>,<span class="number">-1</span>,<span class="number">1</span>);</span><br><span class="line">    <span class="built_in">dfs2</span>(<span class="number">1</span>,<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;i++)<span class="built_in">modify</span>(root[c[i]],<span class="number">1</span>,n,id[i],w[i]);</span><br><span class="line">    cin&gt;&gt;m;</span><br><span class="line">    <span class="keyword">while</span>(m--){</span><br><span class="line">        string op;</span><br><span class="line">        <span class="type">int</span> x,y;</span><br><span class="line">        cin&gt;&gt;op&gt;&gt;x&gt;&gt;y;</span><br><span class="line">        <span class="comment">//if(op=="CHANGE")remove(root[c[x]],1,n,id[x]),modify(root[y],1,n,id[x],w[x]),c[x]=y;</span></span><br><span class="line">        <span class="keyword">if</span>(op==<span class="string">"CHANGE"</span>)<span class="built_in">remove</span>(root[c[x]],<span class="number">1</span>,n,id[x]),<span class="built_in">modify</span>(root[c[x]],<span class="number">1</span>,n,id[x],y),w[x]=y;</span><br><span class="line">        <span class="keyword">if</span>(op==<span class="string">"QSUM"</span>)cout&lt;&lt;<span class="built_in">query_path_sum</span>(c[x],x,y)&lt;&lt;<span class="string">'\n'</span>;</span><br><span class="line">        <span class="keyword">if</span>(op==<span class="string">"QMAX"</span>)cout&lt;&lt;<span class="built_in">query_path_max</span>(c[x],x,y)&lt;&lt;<span class="string">'\n'</span>;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><hr><h2 id="倍增求LCA，树上差分"><a href="#倍增求LCA，树上差分" class="headerlink" title="倍增求LCA，树上差分"></a>倍增求LCA，树上差分</h2><p><img src="https://img-blog.csdnimg.cn/b0aaf2728e4043bcb2b2d280e93e98d5.png" alt="在这里插入图片描述"><br>每一个点除了起点，都会作为新的起点多了一个1，所以要求出最终答案后减去<br>按照题意，终点不用给糖果所以第n个点也要减去一个1</p><figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N=<span class="number">1e6</span>+<span class="number">10</span>,M=<span class="number">2</span>*N;</span><br><span class="line"><span class="type">int</span> h[N],e[M],ne[M],idx,n;</span><br><span class="line"><span class="type">int</span> fa[N][<span class="number">31</span>],ans[N],a[N],dep[N];</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">add</span><span class="params">(<span class="type">int</span> a,<span class="type">int</span> b)</span></span>{</span><br><span class="line">    e[++idx]=b,ne[idx]=h[a],h[a]=idx;</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">dfs</span><span class="params">(<span class="type">int</span> u,<span class="type">int</span> father=<span class="number">0</span>)</span></span>{</span><br><span class="line">    dep[u]=dep[father]+<span class="number">1</span>,fa[u][<span class="number">0</span>]=father;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=<span class="number">30</span>;i++){</span><br><span class="line">        fa[u][i]=fa[fa[u][i<span class="number">-1</span>]][i<span class="number">-1</span>];</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=h[u];i;i=ne[i]){</span><br><span class="line">        <span class="type">int</span> j=e[i];</span><br><span class="line">        <span class="keyword">if</span>(j==father)<span class="keyword">continue</span>;</span><br><span class="line">        <span class="built_in">dfs</span>(j,u);</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">lca</span><span class="params">(<span class="type">int</span> x,<span class="type">int</span> y)</span></span>{</span><br><span class="line">    <span class="keyword">if</span>(dep[x]&lt;dep[y])<span class="built_in">swap</span>(x,y);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">30</span>;i&gt;=<span class="number">0</span>;i--){</span><br><span class="line">        <span class="keyword">if</span>(dep[fa[x][i]]&gt;=dep[y])x=fa[x][i];</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">if</span>(x==y)<span class="keyword">return</span> x;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">30</span>;i&gt;=<span class="number">0</span>;i--){</span><br><span class="line">        <span class="keyword">if</span>(fa[x][i]!=fa[y][i])x=fa[x][i],y=fa[y][i];</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> fa[x][<span class="number">0</span>];</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">cal</span><span class="params">(<span class="type">int</span> u,<span class="type">int</span> father=<span class="number">0</span>)</span></span>{</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=h[u];i;i=ne[i]){</span><br><span class="line">        <span class="type">int</span> j=e[i];</span><br><span class="line">        <span class="keyword">if</span>(j==father)<span class="keyword">continue</span>;</span><br><span class="line">        <span class="built_in">cal</span>(j,u);</span><br><span class="line">        ans[u]+=ans[j];</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="type">signed</span> <span class="title">main</span><span class="params">()</span></span>{</span><br><span class="line">    ios::<span class="built_in">sync_with_stdio</span>(<span class="number">0</span>);cin.<span class="built_in">tie</span>(<span class="number">0</span>);cout.<span class="built_in">tie</span>(<span class="number">0</span>);</span><br><span class="line">    cin&gt;&gt;n;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;i++)cin&gt;&gt;a[i];</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;n;i++){</span><br><span class="line">        <span class="type">int</span> x,y;</span><br><span class="line">        cin&gt;&gt;x&gt;&gt;y;</span><br><span class="line">        <span class="built_in">add</span>(x,y);</span><br><span class="line">        <span class="built_in">add</span>(y,x);</span><br><span class="line">    }</span><br><span class="line">    <span class="built_in">dfs</span>(<span class="number">1</span>,<span class="number">0</span>);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;n;i++){</span><br><span class="line">        <span class="type">int</span> x=a[i],y=a[i+<span class="number">1</span>];</span><br><span class="line">        <span class="type">int</span> t=<span class="built_in">lca</span>(x,y);</span><br><span class="line">        ans[x]++;</span><br><span class="line">        ans[y]++;</span><br><span class="line">        ans[t]--;</span><br><span class="line">        ans[fa[t][<span class="number">0</span>]]--;</span><br><span class="line">    }</span><br><span class="line">    <span class="built_in">cal</span>(<span class="number">1</span>,<span class="number">0</span>);</span><br><span class="line">    <span class="comment">//除了第一个作为起点以外，其他的所有点都会作为新的起点被计算多次</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">2</span>;i&lt;=n;i++)ans[a[i]]--;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;i++)cout&lt;&lt;ans[i]&lt;&lt;<span class="string">'\n'</span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><hr>]]></content>
      
      
      <categories>
          
          <category> 算法 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 数据结构 </tag>
            
            <tag> 树链剖分 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>线段树</title>
      <link href="/2022/05/13/xian-duan-shu/"/>
      <url>/2022/05/13/xian-duan-shu/</url>
      
        <content type="html"><![CDATA[<h1 id="线段树"><a href="#线段树" class="headerlink" title="线段树"></a>线段树</h1><h2 id="动态开点"><a href="#动态开点" class="headerlink" title="动态开点"></a>动态开点</h2><p><img src="https://img-blog.csdnimg.cn/69e5c9f3080547aa8212e9f29dcab37c.png" alt="在这里插入图片描述"></p><figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N=<span class="number">1e7</span>+<span class="number">5e6</span>+<span class="number">10</span>;</span><br><span class="line"><span class="type">int</span> ls[N],rs[N],root,sum[N],idx,lazy[N];</span><br><span class="line"><span class="type">int</span> n,q,ql,qr,k;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">pushup</span><span class="params">(<span class="type">int</span> u)</span></span>{</span><br><span class="line">    sum[u]=sum[ls[u]]+sum[rs[u]];</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">pushdown</span><span class="params">(<span class="type">int</span> u,<span class="type">int</span> l,<span class="type">int</span> r)</span></span>{</span><br><span class="line">    <span class="keyword">if</span>(lazy[u]==<span class="number">-1</span>)<span class="keyword">return</span>;</span><br><span class="line">    <span class="keyword">if</span>(!ls[u])ls[u]=++idx;</span><br><span class="line">    <span class="keyword">if</span>(!rs[u])rs[u]=++idx;</span><br><span class="line">    lazy[ls[u]]=lazy[rs[u]]=lazy[u];</span><br><span class="line">    <span class="type">int</span> mid=l+r&gt;&gt;<span class="number">1</span>;</span><br><span class="line">    sum[ls[u]]=(mid-l+<span class="number">1</span>)*lazy[u];</span><br><span class="line">    sum[rs[u]]=(r-mid)*lazy[u];</span><br><span class="line">    lazy[u]=<span class="number">-1</span>;</span><br><span class="line">    <span class="comment">//动态开点的结点是不能写成递归的形式，要确切给定操作区间</span></span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">modify</span><span class="params">(<span class="type">int</span> &amp;u,<span class="type">int</span> l,<span class="type">int</span> r,<span class="type">int</span> ql,<span class="type">int</span> qr,<span class="type">int</span> k)</span></span>{</span><br><span class="line">    <span class="keyword">if</span>(!u)u=++idx;</span><br><span class="line">    <span class="keyword">if</span>(r&lt;ql||l&gt;qr)<span class="keyword">return</span>;</span><br><span class="line">    <span class="keyword">if</span>(l&gt;=ql&amp;&amp;r&lt;=qr){</span><br><span class="line">        sum[u]=(r-l+<span class="number">1</span>)*k;</span><br><span class="line">        lazy[u]=k;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="built_in">pushdown</span>(u,l,r);</span><br><span class="line">    <span class="type">int</span> mid=l+r&gt;&gt;<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">if</span>(ql&lt;=mid)<span class="built_in">modify</span>(ls[u],l,mid,ql,qr,k);</span><br><span class="line">    <span class="keyword">if</span>(qr&gt;mid)<span class="built_in">modify</span>(rs[u],mid+<span class="number">1</span>,r,ql,qr,k);</span><br><span class="line">    <span class="built_in">pushup</span>(u);</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="type">signed</span> <span class="title">main</span><span class="params">()</span></span>{</span><br><span class="line">    ios::<span class="built_in">sync_with_stdio</span>(<span class="number">0</span>);cin.<span class="built_in">tie</span>(<span class="number">0</span>);cout.<span class="built_in">tie</span>(<span class="number">0</span>);</span><br><span class="line">    cin&gt;&gt;n&gt;&gt;q;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;N;i++)lazy[i]=<span class="number">-1</span>;</span><br><span class="line">    <span class="built_in">modify</span>(root,<span class="number">1</span>,n,<span class="number">1</span>,n,<span class="number">0</span>);</span><br><span class="line">    <span class="comment">//根节点为root的点占据的区间是1-n</span></span><br><span class="line">    <span class="comment">//这个操作是把【1，n】这个区间推平为0</span></span><br><span class="line">    <span class="keyword">while</span>(q--){</span><br><span class="line">        cin&gt;&gt;ql&gt;&gt;qr&gt;&gt;k;</span><br><span class="line">        <span class="built_in">modify</span>(root,<span class="number">1</span>,n,ql,qr,<span class="number">2</span>-k);</span><br><span class="line">        cout&lt;&lt;n-sum[root]&lt;&lt;<span class="string">'\n'</span>;</span><br><span class="line">    }</span><br><span class="line">    </span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><hr><h2 id="把边权化为点权"><a href="#把边权化为点权" class="headerlink" title="把边权化为点权"></a>把边权化为点权</h2><p><img src="https://img-blog.csdnimg.cn/5c4fce11116f4c9185be96ca3e690d22.png" alt="在这里插入图片描述"><br><img src="https://img-blog.csdnimg.cn/3770161ac3014d808af997da8998444f.png" alt="在这里插入图片描述"></p><figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> int long long</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N=<span class="number">1e6</span>+<span class="number">10</span>,M=<span class="number">2</span>*N;</span><br><span class="line"><span class="type">int</span> h[N],e[M],ne[M],w[M],idx,cnt,fa[N],top[N],nw[N],dep[N],tmp[N];</span><br><span class="line"><span class="type">int</span> id[N],sz[N],son[N];</span><br><span class="line"><span class="keyword">typedef</span> pair&lt;<span class="type">int</span>, <span class="type">int</span>&gt; PII;</span><br><span class="line">PII ab[N];</span><br><span class="line"><span class="type">int</span> n,x,y,a,b,c,m;</span><br><span class="line">string op;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">node</span>{</span><br><span class="line">    <span class="type">int</span> sum,max,min,lazy;</span><br><span class="line">}t[N*<span class="number">4</span>];</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">add</span><span class="params">(<span class="type">int</span> a,<span class="type">int</span> b,<span class="type">int</span> c)</span></span>{</span><br><span class="line">    e[++idx]=b,w[idx]=c,ne[idx]=h[a],h[a]=idx;</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">dfs1</span><span class="params">(<span class="type">int</span> u,<span class="type">int</span> father)</span></span>{</span><br><span class="line">    dep[u]=dep[father]+<span class="number">1</span>,fa[u]=father,sz[u]=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=h[u];i;i=ne[i]){</span><br><span class="line">        <span class="type">int</span> j=e[i];</span><br><span class="line">        <span class="keyword">if</span>(j==father)<span class="keyword">continue</span>;</span><br><span class="line">        <span class="built_in">dfs1</span>(j,u);</span><br><span class="line">        tmp[j]=w[i];</span><br><span class="line">        sz[u]+=sz[j];</span><br><span class="line">        <span class="keyword">if</span>(sz[son[u]]&lt;sz[j])son[u]=j;</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">dfs2</span><span class="params">(<span class="type">int</span> x,<span class="type">int</span> t)</span></span>{</span><br><span class="line">    id[x]=++cnt,nw[cnt]=tmp[x],top[x]=t;</span><br><span class="line">    <span class="keyword">if</span>(son[x])<span class="built_in">dfs2</span>(son[x],t);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=h[x];i;i=ne[i]){</span><br><span class="line">        <span class="type">int</span> j=e[i];</span><br><span class="line">        <span class="keyword">if</span>(j==fa[x]||j==son[x])<span class="keyword">continue</span>;</span><br><span class="line">        <span class="built_in">dfs2</span>(j,j);</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">pushup</span><span class="params">(<span class="type">int</span> u)</span></span>{</span><br><span class="line">    t[u].sum=t[u&lt;&lt;<span class="number">1</span>].sum+t[u&lt;&lt;<span class="number">1</span>|<span class="number">1</span>].sum;</span><br><span class="line">    t[u].max=<span class="built_in">max</span>(t[u&lt;&lt;<span class="number">1</span>].max,t[u&lt;&lt;<span class="number">1</span>|<span class="number">1</span>].max);</span><br><span class="line">    t[u].min=<span class="built_in">min</span>(t[u&lt;&lt;<span class="number">1</span>].min,t[u&lt;&lt;<span class="number">1</span>|<span class="number">1</span>].min);</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">pushdown</span><span class="params">(<span class="type">int</span> u)</span></span>{</span><br><span class="line">    <span class="keyword">if</span>(t[u].lazy==<span class="number">0</span>)<span class="keyword">return</span>;</span><br><span class="line">    <span class="keyword">auto</span> &amp;L=t[u&lt;&lt;<span class="number">1</span>];</span><br><span class="line">    <span class="keyword">auto</span> &amp;R=t[u&lt;&lt;<span class="number">1</span>|<span class="number">1</span>];</span><br><span class="line">    L.lazy^=<span class="number">1</span>,R.lazy^=<span class="number">1</span>;</span><br><span class="line">    L.sum=-L.sum,L.max=-L.max,L.min=-L.min;</span><br><span class="line">    R.sum=-R.sum,R.max=-R.max,R.min=-R.min;</span><br><span class="line">    <span class="built_in">swap</span>(L.max,L.min),<span class="built_in">swap</span>(R.max,R.min);</span><br><span class="line">    t[u].lazy=<span class="number">0</span>;</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">build</span><span class="params">(<span class="type">int</span> u=<span class="number">1</span>,<span class="type">int</span> l=<span class="number">1</span>,<span class="type">int</span> r=n)</span></span>{</span><br><span class="line">    t[u]={nw[l],nw[l],nw[l]};</span><br><span class="line">    <span class="keyword">if</span>(l&gt;=r)<span class="keyword">return</span>;</span><br><span class="line">    <span class="type">int</span> mid=l+r&gt;&gt;<span class="number">1</span>;</span><br><span class="line">    <span class="built_in">build</span>(u&lt;&lt;<span class="number">1</span>,l,mid),<span class="built_in">build</span>(u&lt;&lt;<span class="number">1</span>|<span class="number">1</span>,mid+<span class="number">1</span>,r);</span><br><span class="line">    <span class="built_in">pushup</span>(u);</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">modify</span><span class="params">(<span class="type">int</span> u,<span class="type">int</span> l,<span class="type">int</span> r,<span class="type">int</span> i,<span class="type">int</span> k)</span></span>{</span><br><span class="line">    <span class="keyword">if</span>(l==r){</span><br><span class="line">        t[u].sum=t[u].max=t[u].min=k;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="built_in">pushdown</span>(u);</span><br><span class="line">    <span class="type">int</span> mid=l+r&gt;&gt;<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">if</span>(i&lt;=mid)<span class="built_in">modify</span>(u&lt;&lt;<span class="number">1</span>,l,mid,i,k);</span><br><span class="line">    <span class="keyword">else</span> <span class="built_in">modify</span>(u&lt;&lt;<span class="number">1</span>|<span class="number">1</span>,mid+<span class="number">1</span>,r,i,k);</span><br><span class="line">    <span class="built_in">pushup</span>(u);</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">update</span><span class="params">(<span class="type">int</span> u,<span class="type">int</span> l,<span class="type">int</span> r,<span class="type">int</span> ql,<span class="type">int</span> qr,<span class="type">int</span> lazy=<span class="number">1</span>)</span></span>{</span><br><span class="line">    <span class="keyword">if</span>(l&gt;qr||r&lt;ql)<span class="keyword">return</span>;</span><br><span class="line">    <span class="keyword">if</span>(l&gt;=ql&amp;&amp;r&lt;=qr){</span><br><span class="line">        t[u].sum=-t[u].sum;</span><br><span class="line">        t[u].max=-t[u].max;</span><br><span class="line">        t[u].min=-t[u].min;</span><br><span class="line">        <span class="built_in">swap</span>(t[u].max,t[u].min);</span><br><span class="line">        t[u].lazy^=<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="built_in">pushdown</span>(u);</span><br><span class="line">    <span class="type">int</span> mid=l+r&gt;&gt;<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">if</span>(ql&lt;=mid)<span class="built_in">update</span>(u&lt;&lt;<span class="number">1</span>,l,mid,ql,qr);</span><br><span class="line">    <span class="keyword">if</span>(qr&gt;mid)<span class="built_in">update</span>(u&lt;&lt;<span class="number">1</span>|<span class="number">1</span>,mid+<span class="number">1</span>,r,ql,qr);</span><br><span class="line">    <span class="built_in">pushup</span>(u);</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">qmax</span><span class="params">(<span class="type">int</span> u,<span class="type">int</span> l,<span class="type">int</span> r,<span class="type">int</span> ql,<span class="type">int</span> qr)</span></span>{</span><br><span class="line">    <span class="keyword">if</span>(l&gt;qr||r&lt;ql)<span class="keyword">return</span> <span class="number">-1e9</span>;</span><br><span class="line">    <span class="keyword">if</span>(l&gt;=ql&amp;&amp;r&lt;=qr)<span class="keyword">return</span> t[u].max;</span><br><span class="line">    <span class="built_in">pushdown</span>(u);</span><br><span class="line">    <span class="type">int</span> mid=l+r&gt;&gt;<span class="number">1</span>;</span><br><span class="line">    <span class="type">int</span> ans=<span class="number">-1e9</span>;</span><br><span class="line">    <span class="keyword">if</span>(ql&lt;=mid)ans=<span class="built_in">max</span>(ans,<span class="built_in">qmax</span>(u&lt;&lt;<span class="number">1</span>,l,mid,ql,qr));</span><br><span class="line">    <span class="keyword">if</span>(qr&gt; mid)ans=<span class="built_in">max</span>(ans,<span class="built_in">qmax</span>(u&lt;&lt;<span class="number">1</span>|<span class="number">1</span>,mid+<span class="number">1</span>,r,ql,qr));</span><br><span class="line">    <span class="keyword">return</span> ans;</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">qmin</span><span class="params">(<span class="type">int</span> u,<span class="type">int</span> l,<span class="type">int</span> r,<span class="type">int</span> ql,<span class="type">int</span> qr)</span></span>{</span><br><span class="line">    <span class="keyword">if</span>(l&gt;qr||r&lt;ql)<span class="keyword">return</span> <span class="number">1e9</span>;</span><br><span class="line">    <span class="keyword">if</span>(l&gt;=ql&amp;&amp;r&lt;=qr)<span class="keyword">return</span> t[u].min;</span><br><span class="line">    <span class="built_in">pushdown</span>(u);</span><br><span class="line">    <span class="type">int</span> mid=l+r&gt;&gt;<span class="number">1</span>;</span><br><span class="line">    <span class="type">int</span> ans=<span class="number">1e9</span>;</span><br><span class="line">    <span class="keyword">if</span>(ql&lt;=mid)ans=<span class="built_in">min</span>(ans,<span class="built_in">qmin</span>(u&lt;&lt;<span class="number">1</span>,l,mid,ql,qr));</span><br><span class="line">    <span class="keyword">if</span>(qr&gt; mid)ans=<span class="built_in">min</span>(ans,<span class="built_in">qmin</span>(u&lt;&lt;<span class="number">1</span>|<span class="number">1</span>,mid+<span class="number">1</span>,r,ql,qr));</span><br><span class="line">    <span class="keyword">return</span> ans;</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">qsum</span><span class="params">(<span class="type">int</span> u,<span class="type">int</span> l,<span class="type">int</span> r,<span class="type">int</span> ql,<span class="type">int</span> qr)</span></span>{</span><br><span class="line">    <span class="keyword">if</span>(l&gt;qr||r&lt;ql)<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span>(l&gt;=ql&amp;&amp;r&lt;=qr)<span class="keyword">return</span> t[u].sum;</span><br><span class="line">    <span class="built_in">pushdown</span>(u);</span><br><span class="line">    <span class="type">int</span> mid=l+r&gt;&gt;<span class="number">1</span>;</span><br><span class="line">    <span class="type">int</span> ans=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span>(ql&lt;=mid)ans+=<span class="built_in">qsum</span>(u&lt;&lt;<span class="number">1</span>,l,mid,ql,qr);</span><br><span class="line">    <span class="keyword">if</span>(qr&gt; mid)ans+=<span class="built_in">qsum</span>(u&lt;&lt;<span class="number">1</span>|<span class="number">1</span>,mid+<span class="number">1</span>,r,ql,qr);</span><br><span class="line">    <span class="keyword">return</span> ans;</span><br><span class="line">}</span><br><span class="line"><span class="comment">/* 上面是线段树，下面是树链剖分*/</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">update</span><span class="params">(<span class="type">int</span> x,<span class="type">int</span> y)</span></span>{</span><br><span class="line">    <span class="keyword">while</span>(top[x]!=top[y]){</span><br><span class="line">        <span class="keyword">if</span>(dep[top[x]]&lt;dep[top[y]])<span class="built_in">swap</span>(x,y);</span><br><span class="line">        <span class="built_in">update</span>(<span class="number">1</span>,<span class="number">1</span>,n,id[top[x]],id[x]);</span><br><span class="line">        x=fa[top[x]];</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">if</span>(dep[x]&gt;dep[y])<span class="built_in">swap</span>(x,y);</span><br><span class="line">    <span class="keyword">if</span>(x!=y)<span class="built_in">update</span>(<span class="number">1</span>,<span class="number">1</span>,n,id[x]+<span class="number">1</span>,id[y]);</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">qmax</span><span class="params">(<span class="type">int</span> x,<span class="type">int</span> y)</span></span>{</span><br><span class="line">    <span class="type">int</span> ans=<span class="number">-1e9</span>;</span><br><span class="line">    <span class="keyword">while</span>(top[x]!=top[y]){</span><br><span class="line">        <span class="keyword">if</span>(dep[top[x]]&lt;dep[top[y]])<span class="built_in">swap</span>(x,y);</span><br><span class="line">        ans=<span class="built_in">max</span>(ans, <span class="built_in">qmax</span>(<span class="number">1</span>,<span class="number">1</span>,n,id[top[x]],id[x]) );</span><br><span class="line">        x=fa[top[x]];</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">if</span>(dep[x]&gt;dep[y])<span class="built_in">swap</span>(x,y);</span><br><span class="line">    <span class="keyword">if</span>(x!=y)ans=<span class="built_in">max</span>(ans,<span class="built_in">qmax</span>(<span class="number">1</span>,<span class="number">1</span>,n,id[x]+<span class="number">1</span>,id[y]));</span><br><span class="line">    <span class="keyword">return</span> ans;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">qmin</span><span class="params">(<span class="type">int</span> x,<span class="type">int</span> y)</span></span>{</span><br><span class="line">    <span class="type">int</span> ans=<span class="number">1e9</span>;</span><br><span class="line">    <span class="keyword">while</span>(top[x]!=top[y]){</span><br><span class="line">        <span class="keyword">if</span>(dep[top[x]]&lt;dep[top[y]])<span class="built_in">swap</span>(x,y);</span><br><span class="line">        ans=<span class="built_in">min</span>(ans, <span class="built_in">qmin</span>(<span class="number">1</span>,<span class="number">1</span>,n,id[top[x]],id[x]));</span><br><span class="line">        x=fa[top[x]];</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">if</span>(dep[x]&gt;dep[y])<span class="built_in">swap</span>(x,y);</span><br><span class="line">    <span class="keyword">if</span>(x!=y)ans=<span class="built_in">min</span>(ans,<span class="built_in">qmin</span>(<span class="number">1</span>,<span class="number">1</span>,n,id[x]+<span class="number">1</span>,id[y]));</span><br><span class="line">    <span class="keyword">return</span> ans;</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">qsum</span><span class="params">(<span class="type">int</span> x,<span class="type">int</span> y)</span></span>{</span><br><span class="line">    <span class="type">int</span> ans=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(top[x]!=top[y]){</span><br><span class="line">        <span class="keyword">if</span>(dep[top[x]]&lt;dep[top[y]])<span class="built_in">swap</span>(x,y);</span><br><span class="line">        ans+=<span class="built_in">qsum</span>(<span class="number">1</span>,<span class="number">1</span>,n,id[top[x]],id[x]);</span><br><span class="line">        x=fa[top[x]];</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">if</span>(dep[x]&gt;dep[y])<span class="built_in">swap</span>(x,y);</span><br><span class="line">    <span class="keyword">if</span>(x!=y)ans+=<span class="built_in">qsum</span>(<span class="number">1</span>,<span class="number">1</span>,n,id[x]+<span class="number">1</span>,id[y]);</span><br><span class="line">    <span class="keyword">return</span> ans;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">signed</span> <span class="title">main</span><span class="params">()</span></span>{</span><br><span class="line">    ios::<span class="built_in">sync_with_stdio</span>(<span class="number">0</span>);</span><br><span class="line">    cin.<span class="built_in">tie</span>(<span class="number">0</span>);</span><br><span class="line">    cout.<span class="built_in">tie</span>(<span class="number">0</span>);</span><br><span class="line">    cin&gt;&gt;n;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;n;i++){</span><br><span class="line">        cin&gt;&gt;a&gt;&gt;b&gt;&gt;c;</span><br><span class="line">        a++,b++;</span><br><span class="line">        ab[i]={a,b};</span><br><span class="line">        <span class="built_in">add</span>(a,b,c);</span><br><span class="line">        <span class="built_in">add</span>(b,a,c);</span><br><span class="line">    }</span><br><span class="line">    <span class="built_in">dfs1</span>(<span class="number">1</span>,<span class="number">0</span>);</span><br><span class="line">    <span class="built_in">dfs2</span>(<span class="number">1</span>,<span class="number">1</span>);</span><br><span class="line">    <span class="built_in">build</span>(<span class="number">1</span>,<span class="number">1</span>,n);</span><br><span class="line">    cin&gt;&gt;m;</span><br><span class="line">    <span class="keyword">while</span>(m--){</span><br><span class="line">        cin&gt;&gt;op&gt;&gt;x&gt;&gt;y;</span><br><span class="line">        <span class="keyword">if</span>(op==<span class="string">"C"</span>){</span><br><span class="line">            <span class="type">int</span> a=ab[x].first;</span><br><span class="line">            <span class="type">int</span> b=ab[x].second;</span><br><span class="line">            <span class="keyword">if</span>(dep[a]&lt;dep[b])<span class="built_in">swap</span>(a,b);</span><br><span class="line">            <span class="built_in">modify</span>(<span class="number">1</span>,<span class="number">1</span>,n,id[a],y);</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        }</span><br><span class="line">        x++,y++;</span><br><span class="line">        <span class="keyword">if</span>(op==<span class="string">"N"</span>)<span class="built_in">update</span>(x,y);</span><br><span class="line">        <span class="keyword">if</span>(op==<span class="string">"SUM"</span>)cout&lt;&lt;<span class="built_in">qsum</span>(x,y)&lt;&lt;<span class="string">'\n'</span>;</span><br><span class="line">        <span class="keyword">if</span>(op==<span class="string">"MAX"</span>)cout&lt;&lt;<span class="built_in">qmax</span>(x,y)&lt;&lt;<span class="string">'\n'</span>;</span><br><span class="line">        <span class="keyword">if</span>(op==<span class="string">"MIN"</span>)cout&lt;&lt;<span class="built_in">qmin</span>(x,y)&lt;&lt;<span class="string">'\n'</span>;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>拓展</p><p>如果是在有颜色的树上修改呢</p><p>颜色个数为1e5</p><p>也就是说这道题要动态开点来写</p><figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> int long long</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> remove _</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N=<span class="number">1e6</span>+<span class="number">10</span>,M=<span class="number">2</span>*N;</span><br><span class="line"><span class="type">int</span> h[N],e[M],ne[M],w[M],idx,cnt,fa[N],top[N],nw[N],dep[N],tmp[N];</span><br><span class="line"><span class="type">int</span> id[N],sz[N],son[N];</span><br><span class="line"><span class="keyword">typedef</span> pair&lt;<span class="type">int</span>, <span class="type">int</span>&gt; PII;</span><br><span class="line">PII ab[N];</span><br><span class="line"><span class="type">int</span> n,x,y,a,b,c,m;</span><br><span class="line">string op;</span><br><span class="line"><span class="type">int</span> rt;</span><br><span class="line"><span class="comment">// struct node{</span></span><br><span class="line"><span class="comment">//     int sum,max,min,lazy;</span></span><br><span class="line"><span class="comment">// }t[N*4];</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">node</span>{</span><br><span class="line">    <span class="type">int</span> sum,max,min,lazy;</span><br><span class="line">    <span class="type">int</span> ls,rs;</span><br><span class="line">}t[N*<span class="number">4</span>];</span><br><span class="line"><span class="type">int</span> root[N];</span><br><span class="line"><span class="type">int</span> color[N];</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">add</span><span class="params">(<span class="type">int</span> a,<span class="type">int</span> b,<span class="type">int</span> c)</span></span>{</span><br><span class="line">    e[++idx]=b,w[idx]=c,ne[idx]=h[a],h[a]=idx;</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">dfs1</span><span class="params">(<span class="type">int</span> u,<span class="type">int</span> father)</span></span>{</span><br><span class="line">    dep[u]=dep[father]+<span class="number">1</span>,fa[u]=father,sz[u]=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=h[u];i;i=ne[i]){</span><br><span class="line">        <span class="type">int</span> j=e[i];</span><br><span class="line">        <span class="keyword">if</span>(j==father)<span class="keyword">continue</span>;</span><br><span class="line">        <span class="built_in">dfs1</span>(j,u);</span><br><span class="line">        tmp[j]=w[i];</span><br><span class="line">        sz[u]+=sz[j];</span><br><span class="line">        <span class="keyword">if</span>(sz[son[u]]&lt;sz[j])son[u]=j;</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">dfs2</span><span class="params">(<span class="type">int</span> x,<span class="type">int</span> t)</span></span>{</span><br><span class="line">    id[x]=++cnt,nw[cnt]=tmp[x],top[x]=t;</span><br><span class="line">    <span class="keyword">if</span>(son[x])<span class="built_in">dfs2</span>(son[x],t);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=h[x];i;i=ne[i]){</span><br><span class="line">        <span class="type">int</span> j=e[i];</span><br><span class="line">        <span class="keyword">if</span>(j==fa[x]||j==son[x])<span class="keyword">continue</span>;</span><br><span class="line">        <span class="built_in">dfs2</span>(j,j);</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">pushup</span><span class="params">(<span class="type">int</span> u)</span></span>{</span><br><span class="line">    t[u].sum=t[t[u].ls].sum+t[t[u].rs].sum;</span><br><span class="line">    t[u].max=<span class="built_in">max</span>(t[t[u].ls].max,t[t[u].rs].max);</span><br><span class="line">    t[u].min=<span class="built_in">min</span>(t[t[u].ls].min,t[t[u].rs].min);</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">pushdown</span><span class="params">(<span class="type">int</span> u)</span></span>{</span><br><span class="line">    <span class="keyword">if</span>(t[u].lazy==<span class="number">0</span>)<span class="keyword">return</span>;</span><br><span class="line">    <span class="keyword">if</span>(!t[u].ls)t[u].ls=++rt;</span><br><span class="line">    <span class="keyword">if</span>(!t[u].rs)t[u].rs=++rt;</span><br><span class="line">    <span class="keyword">auto</span> &amp;L=t[t[u].ls];</span><br><span class="line">    <span class="keyword">auto</span> &amp;R=t[t[u].rs];</span><br><span class="line">    L.lazy^=<span class="number">1</span>,R.lazy^=<span class="number">1</span>;</span><br><span class="line">    L.sum=-L.sum,L.max=-L.max,L.min=-L.min;</span><br><span class="line">    R.sum=-R.sum,R.max=-R.max,R.min=-R.min;</span><br><span class="line">    <span class="built_in">swap</span>(L.max,L.min),<span class="built_in">swap</span>(R.max,R.min);</span><br><span class="line">    t[u].lazy=<span class="number">0</span>;</span><br><span class="line">}</span><br><span class="line"><span class="comment">// void build(int u=1,int l=1,int r=n){</span></span><br><span class="line"><span class="comment">//     t[u]={nw[l],nw[l],nw[l]};</span></span><br><span class="line"><span class="comment">//     if(l&gt;=r)return;</span></span><br><span class="line"><span class="comment">//     int mid=l+r&gt;&gt;1;</span></span><br><span class="line"><span class="comment">//     build(u&lt;&lt;1,l,mid),build(u&lt;&lt;1|1,mid+1,r);</span></span><br><span class="line"><span class="comment">//     pushup(u);</span></span><br><span class="line"><span class="comment">// }</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">modify</span><span class="params">(<span class="type">int</span> &amp;u,<span class="type">int</span> l,<span class="type">int</span> r,<span class="type">int</span> i,<span class="type">int</span> k)</span></span>{</span><br><span class="line">    <span class="keyword">if</span>(!u)u=++rt;</span><br><span class="line">    <span class="keyword">if</span>(l==r){</span><br><span class="line">        t[u].sum=t[u].max=t[u].min=k;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="built_in">pushdown</span>(u);</span><br><span class="line">    <span class="type">int</span> mid=l+r&gt;&gt;<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">if</span>(i&lt;=mid)<span class="built_in">modify</span>(t[u].ls,l,mid,i,k);</span><br><span class="line">    <span class="keyword">else</span> <span class="built_in">modify</span>(t[u].rs,mid+<span class="number">1</span>,r,i,k);</span><br><span class="line">    <span class="built_in">pushup</span>(u);</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">remove</span><span class="params">(<span class="type">int</span> &amp;u,<span class="type">int</span> l,<span class="type">int</span> r,<span class="type">int</span> i,<span class="type">int</span> k)</span></span>{</span><br><span class="line">    <span class="keyword">if</span>(l==r){</span><br><span class="line">        t[u].max=<span class="number">-1e9</span>;</span><br><span class="line">        t[u].sum=<span class="number">0</span>;</span><br><span class="line">        t[u].min=<span class="number">1e9</span>;</span><br><span class="line">        t[u].lazy=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="type">int</span> mid=l+r&gt;&gt;<span class="number">1</span>;</span><br><span class="line">    <span class="built_in">pushdown</span>(u);</span><br><span class="line">    <span class="keyword">if</span>(i&lt;=mid)<span class="built_in">remove</span>(t[u].ls,l,mid,i,k);</span><br><span class="line">    <span class="keyword">else</span> <span class="built_in">remove</span>(t[u].rs,mid+<span class="number">1</span>,r,i,k);</span><br><span class="line">    <span class="built_in">pushup</span>(u);</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">update</span><span class="params">(<span class="type">int</span> &amp;u,<span class="type">int</span> l,<span class="type">int</span> r,<span class="type">int</span> ql,<span class="type">int</span> qr,<span class="type">int</span> lazy=<span class="number">1</span>)</span></span>{</span><br><span class="line">    <span class="keyword">if</span>(l&gt;qr||r&lt;ql)<span class="keyword">return</span>;</span><br><span class="line">    <span class="keyword">if</span>(!u)u=++rt;</span><br><span class="line">    <span class="keyword">if</span>(l&gt;=ql&amp;&amp;r&lt;=qr){</span><br><span class="line">        t[u].sum=-t[u].sum;</span><br><span class="line">        t[u].max=-t[u].max;</span><br><span class="line">        t[u].min=-t[u].min;</span><br><span class="line">        <span class="built_in">swap</span>(t[u].max,t[u].min);</span><br><span class="line">        t[u].lazy^=<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="built_in">pushdown</span>(u);</span><br><span class="line">    <span class="type">int</span> mid=l+r&gt;&gt;<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">if</span>(ql&lt;=mid)<span class="built_in">update</span>(t[u].ls,l,mid,ql,qr);</span><br><span class="line">    <span class="keyword">if</span>(qr&gt;mid)<span class="built_in">update</span>(t[u].rs,mid+<span class="number">1</span>,r,ql,qr);</span><br><span class="line">    <span class="built_in">pushup</span>(u);</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">qmax</span><span class="params">(<span class="type">int</span> u,<span class="type">int</span> l,<span class="type">int</span> r,<span class="type">int</span> ql,<span class="type">int</span> qr)</span></span>{</span><br><span class="line">    <span class="keyword">if</span>(!u)<span class="keyword">return</span> <span class="number">-1e9</span>;</span><br><span class="line">    <span class="keyword">if</span>(l&gt;qr||r&lt;ql)<span class="keyword">return</span> <span class="number">-1e9</span>;</span><br><span class="line">    <span class="keyword">if</span>(l&gt;=ql&amp;&amp;r&lt;=qr)<span class="keyword">return</span> t[u].max;</span><br><span class="line">    <span class="built_in">pushdown</span>(u);</span><br><span class="line">    <span class="type">int</span> mid=l+r&gt;&gt;<span class="number">1</span>;</span><br><span class="line">    <span class="type">int</span> ans=<span class="number">-1e9</span>;</span><br><span class="line">    <span class="keyword">if</span>(ql&lt;=mid)ans=<span class="built_in">max</span>(ans,<span class="built_in">qmax</span>(t[u].ls,l,mid,ql,qr));</span><br><span class="line">    <span class="keyword">if</span>(qr&gt; mid)ans=<span class="built_in">max</span>(ans,<span class="built_in">qmax</span>(t[u].rs,mid+<span class="number">1</span>,r,ql,qr));</span><br><span class="line">    <span class="keyword">return</span> ans;</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">qmin</span><span class="params">(<span class="type">int</span> u,<span class="type">int</span> l,<span class="type">int</span> r,<span class="type">int</span> ql,<span class="type">int</span> qr)</span></span>{</span><br><span class="line">    <span class="keyword">if</span>(!u)<span class="keyword">return</span> <span class="number">1e9</span>;</span><br><span class="line">    <span class="keyword">if</span>(l&gt;qr||r&lt;ql)<span class="keyword">return</span> <span class="number">1e9</span>;</span><br><span class="line">    <span class="keyword">if</span>(l&gt;=ql&amp;&amp;r&lt;=qr)<span class="keyword">return</span> t[u].min;</span><br><span class="line">    <span class="built_in">pushdown</span>(u);</span><br><span class="line">    <span class="type">int</span> mid=l+r&gt;&gt;<span class="number">1</span>;</span><br><span class="line">    <span class="type">int</span> ans=<span class="number">1e9</span>;</span><br><span class="line">    <span class="keyword">if</span>(ql&lt;=mid)ans=<span class="built_in">min</span>(ans,<span class="built_in">qmin</span>(t[u].ls,l,mid,ql,qr));</span><br><span class="line">    <span class="keyword">if</span>(qr&gt; mid)ans=<span class="built_in">min</span>(ans,<span class="built_in">qmin</span>(t[u].rs,mid+<span class="number">1</span>,r,ql,qr));</span><br><span class="line">    <span class="keyword">return</span> ans;</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">qsum</span><span class="params">(<span class="type">int</span> u,<span class="type">int</span> l,<span class="type">int</span> r,<span class="type">int</span> ql,<span class="type">int</span> qr)</span></span>{</span><br><span class="line">    <span class="keyword">if</span>(!u)<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span>(l&gt;qr||r&lt;ql)<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span>(l&gt;=ql&amp;&amp;r&lt;=qr)<span class="keyword">return</span> t[u].sum;</span><br><span class="line">    <span class="built_in">pushdown</span>(u);</span><br><span class="line">    <span class="type">int</span> mid=l+r&gt;&gt;<span class="number">1</span>;</span><br><span class="line">    <span class="type">int</span> ans=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span>(ql&lt;=mid)ans+=<span class="built_in">qsum</span>(t[u].ls,l,mid,ql,qr);</span><br><span class="line">    <span class="keyword">if</span>(qr&gt; mid)ans+=<span class="built_in">qsum</span>(t[u].rs,mid+<span class="number">1</span>,r,ql,qr);</span><br><span class="line">    <span class="keyword">return</span> ans;</span><br><span class="line">}</span><br><span class="line"><span class="comment">/* 上面是线段树，下面是树链剖分*/</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">update</span><span class="params">(<span class="type">int</span> &amp;o,<span class="type">int</span> x,<span class="type">int</span> y)</span></span>{</span><br><span class="line">    <span class="keyword">while</span>(top[x]!=top[y]){</span><br><span class="line">        <span class="keyword">if</span>(dep[top[x]]&lt;dep[top[y]])<span class="built_in">swap</span>(x,y);</span><br><span class="line">        <span class="built_in">update</span>(o,<span class="number">1</span>,n,id[top[x]],id[x]);</span><br><span class="line">        x=fa[top[x]];</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">if</span>(dep[x]&gt;dep[y])<span class="built_in">swap</span>(x,y);</span><br><span class="line">    <span class="keyword">if</span>(x!=y)<span class="built_in">update</span>(o,<span class="number">1</span>,n,id[x]+<span class="number">1</span>,id[y]);</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">qmax</span><span class="params">(<span class="type">int</span> o,<span class="type">int</span> x,<span class="type">int</span> y)</span></span>{</span><br><span class="line">    <span class="type">int</span> ans=<span class="number">-1e9</span>;</span><br><span class="line">    <span class="keyword">while</span>(top[x]!=top[y]){</span><br><span class="line">        <span class="keyword">if</span>(dep[top[x]]&lt;dep[top[y]])<span class="built_in">swap</span>(x,y);</span><br><span class="line">        ans=<span class="built_in">max</span>(ans, <span class="built_in">qmax</span>(o,<span class="number">1</span>,n,id[top[x]],id[x]) );</span><br><span class="line">        x=fa[top[x]];</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">if</span>(dep[x]&gt;dep[y])<span class="built_in">swap</span>(x,y);</span><br><span class="line">    <span class="keyword">if</span>(x!=y)ans=<span class="built_in">max</span>(ans,<span class="built_in">qmax</span>(o,<span class="number">1</span>,n,id[x]+<span class="number">1</span>,id[y]));</span><br><span class="line">    <span class="keyword">return</span> ans;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">qmin</span><span class="params">(<span class="type">int</span> o,<span class="type">int</span> x,<span class="type">int</span> y)</span></span>{</span><br><span class="line">    <span class="type">int</span> ans=<span class="number">1e9</span>;</span><br><span class="line">    <span class="keyword">while</span>(top[x]!=top[y]){</span><br><span class="line">        <span class="keyword">if</span>(dep[top[x]]&lt;dep[top[y]])<span class="built_in">swap</span>(x,y);</span><br><span class="line">        ans=<span class="built_in">min</span>(ans, <span class="built_in">qmin</span>(o,<span class="number">1</span>,n,id[top[x]],id[x]));</span><br><span class="line">        x=fa[top[x]];</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">if</span>(dep[x]&gt;dep[y])<span class="built_in">swap</span>(x,y);</span><br><span class="line">    <span class="keyword">if</span>(x!=y)ans=<span class="built_in">min</span>(ans,<span class="built_in">qmin</span>(o,<span class="number">1</span>,n,id[x]+<span class="number">1</span>,id[y]));</span><br><span class="line">    <span class="keyword">return</span> ans;</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">qsum</span><span class="params">(<span class="type">int</span> o,<span class="type">int</span> x,<span class="type">int</span> y)</span></span>{</span><br><span class="line">    <span class="type">int</span> ans=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(top[x]!=top[y]){</span><br><span class="line">        <span class="keyword">if</span>(dep[top[x]]&lt;dep[top[y]])<span class="built_in">swap</span>(x,y);</span><br><span class="line">        ans+=<span class="built_in">qsum</span>(o,<span class="number">1</span>,n,id[top[x]],id[x]);</span><br><span class="line">        x=fa[top[x]];</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">if</span>(dep[x]&gt;dep[y])<span class="built_in">swap</span>(x,y);</span><br><span class="line">    <span class="keyword">if</span>(x!=y)ans+=<span class="built_in">qsum</span>(o,<span class="number">1</span>,n,id[x]+<span class="number">1</span>,id[y]);</span><br><span class="line">    <span class="keyword">return</span> ans;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">signed</span> <span class="title">main</span><span class="params">()</span></span>{</span><br><span class="line">    ios::<span class="built_in">sync_with_stdio</span>(<span class="number">0</span>);</span><br><span class="line">    cin.<span class="built_in">tie</span>(<span class="number">0</span>);</span><br><span class="line">    cout.<span class="built_in">tie</span>(<span class="number">0</span>);</span><br><span class="line">    cin&gt;&gt;n;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;n;i++){</span><br><span class="line">        cin&gt;&gt;a&gt;&gt;b&gt;&gt;c;</span><br><span class="line">        a++,b++;</span><br><span class="line">        ab[i]={a,b};</span><br><span class="line">        <span class="built_in">add</span>(a,b,c);</span><br><span class="line">        <span class="built_in">add</span>(b,a,c);</span><br><span class="line">    }</span><br><span class="line">    <span class="built_in">dfs1</span>(<span class="number">1</span>,<span class="number">0</span>);</span><br><span class="line">    <span class="built_in">dfs2</span>(<span class="number">1</span>,<span class="number">1</span>);</span><br><span class="line">    <span class="comment">//build(1,1,n);</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;i++)color[i]=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;i++)<span class="built_in">modify</span>(root[color[i]],<span class="number">1</span>,n,id[i],tmp[i]);</span><br><span class="line">    cin&gt;&gt;m;</span><br><span class="line">    <span class="keyword">while</span>(m--){</span><br><span class="line">        cin&gt;&gt;op&gt;&gt;x&gt;&gt;y;</span><br><span class="line">        <span class="keyword">if</span>(op==<span class="string">"C"</span>){</span><br><span class="line">            <span class="type">int</span> a=ab[x].first;</span><br><span class="line">            <span class="type">int</span> b=ab[x].second;</span><br><span class="line">            <span class="keyword">if</span>(dep[a]&lt;dep[b])<span class="built_in">swap</span>(a,b);</span><br><span class="line">            <span class="built_in">remove</span>(root[color[a]],<span class="number">1</span>,n,id[a],<span class="number">0</span>);</span><br><span class="line">            <span class="built_in">modify</span>(root[color[a]],<span class="number">1</span>,n,id[a],y);</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        }</span><br><span class="line">        x++,y++;</span><br><span class="line">        <span class="keyword">if</span>(op==<span class="string">"N"</span>)<span class="built_in">update</span>(root[color[x]],x,y);</span><br><span class="line">        <span class="keyword">if</span>(op==<span class="string">"SUM"</span>)cout&lt;&lt;<span class="built_in">qsum</span>(root[color[x]],x,y)&lt;&lt;<span class="string">'\n'</span>;</span><br><span class="line">        <span class="keyword">if</span>(op==<span class="string">"MAX"</span>)cout&lt;&lt;<span class="built_in">qmax</span>(root[color[x]],x,y)&lt;&lt;<span class="string">'\n'</span>;</span><br><span class="line">        <span class="keyword">if</span>(op==<span class="string">"MIN"</span>)cout&lt;&lt;<span class="built_in">qmin</span>(root[color[x]],x,y)&lt;&lt;<span class="string">'\n'</span>;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><h2 id="线段树合并"><a href="#线段树合并" class="headerlink" title="线段树合并"></a>线段树合并</h2><p><img src="https://img-blog.csdnimg.cn/d4c9e6b86276495385a308af41f136ef.png" alt="在这里插入图片描述"></p><p>对每一个节点开一个权值线段树</p><p>用动态开点，不然会mle</p><p>而且不要直接#define int long long 只在关键变量开long long不然还是会MLE</p><figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="comment">// #define int long long</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N=<span class="number">1e5</span>+<span class="number">10</span>,M=<span class="number">2</span>*N;</span><br><span class="line"><span class="type">int</span> h[N],e[M],ne[M],idx;</span><br><span class="line"><span class="type">int</span> n,m,c[N],root[N],cnt;</span><br><span class="line"><span class="type">long</span> <span class="type">long</span> ans[N];</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">node</span>{</span><br><span class="line">    <span class="type">int</span> l,r;</span><br><span class="line">    <span class="type">long</span> <span class="type">long</span> sum;<span class="comment">//主要颜色的编号和</span></span><br><span class="line">    <span class="type">int</span> max;<span class="comment">//出现最多颜色的次数</span></span><br><span class="line">    <span class="meta">#<span class="keyword">define</span> ls tr[u].l</span></span><br><span class="line">    <span class="meta">#<span class="keyword">define</span> rs tr[u].r</span></span><br><span class="line">}tr[N*<span class="number">100</span>];</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">add</span><span class="params">(<span class="type">int</span> a,<span class="type">int</span> b)</span></span>{</span><br><span class="line">    e[++idx]=b,ne[idx]=h[a],h[a]=idx;</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">pushup</span><span class="params">(<span class="type">int</span> u)</span></span>{</span><br><span class="line">    tr[u].max=<span class="built_in">max</span>(tr[ls].max,tr[rs].max);</span><br><span class="line">    <span class="keyword">if</span>(tr[ls].max==tr[rs].max)tr[u].sum=tr[ls].sum+tr[rs].sum;</span><br><span class="line">    <span class="keyword">if</span>(tr[ls].max &gt;tr[rs].max)tr[u].sum=tr[ls].sum;</span><br><span class="line">    <span class="keyword">if</span>(tr[ls].max &lt;tr[rs].max)tr[u].sum=tr[rs].sum;</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">pushdown</span><span class="params">(<span class="type">int</span> u)</span></span>{</span><br><span class="line">    </span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">modify</span><span class="params">(<span class="type">int</span> &amp;o,<span class="type">int</span> l,<span class="type">int</span> r,<span class="type">int</span> i,<span class="type">int</span> k)</span></span>{</span><br><span class="line">    <span class="keyword">if</span>(!o)o=++cnt;</span><br><span class="line">    <span class="keyword">if</span>(l==r){</span><br><span class="line">        tr[o].max=<span class="number">1</span>;</span><br><span class="line">        tr[o].sum=k;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="type">int</span> mid=l+r&gt;&gt;<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">if</span>(i&lt;=mid)<span class="built_in">modify</span>(tr[o].l,l,mid,i,k);</span><br><span class="line">    <span class="keyword">else</span> <span class="built_in">modify</span>(tr[o].r,mid+<span class="number">1</span>,r,i,k);</span><br><span class="line">    <span class="built_in">pushup</span>(o);</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">merge</span><span class="params">(<span class="type">int</span> a,<span class="type">int</span> b,<span class="type">int</span> l,<span class="type">int</span> r)</span></span>{<span class="comment">//线段树合并</span></span><br><span class="line">    <span class="keyword">if</span>(!a)<span class="keyword">return</span> b;</span><br><span class="line">    <span class="keyword">if</span>(!b)<span class="keyword">return</span> a;<span class="comment">//哪个没有就返回另一个点的编号</span></span><br><span class="line">    <span class="keyword">if</span>(l==r){</span><br><span class="line">        tr[a].max+=tr[b].max;</span><br><span class="line">        <span class="keyword">return</span> a;</span><br><span class="line">    }</span><br><span class="line">    <span class="type">int</span> mid=l+r&gt;&gt;<span class="number">1</span>;</span><br><span class="line">    tr[a].l=<span class="built_in">merge</span>(tr[a].l,tr[b].l,l,mid);<span class="comment">//合并a，b的左儿子</span></span><br><span class="line">    tr[a].r=<span class="built_in">merge</span>(tr[a].r,tr[b].r,mid+<span class="number">1</span>,r);<span class="comment">//合并a，b的右儿子</span></span><br><span class="line">    <span class="built_in">pushup</span>(a);</span><br><span class="line">    <span class="keyword">return</span> a;</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">cal</span><span class="params">(<span class="type">int</span> u,<span class="type">int</span> fa=<span class="number">0</span>)</span></span>{</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=h[u];i;i=ne[i]){</span><br><span class="line">        <span class="type">int</span> j=e[i];</span><br><span class="line">        <span class="keyword">if</span>(j==fa)<span class="keyword">continue</span>;</span><br><span class="line">        <span class="built_in">cal</span>(j,u);</span><br><span class="line">        root[u]=<span class="built_in">merge</span>(root[u],root[j],<span class="number">1</span>,n);</span><br><span class="line">    }</span><br><span class="line">    ans[u]=tr[root[u]].sum;</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="type">signed</span> <span class="title">main</span><span class="params">()</span></span>{</span><br><span class="line">    ios::<span class="built_in">sync_with_stdio</span>(<span class="number">0</span>);cin.<span class="built_in">tie</span>(<span class="number">0</span>);cout.<span class="built_in">tie</span>(<span class="number">0</span>);</span><br><span class="line">    cin&gt;&gt;n;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;i++)cin&gt;&gt;c[i];</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;n;i++){</span><br><span class="line">        <span class="type">int</span> a,b;</span><br><span class="line">        cin&gt;&gt;a&gt;&gt;b;</span><br><span class="line">        <span class="built_in">add</span>(a,b);</span><br><span class="line">        <span class="built_in">add</span>(b,a);</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;i++)<span class="built_in">modify</span>(root[i],<span class="number">1</span>,n,c[i],c[i]);</span><br><span class="line">    <span class="built_in">cal</span>(<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;i++)cout&lt;&lt;ans[i]&lt;&lt;<span class="string">" "</span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>]]></content>
      
      
      <categories>
          
          <category> 算法 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 数据结构 </tag>
            
            <tag> 线段树 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>LCT动态树</title>
      <link href="/2022/05/11/lct-dong-tai-shu/"/>
      <url>/2022/05/11/lct-dong-tai-shu/</url>
      
        <content type="html"><![CDATA[<h1 id="LCT"><a href="#LCT" class="headerlink" title="LCT"></a>LCT</h1><h2 id="模板"><a href="#模板" class="headerlink" title="模板"></a>模板</h2><p><img src="https://img-blog.csdnimg.cn/633fff10368847c29a3847bd5f01e239.png" alt="在这里插入图片描述"></p><figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N=<span class="number">1e5</span>+<span class="number">10</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">node</span>{</span><br><span class="line">    <span class="type">int</span> s[<span class="number">2</span>],p,v;</span><br><span class="line">    <span class="type">int</span> sum,rev;</span><br><span class="line">    <span class="meta">#<span class="keyword">define</span> ls tr[u].s[0]</span></span><br><span class="line">    <span class="meta">#<span class="keyword">define</span> lx tr[x].s[0]</span></span><br><span class="line">    <span class="meta">#<span class="keyword">define</span> rs tr[u].s[1]</span></span><br><span class="line">    <span class="meta">#<span class="keyword">define</span> rx tr[x].s[1]</span></span><br><span class="line">}tr[N];</span><br><span class="line"><span class="type">int</span> n,m,op,x,y;</span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="keyword">inline</span> <span class="title">isroot</span><span class="params">(<span class="type">int</span> u)</span></span>{</span><br><span class="line">    <span class="keyword">return</span> tr[tr[u].p].s[<span class="number">0</span>]!=u&amp;&amp;tr[tr[u].p].s[<span class="number">1</span>]!=u;</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="keyword">inline</span> <span class="title">pushup</span><span class="params">(<span class="type">int</span> u)</span></span>{</span><br><span class="line">    tr[u].sum=tr[ls].sum^tr[u].v^tr[rs].sum;</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="keyword">inline</span> <span class="title">pushrev</span><span class="params">(<span class="type">int</span> u)</span></span>{</span><br><span class="line">    <span class="built_in">swap</span>(ls,rs);</span><br><span class="line">    tr[u].rev^=<span class="number">1</span>;</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="keyword">inline</span> <span class="title">pushdown</span><span class="params">(<span class="type">int</span> u)</span></span>{</span><br><span class="line">    <span class="keyword">if</span>(tr[u].rev){</span><br><span class="line">        <span class="built_in">pushrev</span>(ls),<span class="built_in">pushrev</span>(rs);</span><br><span class="line">        tr[u].rev=<span class="number">0</span>;</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="keyword">inline</span> <span class="title">rotate</span><span class="params">(<span class="type">int</span> x)</span></span>{</span><br><span class="line">    <span class="type">int</span> y=tr[x].p,z=tr[y].p;</span><br><span class="line">    <span class="type">int</span> k=tr[y].s[<span class="number">1</span>]==x;</span><br><span class="line">    <span class="keyword">if</span>(!<span class="built_in">isroot</span>(y))tr[z].s[tr[z].s[<span class="number">1</span>]==y]=x;</span><br><span class="line">    tr[x].p=z;</span><br><span class="line">    tr[y].s[k]=tr[x].s[k^<span class="number">1</span>],tr[tr[x].s[k^<span class="number">1</span>]].p=y;</span><br><span class="line">    tr[x].s[k^<span class="number">1</span>]=y,tr[y].p=x;</span><br><span class="line">    <span class="built_in">pushup</span>(y),<span class="built_in">pushup</span>(x);</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="keyword">inline</span> <span class="title">splay</span><span class="params">(<span class="type">int</span> x)</span></span>{</span><br><span class="line">    <span class="type">static</span> <span class="type">int</span> stk[N];</span><br><span class="line">    <span class="type">int</span> tt=<span class="number">0</span>,t=x;</span><br><span class="line">    stk[++tt]=t;</span><br><span class="line">    <span class="keyword">while</span>(!<span class="built_in">isroot</span>(t))stk[++tt]=t=tr[t].p;</span><br><span class="line">    <span class="keyword">while</span>(tt)<span class="built_in">pushdown</span>(stk[tt--]);</span><br><span class="line">    <span class="keyword">while</span>(!<span class="built_in">isroot</span>(x)){</span><br><span class="line">        <span class="type">int</span> y=tr[x].p,z=tr[y].p;</span><br><span class="line">        <span class="keyword">if</span>(!<span class="built_in">isroot</span>(y)){</span><br><span class="line">            <span class="keyword">if</span>( (tr[z].s[<span class="number">1</span>]==y)^(tr[y].s[<span class="number">1</span>]==x) )<span class="built_in">rotate</span>(x);</span><br><span class="line">            <span class="keyword">else</span> <span class="built_in">rotate</span>(y);</span><br><span class="line">        }<span class="built_in">rotate</span>(x);</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="keyword">inline</span> <span class="title">access</span><span class="params">(<span class="type">int</span> x)</span></span>{</span><br><span class="line">    <span class="type">int</span> z=x;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> y=<span class="number">0</span>;x;y=x,x=tr[x].p){</span><br><span class="line">        <span class="built_in">splay</span>(x);</span><br><span class="line">        rx=y;</span><br><span class="line">        <span class="built_in">pushup</span>(x);</span><br><span class="line">    }</span><br><span class="line">    <span class="built_in">splay</span>(z);</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="keyword">inline</span> <span class="title">makeroot</span><span class="params">(<span class="type">int</span> x)</span></span>{</span><br><span class="line">    <span class="built_in">access</span>(x);</span><br><span class="line">    <span class="built_in">pushrev</span>(x);</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="keyword">inline</span> <span class="title">findroot</span><span class="params">(<span class="type">int</span> u)</span></span>{</span><br><span class="line">    <span class="built_in">access</span>(u);</span><br><span class="line">    <span class="keyword">while</span>(ls)<span class="built_in">pushdown</span>(u),u=ls;</span><br><span class="line">    <span class="built_in">splay</span>(u);</span><br><span class="line">    <span class="keyword">return</span> u;</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="keyword">inline</span> <span class="title">split</span><span class="params">(<span class="type">int</span> x,<span class="type">int</span> y)</span></span>{</span><br><span class="line">    <span class="built_in">makeroot</span>(x);</span><br><span class="line">    <span class="built_in">access</span>(y);</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="keyword">inline</span> <span class="title">link</span><span class="params">(<span class="type">int</span> x,<span class="type">int</span> y)</span></span>{</span><br><span class="line">    <span class="built_in">makeroot</span>(x);</span><br><span class="line">    <span class="keyword">if</span>(<span class="built_in">findroot</span>(y)!=x)tr[x].p=y;</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="keyword">inline</span> <span class="title">cut</span><span class="params">(<span class="type">int</span> x,<span class="type">int</span> y)</span></span>{</span><br><span class="line">    <span class="built_in">makeroot</span>(x);</span><br><span class="line">    <span class="keyword">if</span>(<span class="built_in">findroot</span>(y)==x&amp;&amp;rx==y&amp;&amp;!tr[y].s[<span class="number">0</span>]){</span><br><span class="line">        tr[y].p=rx=<span class="number">0</span>;</span><br><span class="line">        <span class="built_in">pushup</span>(x);</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="type">signed</span> <span class="title">main</span><span class="params">()</span></span>{</span><br><span class="line">    ios::<span class="built_in">sync_with_stdio</span>(<span class="number">0</span>);</span><br><span class="line">    cin.<span class="built_in">tie</span>(<span class="number">0</span>);</span><br><span class="line">    cout.<span class="built_in">tie</span>(<span class="number">0</span>);</span><br><span class="line">    cin&gt;&gt;n&gt;&gt;m;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;i++)cin&gt;&gt;tr[i].v;</span><br><span class="line">    <span class="keyword">while</span>(m--){</span><br><span class="line">        cin&gt;&gt;op&gt;&gt;x&gt;&gt;y;</span><br><span class="line">        <span class="keyword">if</span>(op==<span class="number">0</span>){</span><br><span class="line">            <span class="built_in">split</span>(x,y);</span><br><span class="line">            cout&lt;&lt;tr[y].sum&lt;&lt;<span class="string">'\n'</span>;</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">if</span>(op==<span class="number">1</span>)<span class="built_in">link</span>(x,y);</span><br><span class="line">        <span class="keyword">if</span>(op==<span class="number">2</span>)<span class="built_in">cut</span>(x,y);</span><br><span class="line">        <span class="keyword">if</span>(op==<span class="number">3</span>){</span><br><span class="line">            <span class="built_in">splay</span>(x);</span><br><span class="line">            tr[x].v=y;</span><br><span class="line">            <span class="built_in">pushup</span>(x);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><hr><h2 id="化边权为点权-动态维护区间最大值编号-用编号删边"><a href="#化边权为点权-动态维护区间最大值编号-用编号删边" class="headerlink" title="化边权为点权+动态维护区间最大值编号+用编号删边"></a>化边权为点权+动态维护区间最大值编号+用编号删边</h2><p><img src="https://img-blog.csdnimg.cn/119efad83ba64cdb8d2b017671a58db9.png" alt="在这里插入图片描述"></p><figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N=<span class="number">1e6</span>+<span class="number">10</span>;</span><br><span class="line"><span class="type">int</span> n,m,p[N],stk[N];</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">find</span><span class="params">(<span class="type">int</span> x)</span></span>{</span><br><span class="line">    <span class="keyword">if</span>(p[x]!=x)p[x]=<span class="built_in">find</span>(p[x]);</span><br><span class="line">    <span class="keyword">return</span> p[x];</span><br><span class="line">}</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Edge</span>{</span><br><span class="line">    <span class="type">int</span> x,y,a,b;</span><br><span class="line">    <span class="type">bool</span> <span class="keyword">operator</span>&lt;(<span class="type">const</span> Edge&amp;t)<span class="type">const</span>{</span><br><span class="line">        <span class="keyword">return</span> a&lt;t.a;</span><br><span class="line">    }</span><br><span class="line">}e[N];</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">node</span>{</span><br><span class="line">    <span class="type">int</span> s[<span class="number">2</span>],p,v;</span><br><span class="line">    <span class="type">int</span> mx,rev;</span><br><span class="line">    <span class="meta">#<span class="keyword">define</span> ls tr[u].s[0]</span></span><br><span class="line">    <span class="meta">#<span class="keyword">define</span> rs tr[u].s[1]</span></span><br><span class="line">    <span class="meta">#<span class="keyword">define</span> lx tr[x].s[0]</span></span><br><span class="line">    <span class="meta">#<span class="keyword">define</span> rx tr[x].s[1]</span></span><br><span class="line">}tr[N];</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">pushrev</span><span class="params">(<span class="type">int</span> u)</span></span>{</span><br><span class="line">    <span class="built_in">swap</span>(ls,rs);</span><br><span class="line">    tr[u].rev^=<span class="number">1</span>;</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">pushup</span><span class="params">(<span class="type">int</span> u)</span></span>{</span><br><span class="line">    tr[u].mx=u;</span><br><span class="line">    <span class="type">int</span> lmaxid=tr[ls].mx;</span><br><span class="line">    <span class="type">int</span> rmaxid=tr[rs].mx;</span><br><span class="line">    <span class="keyword">if</span>(tr[lmaxid].v&gt;tr[tr[u].mx].v)tr[u].mx=lmaxid;</span><br><span class="line">    <span class="keyword">if</span>(tr[rmaxid].v&gt;tr[tr[u].mx].v)tr[u].mx=rmaxid;</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">pushdown</span><span class="params">(<span class="type">int</span> u)</span></span>{</span><br><span class="line">    <span class="keyword">if</span>(tr[u].rev){</span><br><span class="line">        <span class="built_in">pushrev</span>(ls);</span><br><span class="line">        <span class="built_in">pushrev</span>(rs);</span><br><span class="line">        tr[u].rev=<span class="number">0</span>;</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">isroot</span><span class="params">(<span class="type">int</span> u)</span></span>{</span><br><span class="line">    <span class="keyword">return</span> tr[tr[u].p].s[<span class="number">0</span>]!=u&amp;&amp;tr[tr[u].p].s[<span class="number">1</span>]!=u;</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">rotate</span><span class="params">(<span class="type">int</span> x)</span></span>{</span><br><span class="line">    <span class="type">int</span> y=tr[x].p,z=tr[y].p;</span><br><span class="line">    <span class="type">int</span> k=tr[y].s[<span class="number">1</span>]==x;</span><br><span class="line">    <span class="keyword">if</span>(!<span class="built_in">isroot</span>(y))tr[z].s[tr[z].s[<span class="number">1</span>]==y]=x;</span><br><span class="line">    tr[x].p=z;</span><br><span class="line">    tr[y].s[k]=tr[x].s[k^<span class="number">1</span>],tr[tr[x].s[k^<span class="number">1</span>]].p=y;</span><br><span class="line">    tr[x].s[k^<span class="number">1</span>]=y,tr[y].p=x;</span><br><span class="line">    <span class="built_in">pushup</span>(y),<span class="built_in">pushup</span>(x);</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">splay</span><span class="params">(<span class="type">int</span> x)</span></span>{</span><br><span class="line">    <span class="type">int</span> top=<span class="number">0</span>,r=x;</span><br><span class="line">    stk[++top]=r;</span><br><span class="line">    <span class="keyword">while</span>(!<span class="built_in">isroot</span>(r))stk[++top]=r=tr[r].p;</span><br><span class="line">    <span class="keyword">while</span>(top)<span class="built_in">pushdown</span>(stk[top--]);</span><br><span class="line">    <span class="keyword">while</span>(!<span class="built_in">isroot</span>(x)){</span><br><span class="line">        <span class="type">int</span> y=tr[x].p,z=tr[y].p;</span><br><span class="line">        <span class="keyword">if</span>(!<span class="built_in">isroot</span>(y)){</span><br><span class="line">            <span class="keyword">if</span>((tr[z].s[<span class="number">1</span>]==y)^(tr[y].s[<span class="number">1</span>]==x))<span class="built_in">rotate</span>(x);</span><br><span class="line">            <span class="keyword">else</span> <span class="built_in">rotate</span>(y);</span><br><span class="line">        }</span><br><span class="line">        <span class="built_in">rotate</span>(x);</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">access</span><span class="params">(<span class="type">int</span> x)</span></span>{</span><br><span class="line">    <span class="type">int</span> z=x;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> y=<span class="number">0</span>;x;y=x,x=tr[y].p){</span><br><span class="line">        <span class="built_in">splay</span>(x);</span><br><span class="line">        tr[x].s[<span class="number">1</span>]=y,<span class="built_in">pushup</span>(x);</span><br><span class="line">    }</span><br><span class="line">    <span class="built_in">splay</span>(z);</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">makeroot</span><span class="params">(<span class="type">int</span> x)</span></span>{</span><br><span class="line">    <span class="built_in">access</span>(x);</span><br><span class="line">    <span class="built_in">pushrev</span>(x);</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">findroot</span><span class="params">(<span class="type">int</span> x)</span></span>{</span><br><span class="line">    <span class="built_in">access</span>(x);</span><br><span class="line">    <span class="keyword">while</span>(lx)<span class="built_in">pushdown</span>(x),x=lx;</span><br><span class="line">    <span class="built_in">splay</span>(x);</span><br><span class="line">    <span class="keyword">return</span> x;</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">split</span><span class="params">(<span class="type">int</span> x,<span class="type">int</span> y)</span></span>{</span><br><span class="line">    <span class="built_in">makeroot</span>(x);</span><br><span class="line">    <span class="built_in">access</span>(y);</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">link</span><span class="params">(<span class="type">int</span> x,<span class="type">int</span> y)</span></span>{</span><br><span class="line">    <span class="built_in">makeroot</span>(x);</span><br><span class="line">    <span class="keyword">if</span>(<span class="built_in">findroot</span>(y)!=x)tr[x].p=y;</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">cut</span><span class="params">(<span class="type">int</span> x,<span class="type">int</span> y)</span></span>{</span><br><span class="line">    <span class="built_in">makeroot</span>(x);</span><br><span class="line">    <span class="keyword">if</span>(<span class="built_in">findroot</span>(y)==x&amp;&amp;rx==y&amp;&amp;!tr[y].s[<span class="number">0</span>]){</span><br><span class="line">        tr[y].p=rx=<span class="number">0</span>;</span><br><span class="line">        <span class="built_in">pushup</span>(x);</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="type">signed</span> <span class="title">main</span><span class="params">()</span></span>{</span><br><span class="line">    ios::<span class="built_in">sync_with_stdio</span>(<span class="number">0</span>);cin.<span class="built_in">tie</span>(<span class="number">0</span>);cout.<span class="built_in">tie</span>(<span class="number">0</span>);</span><br><span class="line">    cin&gt;&gt;n&gt;&gt;m;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=m;i++){</span><br><span class="line">        <span class="type">int</span> x,y,a,b;</span><br><span class="line">        cin&gt;&gt;x&gt;&gt;y&gt;&gt;a&gt;&gt;b;</span><br><span class="line">        e[i]={x,y,a,b};</span><br><span class="line">    }</span><br><span class="line">    <span class="built_in">sort</span>(e+<span class="number">1</span>,e+<span class="number">1</span>+m);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n+m;i++){</span><br><span class="line">        p[i]=i;</span><br><span class="line">        <span class="keyword">if</span>(i&gt;n)tr[i].v=e[i-n].b;</span><br><span class="line">        tr[i].mx=i;</span><br><span class="line">    }</span><br><span class="line">    <span class="type">int</span> ans=<span class="number">1e9</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=m;i++){</span><br><span class="line">        <span class="type">int</span> x=e[i].x,y=e[i].y,a=e[i].a,b=e[i].b;</span><br><span class="line">        <span class="keyword">if</span>(<span class="built_in">find</span>(x)==<span class="built_in">find</span>(y)){</span><br><span class="line">            <span class="built_in">split</span>(x,y);</span><br><span class="line">            <span class="type">int</span> t=tr[y].mx;</span><br><span class="line">            <span class="keyword">if</span>(tr[t].v&gt;b){</span><br><span class="line">                <span class="built_in">cut</span>(t,e[t-n].x),<span class="built_in">cut</span>(t,e[t-n].y);</span><br><span class="line">                <span class="built_in">link</span>(i+n,x),<span class="built_in">link</span>(i+n,y);</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">else</span>{</span><br><span class="line">            p[<span class="built_in">find</span>(x)]=<span class="built_in">find</span>(y);</span><br><span class="line">            <span class="built_in">link</span>(i+n,x),<span class="built_in">link</span>(i+n,y);</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">if</span>(<span class="built_in">find</span>(<span class="number">1</span>)==<span class="built_in">find</span>(n)){</span><br><span class="line">            <span class="built_in">split</span>(<span class="number">1</span>,n);</span><br><span class="line">            ans=<span class="built_in">min</span>(ans,a+tr[tr[n].mx].v);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    cout&lt;&lt;(ans==<span class="number">1e9</span>?<span class="number">-1</span>:ans);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><h2 id="lct求子树大小"><a href="#lct求子树大小" class="headerlink" title="lct求子树大小"></a>lct求子树大小</h2><p><img src="https://img-blog.csdnimg.cn/3d3130ffc83d4809acd5691ead77baaa.png" alt="在这里插入图片描述"></p><figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdlib&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cmath&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iomanip&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">node</span>{</span><br><span class="line"><span class="type">int</span> fa,son[<span class="number">2</span>],siz,exsiz,rev;</span><br><span class="line">}t[<span class="number">100050</span>];</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">update</span><span class="params">(<span class="type">int</span> x)</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">t[x].siz=t[t[x].son[<span class="number">0</span>]].siz+t[t[x].son[<span class="number">1</span>]].siz+t[x].exsiz+<span class="number">1</span>;</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">pushdown</span><span class="params">(<span class="type">int</span> x)</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line"><span class="keyword">if</span>(t[x].rev)</span><br><span class="line">{</span><br><span class="line"><span class="built_in">swap</span>(t[x].son[<span class="number">0</span>],t[x].son[<span class="number">1</span>]);</span><br><span class="line"><span class="keyword">if</span>(t[x].son[<span class="number">0</span>]) t[t[x].son[<span class="number">0</span>]].rev^=<span class="number">1</span>;</span><br><span class="line"><span class="keyword">if</span>(t[x].son[<span class="number">1</span>]) t[t[x].son[<span class="number">1</span>]].rev^=<span class="number">1</span>;</span><br><span class="line">t[x].rev=<span class="number">0</span>;</span><br><span class="line">}</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">bool</span> <span class="title">isroot</span><span class="params">(<span class="type">int</span> x)</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line"><span class="keyword">return</span> t[t[x].fa].son[<span class="number">0</span>]!=x&amp;&amp;t[t[x].fa].son[<span class="number">1</span>]!=x;</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">get</span><span class="params">(<span class="type">int</span> x)</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line"><span class="keyword">return</span> t[t[x].fa].son[<span class="number">1</span>]==x;</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">rotate</span><span class="params">(<span class="type">int</span> x)</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line"><span class="type">int</span> f=t[x].fa;<span class="type">int</span> ff=t[f].fa;<span class="type">int</span> gx=<span class="built_in">get</span>(x);<span class="type">int</span> gx2=<span class="built_in">get</span>(f);</span><br><span class="line"><span class="keyword">if</span>(!<span class="built_in">isroot</span>(f))</span><br><span class="line">{</span><br><span class="line">t[ff].son[gx2]=x;</span><br><span class="line">}</span><br><span class="line">t[f].son[gx]=t[x].son[gx^<span class="number">1</span>];</span><br><span class="line">t[t[x].son[gx^<span class="number">1</span>]].fa=f;</span><br><span class="line">t[x].son[gx^<span class="number">1</span>]=f;</span><br><span class="line">t[f].fa=x;</span><br><span class="line">t[x].fa=ff;</span><br><span class="line"><span class="built_in">update</span>(f);</span><br><span class="line"><span class="built_in">update</span>(x);</span><br><span class="line">}</span><br><span class="line"><span class="type">int</span> st[<span class="number">100050</span>];</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">splay</span><span class="params">(<span class="type">int</span> x)</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line"><span class="type">int</span> top=<span class="number">0</span>;</span><br><span class="line"><span class="type">int</span> y=x;</span><br><span class="line">st[++top]=y;</span><br><span class="line"><span class="keyword">while</span>(!<span class="built_in">isroot</span>(y))</span><br><span class="line">{</span><br><span class="line">y=t[y].fa;</span><br><span class="line">st[++top]=y;</span><br><span class="line">}</span><br><span class="line"><span class="keyword">while</span>(top)</span><br><span class="line">{</span><br><span class="line"><span class="built_in">pushdown</span>(st[top--]);</span><br><span class="line">}</span><br><span class="line"><span class="keyword">while</span>(!<span class="built_in">isroot</span>(x))</span><br><span class="line">{</span><br><span class="line"><span class="type">int</span> f=t[x].fa;</span><br><span class="line"><span class="keyword">if</span>(<span class="built_in">isroot</span>(f))</span><br><span class="line">{</span><br><span class="line"><span class="built_in">rotate</span>(x);</span><br><span class="line">}</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span>(<span class="built_in">get</span>(x)==<span class="built_in">get</span>(f))</span><br><span class="line">{</span><br><span class="line"><span class="built_in">rotate</span>(f);</span><br><span class="line"><span class="built_in">rotate</span>(x);</span><br><span class="line">}</span><br><span class="line"><span class="keyword">else</span> </span><br><span class="line">{</span><br><span class="line"><span class="built_in">rotate</span>(x);</span><br><span class="line"><span class="built_in">rotate</span>(x);</span><br><span class="line">}</span><br><span class="line"><span class="built_in">update</span>(x);</span><br><span class="line">}</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">access</span><span class="params">(<span class="type">int</span> x)</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line"><span class="keyword">for</span>(<span class="type">int</span> y=<span class="number">0</span>;x;y=x,x=t[x].fa)</span><br><span class="line">{</span><br><span class="line"><span class="built_in">splay</span>(x);</span><br><span class="line">t[x].exsiz+=t[t[x].son[<span class="number">1</span>]].siz-t[y].siz;</span><br><span class="line">t[x].son[<span class="number">1</span>]=y;</span><br><span class="line"><span class="built_in">update</span>(x);</span><br><span class="line">}</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">makeroot</span><span class="params">(<span class="type">int</span> x)</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line"><span class="built_in">access</span>(x);</span><br><span class="line"><span class="built_in">splay</span>(x);</span><br><span class="line">t[x].rev^=<span class="number">1</span>;</span><br><span class="line"><span class="built_in">pushdown</span>(x);</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">link</span><span class="params">(<span class="type">int</span> x,<span class="type">int</span> y)</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line"><span class="built_in">makeroot</span>(x);</span><br><span class="line"><span class="built_in">makeroot</span>(y);</span><br><span class="line">t[x].fa=y;</span><br><span class="line">t[y].exsiz+=t[x].siz;</span><br><span class="line"><span class="built_in">update</span>(y);</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">split</span><span class="params">(<span class="type">int</span> x,<span class="type">int</span> y)</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line"><span class="built_in">makeroot</span>(x);</span><br><span class="line"><span class="built_in">access</span>(y);</span><br><span class="line"><span class="built_in">splay</span>(y);</span><br><span class="line">}</span><br><span class="line"><span class="type">int</span> n,q;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line"> <span class="built_in">scanf</span>(<span class="string">"%d%d"</span>,&amp;n,&amp;q);</span><br><span class="line"> <span class="keyword">while</span>(q--)</span><br><span class="line"> {</span><br><span class="line"> <span class="type">char</span> typ;</span><br><span class="line"> cin&gt;&gt;typ;</span><br><span class="line"> <span class="keyword">if</span>(typ==<span class="string">'A'</span>)</span><br><span class="line"> {</span><br><span class="line"> <span class="type">int</span> x,y;</span><br><span class="line"> <span class="built_in">scanf</span>(<span class="string">"%d%d"</span>,&amp;x,&amp;y);</span><br><span class="line"> <span class="built_in">link</span>(x,y);</span><br><span class="line">}</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">{</span><br><span class="line"><span class="type">int</span> x,y;</span><br><span class="line"><span class="built_in">scanf</span>(<span class="string">"%d%d"</span>,&amp;x,&amp;y);</span><br><span class="line"><span class="built_in">split</span>(x,y);</span><br><span class="line">t[y].son[<span class="number">0</span>]=t[x].fa=<span class="number">0</span>;</span><br><span class="line"><span class="built_in">update</span>(y);</span><br><span class="line"><span class="built_in">makeroot</span>(x);</span><br><span class="line"><span class="built_in">makeroot</span>(y);</span><br><span class="line"><span class="type">long</span> <span class="type">long</span> ans=(<span class="type">long</span> <span class="type">long</span>)(t[x].siz)*(<span class="type">long</span> <span class="type">long</span>)(t[y].siz);</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"%lld\n"</span>,ans);</span><br><span class="line">t[x].fa=y;</span><br><span class="line">t[y].exsiz+=t[x].siz;</span><br><span class="line">}</span><br><span class="line"> }</span><br><span class="line"> <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line"> } </span><br></pre></td></tr></tbody></table></figure><hr><h2 id="弹飞绵羊"><a href="#弹飞绵羊" class="headerlink" title="弹飞绵羊"></a>弹飞绵羊</h2><figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N=<span class="number">1e6</span>+<span class="number">10</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">node</span>{</span><br><span class="line">    <span class="type">int</span> s[<span class="number">2</span>],p,v;</span><br><span class="line">    <span class="type">int</span> sum,rev;</span><br><span class="line">    <span class="meta">#<span class="keyword">define</span> ls tr[u].s[0]</span></span><br><span class="line">    <span class="meta">#<span class="keyword">define</span> lx tr[x].s[0]</span></span><br><span class="line">    <span class="meta">#<span class="keyword">define</span> rs tr[u].s[1]</span></span><br><span class="line">    <span class="meta">#<span class="keyword">define</span> rx tr[x].s[1]</span></span><br><span class="line">}tr[N];</span><br><span class="line"><span class="type">int</span> n,m,op,x,y;</span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="keyword">inline</span> <span class="title">isroot</span><span class="params">(<span class="type">int</span> u)</span></span>{</span><br><span class="line">    <span class="keyword">return</span> tr[tr[u].p].s[<span class="number">0</span>]!=u&amp;&amp;tr[tr[u].p].s[<span class="number">1</span>]!=u;</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="keyword">inline</span> <span class="title">pushup</span><span class="params">(<span class="type">int</span> u)</span></span>{</span><br><span class="line">    tr[u].sum=tr[ls].sum+tr[u].v+tr[rs].sum;</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="keyword">inline</span> <span class="title">pushrev</span><span class="params">(<span class="type">int</span> u)</span></span>{</span><br><span class="line">    <span class="built_in">swap</span>(ls,rs);</span><br><span class="line">    tr[u].rev^=<span class="number">1</span>;</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="keyword">inline</span> <span class="title">pushdown</span><span class="params">(<span class="type">int</span> u)</span></span>{</span><br><span class="line">    <span class="keyword">if</span>(tr[u].rev){</span><br><span class="line">        <span class="built_in">pushrev</span>(ls),<span class="built_in">pushrev</span>(rs);</span><br><span class="line">        tr[u].rev=<span class="number">0</span>;</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="keyword">inline</span> <span class="title">rotate</span><span class="params">(<span class="type">int</span> x)</span></span>{</span><br><span class="line">    <span class="type">int</span> y=tr[x].p,z=tr[y].p;</span><br><span class="line">    <span class="type">int</span> k=tr[y].s[<span class="number">1</span>]==x;</span><br><span class="line">    <span class="keyword">if</span>(!<span class="built_in">isroot</span>(y))tr[z].s[tr[z].s[<span class="number">1</span>]==y]=x;</span><br><span class="line">    tr[x].p=z;</span><br><span class="line">    tr[y].s[k]=tr[x].s[k^<span class="number">1</span>],tr[tr[x].s[k^<span class="number">1</span>]].p=y;</span><br><span class="line">    tr[x].s[k^<span class="number">1</span>]=y,tr[y].p=x;</span><br><span class="line">    <span class="built_in">pushup</span>(y),<span class="built_in">pushup</span>(x);</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="keyword">inline</span> <span class="title">splay</span><span class="params">(<span class="type">int</span> x)</span></span>{</span><br><span class="line">    <span class="type">static</span> <span class="type">int</span> stk[N];</span><br><span class="line">    <span class="type">int</span> tt=<span class="number">0</span>,t=x;</span><br><span class="line">    stk[++tt]=t;</span><br><span class="line">    <span class="keyword">while</span>(!<span class="built_in">isroot</span>(t))stk[++tt]=t=tr[t].p;</span><br><span class="line">    <span class="keyword">while</span>(tt)<span class="built_in">pushdown</span>(stk[tt--]);</span><br><span class="line">    <span class="keyword">while</span>(!<span class="built_in">isroot</span>(x)){</span><br><span class="line">        <span class="type">int</span> y=tr[x].p,z=tr[y].p;</span><br><span class="line">        <span class="keyword">if</span>(!<span class="built_in">isroot</span>(y)){</span><br><span class="line">            <span class="keyword">if</span>( (tr[z].s[<span class="number">1</span>]==y)^(tr[y].s[<span class="number">1</span>]==x) )<span class="built_in">rotate</span>(x);</span><br><span class="line">            <span class="keyword">else</span> <span class="built_in">rotate</span>(y);</span><br><span class="line">        }<span class="built_in">rotate</span>(x);</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="keyword">inline</span> <span class="title">access</span><span class="params">(<span class="type">int</span> x)</span></span>{</span><br><span class="line">    <span class="type">int</span> z=x;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> y=<span class="number">0</span>;x;y=x,x=tr[x].p){</span><br><span class="line">        <span class="built_in">splay</span>(x);</span><br><span class="line">        rx=y;</span><br><span class="line">        <span class="built_in">pushup</span>(x);</span><br><span class="line">    }</span><br><span class="line">    <span class="built_in">splay</span>(z);</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="keyword">inline</span> <span class="title">makeroot</span><span class="params">(<span class="type">int</span> x)</span></span>{</span><br><span class="line">    <span class="built_in">access</span>(x);</span><br><span class="line">    <span class="built_in">pushrev</span>(x);</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="keyword">inline</span> <span class="title">findroot</span><span class="params">(<span class="type">int</span> u)</span></span>{</span><br><span class="line">    <span class="built_in">access</span>(u);</span><br><span class="line">    <span class="keyword">while</span>(ls)<span class="built_in">pushdown</span>(u),u=ls;</span><br><span class="line">    <span class="built_in">splay</span>(u);</span><br><span class="line">    <span class="keyword">return</span> u;</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="keyword">inline</span> <span class="title">split</span><span class="params">(<span class="type">int</span> x,<span class="type">int</span> y)</span></span>{</span><br><span class="line">    <span class="built_in">makeroot</span>(x);</span><br><span class="line">    <span class="built_in">access</span>(y);</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="keyword">inline</span> <span class="title">link</span><span class="params">(<span class="type">int</span> x,<span class="type">int</span> y)</span></span>{</span><br><span class="line">    <span class="built_in">makeroot</span>(x);</span><br><span class="line">    <span class="keyword">if</span>(<span class="built_in">findroot</span>(y)!=x)tr[x].p=y;</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="keyword">inline</span> <span class="title">cut</span><span class="params">(<span class="type">int</span> x,<span class="type">int</span> y)</span></span>{</span><br><span class="line">    <span class="built_in">makeroot</span>(x);</span><br><span class="line">    <span class="keyword">if</span>(<span class="built_in">findroot</span>(y)==x&amp;&amp;rx==y&amp;&amp;!tr[y].s[<span class="number">0</span>]){</span><br><span class="line">        tr[y].p=rx=<span class="number">0</span>;</span><br><span class="line">        <span class="built_in">pushup</span>(x);</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"><span class="type">int</span> fa[N];</span><br><span class="line"><span class="function"><span class="type">signed</span> <span class="title">main</span><span class="params">()</span></span>{</span><br><span class="line">    ios::<span class="built_in">sync_with_stdio</span>(<span class="number">0</span>);</span><br><span class="line">    cin.<span class="built_in">tie</span>(<span class="number">0</span>);</span><br><span class="line">    cout.<span class="built_in">tie</span>(<span class="number">0</span>);</span><br><span class="line">    <span class="comment">// cin&gt;&gt;n&gt;&gt;m;</span></span><br><span class="line">    <span class="comment">// for(int i=1;i&lt;=n;i++)cin&gt;&gt;tr[i].v;</span></span><br><span class="line">    <span class="comment">// while(m--){</span></span><br><span class="line">    <span class="comment">//     cin&gt;&gt;op&gt;&gt;x&gt;&gt;y;</span></span><br><span class="line">    <span class="comment">//     if(op==0){</span></span><br><span class="line">    <span class="comment">//         split(x,y);</span></span><br><span class="line">    <span class="comment">//         cout&lt;&lt;tr[y].sum&lt;&lt;'\n';</span></span><br><span class="line">    <span class="comment">//     }</span></span><br><span class="line">    <span class="comment">//     if(op==1)link(x,y);</span></span><br><span class="line">    <span class="comment">//     if(op==2)cut(x,y);</span></span><br><span class="line">    <span class="comment">//     if(op==3){</span></span><br><span class="line">    <span class="comment">//         splay(x);</span></span><br><span class="line">    <span class="comment">//         tr[x].v=y;</span></span><br><span class="line">    <span class="comment">//         pushup(x);</span></span><br><span class="line">    <span class="comment">//     }</span></span><br><span class="line">    <span class="comment">// }</span></span><br><span class="line">    cin&gt;&gt;n;</span><br><span class="line">    <span class="type">int</span> T=n+<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n+<span class="number">1</span>;i++)tr[i].v=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;i++){</span><br><span class="line">        cin&gt;&gt;fa[i];</span><br><span class="line">        fa[i]=<span class="built_in">min</span>(fa[i]+i,n+<span class="number">1</span>);</span><br><span class="line">        <span class="built_in">link</span>(i,fa[i]);</span><br><span class="line">    }</span><br><span class="line">    cin&gt;&gt;m;</span><br><span class="line">    <span class="keyword">while</span>(m--){</span><br><span class="line">        <span class="type">int</span> op;</span><br><span class="line">        cin&gt;&gt;op;</span><br><span class="line">        <span class="keyword">if</span>(op==<span class="number">1</span>){</span><br><span class="line">            <span class="type">int</span> x;</span><br><span class="line">            cin&gt;&gt;x;</span><br><span class="line">            x++;</span><br><span class="line">            <span class="built_in">split</span>(x,T);</span><br><span class="line">            cout&lt;&lt;tr[T].sum<span class="number">-1</span>&lt;&lt;<span class="string">'\n'</span>;</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">else</span>{</span><br><span class="line">            <span class="type">int</span> x,f;</span><br><span class="line">            cin&gt;&gt;x&gt;&gt;f;</span><br><span class="line">            x++;</span><br><span class="line">            <span class="built_in">cut</span>(x,fa[x]);</span><br><span class="line">            f=<span class="built_in">min</span>(T,f+x);</span><br><span class="line">            fa[x]=f;</span><br><span class="line">            <span class="built_in">link</span>(x,f);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><hr><h2 id="树上求割边割点数量"><a href="#树上求割边割点数量" class="headerlink" title="树上求割边割点数量"></a>树上求割边割点数量</h2><p><img src="https://img-blog.csdnimg.cn/0b6e167bccd14aa2b23adb62eb51fce1.png" alt="在这里插入图片描述"></p><figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> N 200010</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> lc(x) ch[x][0]</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> rc(x) ch[x][1]</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">swap</span><span class="params">(<span class="type">int</span>&amp;a,<span class="type">int</span>&amp;b)</span> </span>{</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">tmp</span><span class="params">(a)</span></span>; a=b,b=tmp;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> Summer {</span><br><span class="line"><span class="type">int</span> ch[N][<span class="number">2</span>],fa[N],rev[N],val[N],sumv[N],mark[N];</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">reverse</span><span class="params">(<span class="type">int</span> x)</span> </span>{</span><br><span class="line"><span class="keyword">if</span>(x) {</span><br><span class="line"><span class="built_in">swap</span>(<span class="built_in">lc</span>(x),<span class="built_in">rc</span>(x));</span><br><span class="line">rev[x]^=<span class="number">1</span>;</span><br><span class="line">}</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">NaCly_Fish_Orz</span><span class="params">(<span class="type">int</span> x)</span> </span>{</span><br><span class="line"><span class="keyword">if</span>(x) {</span><br><span class="line">val[x]=sumv[x]=<span class="number">0</span>;</span><br><span class="line">mark[x]=<span class="number">1</span>;</span><br><span class="line">}</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">up</span><span class="params">(<span class="type">int</span> x)</span> </span>{</span><br><span class="line">sumv[x]=sumv[<span class="built_in">lc</span>(x)]+sumv[<span class="built_in">rc</span>(x)]+val[x];</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">down</span><span class="params">(<span class="type">int</span> x)</span> </span>{</span><br><span class="line"><span class="keyword">if</span>(rev[x]) {</span><br><span class="line"><span class="built_in">reverse</span>(<span class="built_in">lc</span>(x));</span><br><span class="line"><span class="built_in">reverse</span>(<span class="built_in">rc</span>(x));</span><br><span class="line">rev[x]=<span class="number">0</span>;</span><br><span class="line">}</span><br><span class="line"><span class="keyword">if</span>(mark[x]) {</span><br><span class="line"><span class="built_in">NaCly_Fish_Orz</span>(<span class="built_in">lc</span>(x));</span><br><span class="line"><span class="built_in">NaCly_Fish_Orz</span>(<span class="built_in">rc</span>(x));</span><br><span class="line">mark[x]=<span class="number">0</span>;</span><br><span class="line">}</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">nrt</span><span class="params">(<span class="type">int</span> x)</span> </span>{</span><br><span class="line"><span class="keyword">return</span> x==<span class="built_in">lc</span>(fa[x])||x==<span class="built_in">rc</span>(fa[x]);</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">psa</span><span class="params">(<span class="type">int</span> x)</span> </span>{</span><br><span class="line"><span class="keyword">if</span>(<span class="built_in">nrt</span>(x)) <span class="built_in">psa</span>(fa[x]);</span><br><span class="line"><span class="built_in">down</span>(x);</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">rotate</span><span class="params">(<span class="type">int</span> x)</span> </span>{</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">y</span><span class="params">(fa[x])</span>,<span class="title">z</span><span class="params">(fa[y])</span>,<span class="title">k</span><span class="params">(x==rc(y))</span></span>;</span><br><span class="line">ch[y][k]=ch[x][k^<span class="number">1</span>],ch[x][k^<span class="number">1</span>]=y;</span><br><span class="line"><span class="keyword">if</span>(<span class="built_in">nrt</span>(y)) ch[z][y==<span class="built_in">rc</span>(z)]=x;</span><br><span class="line"><span class="keyword">if</span>(ch[y][k]) fa[ch[y][k]]=y;</span><br><span class="line">fa[y]=x,fa[x]=z,<span class="built_in">up</span>(y);</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">splay</span><span class="params">(<span class="type">int</span> x)</span> </span>{</span><br><span class="line"><span class="type">int</span> y,z;</span><br><span class="line"><span class="keyword">for</span>(<span class="built_in">psa</span>(x);<span class="built_in">nrt</span>(x);<span class="built_in">rotate</span>(x)) {</span><br><span class="line">y=fa[x],z=fa[y];</span><br><span class="line"><span class="keyword">if</span>(<span class="built_in">nrt</span>(y)) <span class="built_in">rotate</span>(x==<span class="built_in">rc</span>(y)^y==<span class="built_in">rc</span>(z)?x:y);</span><br><span class="line">} <span class="built_in">up</span>(x);</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">access</span><span class="params">(<span class="type">int</span> x)</span> </span>{</span><br><span class="line"><span class="keyword">for</span>(<span class="type">int</span> y=<span class="number">0</span>;x;x=fa[y=x]) {</span><br><span class="line"><span class="built_in">splay</span>(x); <span class="built_in">rc</span>(x)=y; <span class="built_in">up</span>(x);</span><br><span class="line">}</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">mrt</span><span class="params">(<span class="type">int</span> x)</span> </span>{</span><br><span class="line"><span class="built_in">access</span>(x); <span class="built_in">splay</span>(x); <span class="built_in">reverse</span>(x);</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">link</span><span class="params">(<span class="type">int</span> x,<span class="type">int</span> y)</span> </span>{</span><br><span class="line"><span class="built_in">mrt</span>(x); fa[x]=y;</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">cut</span><span class="params">(<span class="type">int</span> x,<span class="type">int</span> y)</span> </span>{</span><br><span class="line"><span class="built_in">mrt</span>(x); <span class="built_in">access</span>(y); <span class="built_in">splay</span>(y);</span><br><span class="line">fa[x]=<span class="built_in">lc</span>(y)=<span class="number">0</span>; <span class="built_in">up</span>(y);</span><br><span class="line">}</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> Pockets {</span><br><span class="line"><span class="type">int</span> ch[N][<span class="number">2</span>],fa[N],rev[N],val[N],sumv[N],st[N],num;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">reverse</span><span class="params">(<span class="type">int</span> x)</span> </span>{</span><br><span class="line"><span class="keyword">if</span>(x) {</span><br><span class="line"><span class="built_in">swap</span>(<span class="built_in">lc</span>(x),<span class="built_in">rc</span>(x));</span><br><span class="line">rev[x]^=<span class="number">1</span>;</span><br><span class="line">}</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">up</span><span class="params">(<span class="type">int</span> x)</span> </span>{</span><br><span class="line">sumv[x]=sumv[<span class="built_in">lc</span>(x)]+sumv[<span class="built_in">rc</span>(x)]+val[x];</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">down</span><span class="params">(<span class="type">int</span> x)</span> </span>{</span><br><span class="line"><span class="keyword">if</span>(rev[x]) {</span><br><span class="line"><span class="built_in">reverse</span>(<span class="built_in">lc</span>(x));</span><br><span class="line"><span class="built_in">reverse</span>(<span class="built_in">rc</span>(x));</span><br><span class="line">rev[x]=<span class="number">0</span>;</span><br><span class="line">}</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">nrt</span><span class="params">(<span class="type">int</span> x)</span> </span>{</span><br><span class="line"><span class="keyword">return</span> x==<span class="built_in">lc</span>(fa[x])||x==<span class="built_in">rc</span>(fa[x]);</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">psa</span><span class="params">(<span class="type">int</span> x)</span> </span>{</span><br><span class="line"><span class="keyword">if</span>(<span class="built_in">nrt</span>(x)) <span class="built_in">psa</span>(fa[x]);</span><br><span class="line"><span class="built_in">down</span>(x);</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">rotate</span><span class="params">(<span class="type">int</span> x)</span> </span>{</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">y</span><span class="params">(fa[x])</span>,<span class="title">z</span><span class="params">(fa[y])</span>,<span class="title">k</span><span class="params">(x==rc(y))</span></span>;</span><br><span class="line">ch[y][k]=ch[x][k^<span class="number">1</span>],ch[x][k^<span class="number">1</span>]=y;</span><br><span class="line"><span class="keyword">if</span>(<span class="built_in">nrt</span>(y)) ch[z][y==<span class="built_in">rc</span>(z)]=x;</span><br><span class="line"><span class="keyword">if</span>(ch[y][k]) fa[ch[y][k]]=y;</span><br><span class="line">fa[y]=x,fa[x]=z,<span class="built_in">up</span>(y);</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">splay</span><span class="params">(<span class="type">int</span> x)</span> </span>{</span><br><span class="line"><span class="type">int</span> y,z;</span><br><span class="line"><span class="keyword">for</span>(<span class="built_in">psa</span>(x);<span class="built_in">nrt</span>(x);<span class="built_in">rotate</span>(x)) {</span><br><span class="line">y=fa[x],z=fa[y];</span><br><span class="line"><span class="keyword">if</span>(<span class="built_in">nrt</span>(y)) <span class="built_in">rotate</span>(x==<span class="built_in">rc</span>(y)^y==<span class="built_in">rc</span>(z)?x:y);</span><br><span class="line">} <span class="built_in">up</span>(x);</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">access</span><span class="params">(<span class="type">int</span> x)</span> </span>{</span><br><span class="line"><span class="keyword">for</span>(<span class="type">int</span> y=<span class="number">0</span>;x;x=fa[y=x]) {</span><br><span class="line"><span class="built_in">splay</span>(x); <span class="built_in">rc</span>(x)=y; <span class="built_in">up</span>(x);</span><br><span class="line">}</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">mrt</span><span class="params">(<span class="type">int</span> x)</span> </span>{</span><br><span class="line"><span class="built_in">access</span>(x); <span class="built_in">splay</span>(x); <span class="built_in">reverse</span>(x);</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">link</span><span class="params">(<span class="type">int</span> x,<span class="type">int</span> y)</span> </span>{</span><br><span class="line"><span class="built_in">mrt</span>(x); fa[x]=y;</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">cut</span><span class="params">(<span class="type">int</span> x,<span class="type">int</span> y)</span> </span>{</span><br><span class="line"><span class="built_in">mrt</span>(x); <span class="built_in">access</span>(y); <span class="built_in">splay</span>(y);</span><br><span class="line">fa[x]=<span class="built_in">lc</span>(y)=<span class="number">0</span>; <span class="built_in">up</span>(y);</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">print</span><span class="params">(<span class="type">int</span> now)</span> </span>{</span><br><span class="line"><span class="keyword">if</span>(now) {</span><br><span class="line"><span class="built_in">down</span>(now);</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">lc</span>(now));</span><br><span class="line">st[++num]=now;</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">rc</span>(now));</span><br><span class="line">}</span><br><span class="line">}</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> n,q,opt,u,v,last,tot,ans,SummerPockets;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> fa[N];</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">find</span><span class="params">(<span class="type">int</span> x)</span> </span>{</span><br><span class="line"><span class="keyword">return</span> x==fa[x]?x:fa[x]=<span class="built_in">find</span>(fa[x]);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">getEdge</span><span class="params">(<span class="type">int</span> u,<span class="type">int</span> v)</span> </span>{</span><br><span class="line"><span class="type">int</span> x=<span class="built_in">find</span>(u),y=<span class="built_in">find</span>(v);</span><br><span class="line"><span class="keyword">if</span>(x!=y) {</span><br><span class="line">ans=<span class="number">-1</span>;</span><br><span class="line"><span class="keyword">return</span>;</span><br><span class="line">}</span><br><span class="line">Summer::<span class="built_in">mrt</span>(u);</span><br><span class="line">Summer::<span class="built_in">access</span>(v);</span><br><span class="line">Summer::<span class="built_in">splay</span>(v);</span><br><span class="line">ans=Summer::sumv[v];</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">getPoint</span><span class="params">(<span class="type">int</span> u,<span class="type">int</span> v)</span> </span>{</span><br><span class="line"><span class="type">int</span> x=<span class="built_in">find</span>(u),y=<span class="built_in">find</span>(v);</span><br><span class="line"><span class="keyword">if</span>(x!=y) {</span><br><span class="line">ans=<span class="number">-1</span>;</span><br><span class="line"><span class="keyword">return</span>;</span><br><span class="line">}</span><br><span class="line">Pockets::<span class="built_in">mrt</span>(u);</span><br><span class="line">Pockets::<span class="built_in">access</span>(v);</span><br><span class="line">Pockets::<span class="built_in">splay</span>(v);</span><br><span class="line">ans=Pockets::sumv[v];</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">link</span><span class="params">(<span class="type">int</span> u,<span class="type">int</span> v)</span> </span>{</span><br><span class="line"><span class="type">int</span> x=<span class="built_in">find</span>(u),y=<span class="built_in">find</span>(v);</span><br><span class="line"><span class="keyword">if</span>(x==y) {</span><br><span class="line">Summer::<span class="built_in">mrt</span>(u);</span><br><span class="line">Summer::<span class="built_in">access</span>(v);</span><br><span class="line">Summer::<span class="built_in">splay</span>(v);</span><br><span class="line">Summer::<span class="built_in">NaCly_Fish_Orz</span>(v);</span><br><span class="line"></span><br><span class="line"><span class="built_in">getPoint</span>(u,v);</span><br><span class="line"><span class="keyword">if</span>(ans&gt;<span class="number">2</span>) {</span><br><span class="line">++SummerPockets;</span><br><span class="line">Pockets::<span class="built_in">mrt</span>(u);</span><br><span class="line">Pockets::<span class="built_in">access</span>(v);</span><br><span class="line">Pockets::<span class="built_in">splay</span>(v);</span><br><span class="line">Pockets::num=<span class="number">0</span>;</span><br><span class="line">Pockets::<span class="built_in">print</span>(v);</span><br><span class="line"><span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;Pockets::num;++i)</span><br><span class="line">Pockets::<span class="built_in">cut</span>(Pockets::st[i],Pockets::st[i+<span class="number">1</span>]);</span><br><span class="line"><span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=Pockets::num;++i)</span><br><span class="line">Pockets::<span class="built_in">link</span>(Pockets::st[i],SummerPockets);</span><br><span class="line">}</span><br><span class="line">} <span class="keyword">else</span> {</span><br><span class="line">++tot; fa[y]=x;</span><br><span class="line">Summer::val[tot]=<span class="number">1</span>;</span><br><span class="line">Summer::<span class="built_in">link</span>(u,tot);</span><br><span class="line">Summer::<span class="built_in">link</span>(tot,v);</span><br><span class="line"></span><br><span class="line">Pockets::<span class="built_in">link</span>(u,v);</span><br><span class="line">}</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>{</span><br><span class="line"><span class="built_in">scanf</span>(<span class="string">"%d%d"</span>,&amp;n,&amp;q);</span><br><span class="line">tot=SummerPockets=n;</span><br><span class="line"><span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;++i)</span><br><span class="line">fa[i]=i,Pockets::val[i]=<span class="number">1</span>;</span><br><span class="line"><span class="keyword">while</span>(q--) {</span><br><span class="line"><span class="built_in">scanf</span>(<span class="string">"%d%d%d"</span>,&amp;opt,&amp;u,&amp;v);</span><br><span class="line">u^=last,v^=last;</span><br><span class="line"><span class="keyword">switch</span>(opt) {</span><br><span class="line"><span class="keyword">case</span> <span class="number">1</span>: {</span><br><span class="line"><span class="built_in">link</span>(u,v);</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">}</span><br><span class="line"><span class="keyword">case</span> <span class="number">2</span>: {</span><br><span class="line"><span class="built_in">getEdge</span>(u,v);</span><br><span class="line"><span class="keyword">if</span>(ans!=<span class="number">-1</span>) last=ans;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"%d\n"</span>,ans);</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">}</span><br><span class="line"><span class="keyword">default</span>: {</span><br><span class="line"><span class="built_in">getPoint</span>(u,v);</span><br><span class="line"><span class="keyword">if</span>(ans!=<span class="number">-1</span>) last=ans;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"%d\n"</span>,ans);</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">}</span><br><span class="line">}</span><br><span class="line">}</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">}</span><br><span class="line"> </span><br></pre></td></tr></tbody></table></figure><hr><h2 id="LCT-LCA"><a href="#LCT-LCA" class="headerlink" title="LCT+LCA"></a>LCT+LCA</h2><p><img src="https://img-blog.csdnimg.cn/3faf3b25eaf2445ba680c5d3876a14cd.png" alt="在这里插入图片描述"></p><p>1操作很容易联想到LCT的access，考虑对于剩下俩操作的维护，但其实对于树上点到根的路径权值具有可减性，于是维护这样一个距离，然后用树上差分回答2询问，因为一个点的子树在dfs序上是连续的一段，可以用线段树维护最大值回答3询问</p><p>这个题就成了3个板子的嵌套+巧妙的LCT，线段树和lca都是基础了不必再赘述</p><p>巧妙的LCT在于可以用这个题加深对access的理解，单独拿出access来说</p><figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">access</span><span class="params">(<span class="type">int</span> x)</span> </span>{</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> y = <span class="number">0</span>; x; y = x, x = fa[x]) {</span><br><span class="line">        <span class="built_in">splay</span>(x); rs = y; <span class="comment">//pushup(x);</span></span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">access</span><span class="params">(<span class="type">int</span> x)</span> </span>{</span><br><span class="line">    <span class="type">int</span> c;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> y = <span class="number">0</span>; x; y = x, x = fa[x]) {</span><br><span class="line">        <span class="built_in">splay</span>(x);</span><br><span class="line">        <span class="keyword">if</span> (rs) c = <span class="built_in">findrt</span>(rs), SEG::<span class="built_in">change</span>(<span class="number">1</span>, <span class="number">1</span>, n, dfn[c], dfn[c] + siz[c] - <span class="number">1</span>, <span class="number">1</span>);</span><br><span class="line">        <span class="keyword">if</span> (rs = y) c = <span class="built_in">findrt</span>(y), SEG::<span class="built_in">change</span>(<span class="number">1</span>, <span class="number">1</span>, n, dfn[c], dfn[c] + siz[c] - <span class="number">1</span>, <span class="number">-1</span>);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>access实质是我们要对于x到根路径全部变成实边，我们要的是对于维护的信息进行修改</p><p>考虑性质，虚边有贡献，而实边没有贡献，在具体实现过程中，对于点x，遇到它的父亲到它为虚边则变实，然后整个子树到根节点的距离-1，然后把x的父亲原来连的实边的那个子树贡献+1，即可解决1操作</p><figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cmath&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;queue&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> q(x, y) SEG::query(1, 1, n, x, y)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> inf 1e9</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">file</span><span class="params">()</span> </span>{</span><br><span class="line">    <span class="built_in">freopen</span>(<span class="string">"read.in"</span>, <span class="string">"r"</span>, stdin);</span><br><span class="line">    <span class="built_in">freopen</span>(<span class="string">"write.out"</span>, <span class="string">"w"</span>, stdout);</span><br><span class="line">}</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N = <span class="number">1e6</span> + <span class="number">10</span>;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">read</span><span class="params">()</span> </span>{</span><br><span class="line">    <span class="type">int</span> sym = <span class="number">0</span>, res = <span class="number">0</span>; <span class="type">char</span> ch = <span class="built_in">getchar</span>();</span><br><span class="line">    <span class="keyword">while</span> (!<span class="built_in">isdigit</span>(ch)) sym |= (ch == <span class="string">'-'</span>), ch = <span class="built_in">getchar</span>();</span><br><span class="line">    <span class="keyword">while</span> (<span class="built_in">isdigit</span>(ch)) res = (res &lt;&lt; <span class="number">3</span>) + (res &lt;&lt; <span class="number">1</span>) + (ch ^ <span class="number">48</span>), ch = <span class="built_in">getchar</span>();</span><br><span class="line">    <span class="keyword">return</span> sym ? -res : res;</span><br><span class="line">}</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">EDGE</span> {</span><br><span class="line">    <span class="type">int</span> u, v, nxt;</span><br><span class="line">} edge[N];</span><br><span class="line"><span class="type">int</span> n, m, head[N], cnt, dfn[N], siz[N], depth[N], rev[N];</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">add</span><span class="params">(<span class="type">int</span> u, <span class="type">int</span> v)</span> </span>{edge[++cnt] = (EDGE){u, v, head[u]}; head[u] = cnt;}</span><br><span class="line"><span class="keyword">namespace</span> SEG {</span><br><span class="line">    <span class="type">int</span> tmax[N], tag[N];</span><br><span class="line">    <span class="meta">#<span class="keyword">define</span> ls x &lt;&lt; 1</span></span><br><span class="line">    <span class="meta">#<span class="keyword">define</span> rs x &lt;&lt; 1 | 1</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">pushup</span><span class="params">(<span class="type">int</span> x)</span> </span>{tmax[x] = <span class="built_in">max</span>(tmax[ls], tmax[rs]);}</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">update</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> t)</span> </span>{tmax[x] += t; tag[x] += t;}</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">pushdown</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> l, <span class="type">int</span> r, <span class="type">int</span> mid)</span> </span>{</span><br><span class="line">        <span class="keyword">if</span> (tag[x]) {</span><br><span class="line">            <span class="built_in">update</span>(ls, tag[x]); <span class="built_in">update</span>(rs, tag[x]); tag[x] = <span class="number">0</span>;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">build</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> l, <span class="type">int</span> r)</span> </span>{</span><br><span class="line">        <span class="keyword">if</span> (l == r) {tmax[x] = depth[rev[l]]; <span class="keyword">return</span>;}</span><br><span class="line">        <span class="type">int</span> mid = l + r &gt;&gt; <span class="number">1</span>;</span><br><span class="line">        <span class="built_in">build</span>(ls, l, mid); <span class="built_in">build</span>(rs, mid + <span class="number">1</span>, r);</span><br><span class="line">        <span class="built_in">pushup</span>(x);</span><br><span class="line">    }</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">change</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> l, <span class="type">int</span> r, <span class="type">int</span> ln, <span class="type">int</span> rn, <span class="type">int</span> t)</span> </span>{</span><br><span class="line">        <span class="keyword">if</span> (ln &lt;= l &amp;&amp; r &lt;= rn) {<span class="built_in">update</span>(x, t); <span class="keyword">return</span>;}</span><br><span class="line">        <span class="type">int</span> mid = l + r &gt;&gt; <span class="number">1</span>; <span class="built_in">pushdown</span>(x, l, r, mid);</span><br><span class="line">        <span class="keyword">if</span> (mid &gt;= ln) <span class="built_in">change</span>(ls, l, mid, ln, rn, t);</span><br><span class="line">        <span class="keyword">if</span> (mid + <span class="number">1</span> &lt;= rn) <span class="built_in">change</span>(rs, mid + <span class="number">1</span>, r, ln, rn, t);</span><br><span class="line">        <span class="built_in">pushup</span>(x);</span><br><span class="line">    }</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">query</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> l, <span class="type">int</span> r, <span class="type">int</span> ln, <span class="type">int</span> rn)</span> </span>{</span><br><span class="line">        <span class="keyword">if</span> (ln &lt;= l &amp;&amp; r &lt;= rn) <span class="keyword">return</span> tmax[x];</span><br><span class="line">        <span class="type">int</span> mid = l + r &gt;&gt; <span class="number">1</span>, res = <span class="number">0</span>; <span class="built_in">pushdown</span>(x, l, r, mid);</span><br><span class="line">        <span class="keyword">if</span> (mid &gt;= ln) res = <span class="built_in">max</span>(res, <span class="built_in">query</span>(ls, l, mid, ln, rn));</span><br><span class="line">        <span class="keyword">if</span> (mid + <span class="number">1</span> &lt;= rn) res = <span class="built_in">max</span>(res, <span class="built_in">query</span>(rs, mid + <span class="number">1</span>, r, ln, rn));</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"><span class="keyword">namespace</span> LCT {</span><br><span class="line">    <span class="type">int</span> son[N][<span class="number">2</span>], fa[N];</span><br><span class="line">    <span class="meta">#<span class="keyword">define</span> ls son[x][0]</span></span><br><span class="line">    <span class="meta">#<span class="keyword">define</span> rs son[x][1]</span></span><br><span class="line">    <span class="function"><span class="type">bool</span> <span class="title">l_r</span><span class="params">(<span class="type">int</span> x)</span> </span>{<span class="keyword">return</span> x == son[fa[x]][<span class="number">1</span>];}</span><br><span class="line">    <span class="function"><span class="type">bool</span> <span class="title">isroot</span><span class="params">(<span class="type">int</span> x)</span> </span>{<span class="keyword">return</span> son[fa[x]][<span class="number">0</span>] != x &amp;&amp; son[fa[x]][<span class="number">1</span>] != x;}</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">findrt</span><span class="params">(<span class="type">int</span> x)</span> </span>{<span class="keyword">while</span> (ls) x = ls; <span class="keyword">return</span> x;}</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">rotate</span><span class="params">(<span class="type">int</span> x)</span> </span>{</span><br><span class="line">        <span class="type">int</span> y = fa[x], z = fa[y], kind = <span class="built_in">l_r</span>(x);</span><br><span class="line">        <span class="keyword">if</span> (!<span class="built_in">isroot</span>(y)) son[z][<span class="built_in">l_r</span>(y)] = x;</span><br><span class="line">        son[y][kind] = son[x][kind ^ <span class="number">1</span>]; fa[son[x][kind ^ <span class="number">1</span>]] = y;</span><br><span class="line">        son[x][kind ^ <span class="number">1</span>] = y; fa[y] = x; fa[x] = z;</span><br><span class="line">    }</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">splay</span><span class="params">(<span class="type">int</span> x)</span> </span>{</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> y = fa[x]; !<span class="built_in">isroot</span>(x); y = fa[x]) {</span><br><span class="line">            <span class="keyword">if</span> (!<span class="built_in">isroot</span>(y)) <span class="built_in">rotate</span>(<span class="built_in">l_r</span>(x) == <span class="built_in">l_r</span>(y) ? y : x); <span class="built_in">rotate</span>(x);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">access</span><span class="params">(<span class="type">int</span> x)</span> </span>{</span><br><span class="line">        <span class="type">int</span> c;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> y = <span class="number">0</span>; x; y = x, x = fa[x]) {</span><br><span class="line">            <span class="built_in">splay</span>(x);</span><br><span class="line">            <span class="keyword">if</span> (rs) c = <span class="built_in">findrt</span>(rs), SEG::<span class="built_in">change</span>(<span class="number">1</span>, <span class="number">1</span>, n, dfn[c], dfn[c] + siz[c] - <span class="number">1</span>, <span class="number">1</span>);</span><br><span class="line">            <span class="keyword">if</span> (rs = y) c = <span class="built_in">findrt</span>(y), SEG::<span class="built_in">change</span>(<span class="number">1</span>, <span class="number">1</span>, n, dfn[c], dfn[c] + siz[c] - <span class="number">1</span>, <span class="number">-1</span>);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"><span class="keyword">namespace</span> LCA {</span><br><span class="line">    <span class="type">int</span> top[N], son[N], fa[N];</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">dfs1</span><span class="params">(<span class="type">int</span> u, <span class="type">int</span> last)</span> </span>{</span><br><span class="line">        depth[u] = depth[last] + <span class="number">1</span>; siz[u] = <span class="number">1</span>; fa[u] = last;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> e = head[u]; e; e = edge[e].nxt) {</span><br><span class="line">            <span class="type">int</span> v = edge[e].v; <span class="keyword">if</span> (v == last) <span class="keyword">continue</span>; <span class="built_in">dfs1</span>(v, u);</span><br><span class="line">            siz[u] += siz[v]; <span class="keyword">if</span> (siz[v] &gt; siz[son[u]]) son[u] = v;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">dfs2</span><span class="params">(<span class="type">int</span> u, <span class="type">int</span> front)</span> </span>{</span><br><span class="line">        dfn[u] = ++cnt; rev[cnt] = u; top[u] = front; <span class="keyword">if</span> (son[u]) <span class="built_in">dfs2</span>(son[u], front);</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> e = head[u]; e; e = edge[e].nxt) {</span><br><span class="line">            <span class="type">int</span> v = edge[e].v; <span class="keyword">if</span> (v == fa[u] || v == son[u]) <span class="keyword">continue</span>; <span class="built_in">dfs2</span>(v, v);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">lca</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y)</span> </span>{</span><br><span class="line">        <span class="keyword">while</span> (top[x] != top[y]) depth[top[x]] &lt; depth[top[y]] ? y = fa[top[y]] : x = fa[top[x]];</span><br><span class="line">        <span class="keyword">return</span> depth[x] &lt; depth[y] ? x : y;</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>{</span><br><span class="line">    n = <span class="built_in">read</span>(); m = <span class="built_in">read</span>();</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt; n; i++) {</span><br><span class="line">        <span class="type">int</span> u = <span class="built_in">read</span>(), v = <span class="built_in">read</span>(); <span class="built_in">add</span>(u, v); <span class="built_in">add</span>(v, u);</span><br><span class="line">    }</span><br><span class="line">    cnt = <span class="number">0</span>; LCA::<span class="built_in">dfs1</span>(<span class="number">1</span>, <span class="number">0</span>); LCA::<span class="built_in">dfs2</span>(<span class="number">1</span>, <span class="number">1</span>); cnt = <span class="number">0</span>; SEG::<span class="built_in">build</span>(<span class="number">1</span>, <span class="number">1</span>, n);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i++) LCT::fa[i] = LCA::fa[i];</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= m; i++) {</span><br><span class="line">        <span class="type">int</span> opt = <span class="built_in">read</span>(), x = <span class="built_in">read</span>();</span><br><span class="line">        <span class="keyword">if</span> (opt == <span class="number">1</span>) LCT::<span class="built_in">access</span>(x);</span><br><span class="line">        <span class="keyword">if</span> (opt == <span class="number">2</span>) {</span><br><span class="line">            <span class="type">int</span> y = <span class="built_in">read</span>(), lca = LCA::<span class="built_in">lca</span>(x, y);</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">"%d\n"</span>, <span class="built_in">q</span>(dfn[x], dfn[x]) + <span class="built_in">q</span>(dfn[y], dfn[y]) - <span class="number">2</span> * <span class="built_in">q</span>(dfn[lca], dfn[lca]) + <span class="number">1</span>);</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">if</span> (opt == <span class="number">3</span>) {</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">"%d\n"</span>, <span class="built_in">q</span>(dfn[x], dfn[x] + siz[x] - <span class="number">1</span>));</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">}</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure><hr><h2 id="LCT懒标记"><a href="#LCT懒标记" class="headerlink" title="LCT懒标记"></a>LCT懒标记</h2><p><img src="https://img-blog.csdnimg.cn/14df1f4844f94ddcbf8fd17f18b8d822.png" alt="在这里插入图片描述"></p><figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="keyword">define</span> int long long</span></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N=<span class="number">1e5</span>+<span class="number">10</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> mod=<span class="number">51061</span>;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">node</span>{</span><br><span class="line">    <span class="type">int</span> s[<span class="number">2</span>],p,v;</span><br><span class="line">    <span class="type">int</span> sum,rev,mul,add,sz;</span><br><span class="line">    <span class="meta">#<span class="keyword">define</span> ls tr[u].s[0]</span></span><br><span class="line">    <span class="meta">#<span class="keyword">define</span> lx tr[x].s[0]</span></span><br><span class="line">    <span class="meta">#<span class="keyword">define</span> rs tr[u].s[1]</span></span><br><span class="line">    <span class="meta">#<span class="keyword">define</span> rx tr[x].s[1]</span></span><br><span class="line">}tr[N];</span><br><span class="line"><span class="type">int</span> n,m,op,x,y;</span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="keyword">inline</span> <span class="title">isroot</span><span class="params">(<span class="type">int</span> u)</span></span>{</span><br><span class="line">    <span class="keyword">return</span> tr[tr[u].p].s[<span class="number">0</span>]!=u&amp;&amp;tr[tr[u].p].s[<span class="number">1</span>]!=u;</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="keyword">inline</span> <span class="title">pushup</span><span class="params">(<span class="type">int</span> u)</span></span>{</span><br><span class="line">    tr[u].sum=(tr[ls].sum+tr[u].v+tr[rs].sum)%mod;</span><br><span class="line">    tr[u].sz=tr[ls].sz+tr[rs].sz+<span class="number">1</span>;</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="keyword">inline</span> <span class="title">pushrev</span><span class="params">(<span class="type">int</span> u)</span></span>{</span><br><span class="line">    <span class="built_in">swap</span>(ls,rs);</span><br><span class="line">    tr[u].rev^=<span class="number">1</span>;</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">pushmul</span><span class="params">(<span class="type">int</span> u,<span class="type">int</span> v)</span></span>{</span><br><span class="line">    tr[u].sum=tr[u].sum*v%mod;</span><br><span class="line">    tr[u].v=tr[u].v*v%mod;</span><br><span class="line">    tr[u].add=tr[u].add*v%mod;</span><br><span class="line">    tr[u].mul=tr[u].mul*v%mod;</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">pushadd</span><span class="params">(<span class="type">int</span> u,<span class="type">int</span> v)</span></span>{</span><br><span class="line">    tr[u].sum=(tr[u].sum+tr[u].sz*v)%mod;</span><br><span class="line">    tr[u].v=(tr[u].v+v)%mod;</span><br><span class="line">    tr[u].add=(tr[u].add+v)%mod;</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="keyword">inline</span> <span class="title">pushdown</span><span class="params">(<span class="type">int</span> u)</span></span>{</span><br><span class="line">    <span class="keyword">if</span>(tr[u].rev){</span><br><span class="line">        <span class="built_in">pushrev</span>(ls),<span class="built_in">pushrev</span>(rs);</span><br><span class="line">        tr[u].rev=<span class="number">0</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">if</span>(tr[u].mul!=<span class="number">1</span>){</span><br><span class="line">        <span class="built_in">pushmul</span>(ls,tr[u].mul),<span class="built_in">pushmul</span>(rs,tr[u].mul);</span><br><span class="line">        tr[u].mul=<span class="number">1</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">if</span>(tr[u].add!=<span class="number">0</span>){</span><br><span class="line">        <span class="built_in">pushadd</span>(ls,tr[u].add),<span class="built_in">pushadd</span>(rs,tr[u].add);</span><br><span class="line">        tr[u].add=<span class="number">0</span>;</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="keyword">inline</span> <span class="title">rotate</span><span class="params">(<span class="type">int</span> x)</span></span>{</span><br><span class="line">    <span class="type">int</span> y=tr[x].p,z=tr[y].p;</span><br><span class="line">    <span class="type">int</span> k=tr[y].s[<span class="number">1</span>]==x;</span><br><span class="line">    <span class="keyword">if</span>(!<span class="built_in">isroot</span>(y))tr[z].s[tr[z].s[<span class="number">1</span>]==y]=x;</span><br><span class="line">    tr[x].p=z;</span><br><span class="line">    tr[y].s[k]=tr[x].s[k^<span class="number">1</span>],tr[tr[x].s[k^<span class="number">1</span>]].p=y;</span><br><span class="line">    tr[x].s[k^<span class="number">1</span>]=y,tr[y].p=x;</span><br><span class="line">    <span class="built_in">pushup</span>(y),<span class="built_in">pushup</span>(x);</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="keyword">inline</span> <span class="title">splay</span><span class="params">(<span class="type">int</span> x)</span></span>{</span><br><span class="line">    <span class="type">static</span> <span class="type">int</span> stk[N];</span><br><span class="line">    <span class="type">int</span> tt=<span class="number">0</span>,t=x;</span><br><span class="line">    stk[++tt]=t;</span><br><span class="line">    <span class="keyword">while</span>(!<span class="built_in">isroot</span>(t))stk[++tt]=t=tr[t].p;</span><br><span class="line">    <span class="keyword">while</span>(tt)<span class="built_in">pushdown</span>(stk[tt--]);</span><br><span class="line">    <span class="keyword">while</span>(!<span class="built_in">isroot</span>(x)){</span><br><span class="line">        <span class="type">int</span> y=tr[x].p,z=tr[y].p;</span><br><span class="line">        <span class="keyword">if</span>(!<span class="built_in">isroot</span>(y)){</span><br><span class="line">            <span class="keyword">if</span>( (tr[z].s[<span class="number">1</span>]==y)^(tr[y].s[<span class="number">1</span>]==x) )<span class="built_in">rotate</span>(x);</span><br><span class="line">            <span class="keyword">else</span> <span class="built_in">rotate</span>(y);</span><br><span class="line">        }<span class="built_in">rotate</span>(x);</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="keyword">inline</span> <span class="title">access</span><span class="params">(<span class="type">int</span> x)</span></span>{</span><br><span class="line">    <span class="type">int</span> z=x;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> y=<span class="number">0</span>;x;y=x,x=tr[x].p){</span><br><span class="line">        <span class="built_in">splay</span>(x);</span><br><span class="line">        rx=y;</span><br><span class="line">        <span class="built_in">pushup</span>(x);</span><br><span class="line">    }</span><br><span class="line">    <span class="built_in">splay</span>(z);</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="keyword">inline</span> <span class="title">makeroot</span><span class="params">(<span class="type">int</span> x)</span></span>{</span><br><span class="line">    <span class="built_in">access</span>(x);</span><br><span class="line">    <span class="built_in">pushrev</span>(x);</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="keyword">inline</span> <span class="title">findroot</span><span class="params">(<span class="type">int</span> u)</span></span>{</span><br><span class="line">    <span class="built_in">access</span>(u);</span><br><span class="line">    <span class="keyword">while</span>(ls)<span class="built_in">pushdown</span>(u),u=ls;</span><br><span class="line">    <span class="built_in">splay</span>(u);</span><br><span class="line">    <span class="keyword">return</span> u;</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="keyword">inline</span> <span class="title">split</span><span class="params">(<span class="type">int</span> x,<span class="type">int</span> y)</span></span>{</span><br><span class="line">    <span class="built_in">makeroot</span>(x);</span><br><span class="line">    <span class="built_in">access</span>(y);</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="keyword">inline</span> <span class="title">link</span><span class="params">(<span class="type">int</span> x,<span class="type">int</span> y)</span></span>{</span><br><span class="line">    <span class="built_in">makeroot</span>(x);</span><br><span class="line">    <span class="keyword">if</span>(<span class="built_in">findroot</span>(y)!=x)tr[x].p=y;</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="keyword">inline</span> <span class="title">cut</span><span class="params">(<span class="type">int</span> x,<span class="type">int</span> y)</span></span>{</span><br><span class="line">    <span class="built_in">makeroot</span>(x);</span><br><span class="line">    <span class="keyword">if</span>(<span class="built_in">findroot</span>(y)==x&amp;&amp;rx==y&amp;&amp;!tr[y].s[<span class="number">0</span>]){</span><br><span class="line">        tr[y].p=rx=<span class="number">0</span>;</span><br><span class="line">        <span class="built_in">pushup</span>(x);</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="type">signed</span> <span class="title">main</span><span class="params">()</span></span>{</span><br><span class="line">    ios::<span class="built_in">sync_with_stdio</span>(<span class="number">0</span>);</span><br><span class="line">    cin.<span class="built_in">tie</span>(<span class="number">0</span>);</span><br><span class="line">    cout.<span class="built_in">tie</span>(<span class="number">0</span>);</span><br><span class="line">    cin&gt;&gt;n&gt;&gt;m;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;i++)tr[i].mul=tr[i].v=tr[i].sz=tr[i].sum=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;n;i++){</span><br><span class="line">        cin&gt;&gt;x&gt;&gt;y;</span><br><span class="line">        <span class="built_in">link</span>(x,y);</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">while</span>(m--){</span><br><span class="line">        <span class="type">char</span> c;</span><br><span class="line">        <span class="type">int</span> v;</span><br><span class="line">        cin&gt;&gt;c;</span><br><span class="line">        <span class="keyword">if</span>(c==<span class="string">'+'</span>){</span><br><span class="line">            cin&gt;&gt;x&gt;&gt;y&gt;&gt;v;</span><br><span class="line">            <span class="built_in">split</span>(x,y);</span><br><span class="line">            <span class="built_in">pushadd</span>(y,v);</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">if</span>(c==<span class="string">'-'</span>){</span><br><span class="line">            cin&gt;&gt;x&gt;&gt;y;<span class="built_in">cut</span>(x,y);</span><br><span class="line">            cin&gt;&gt;x&gt;&gt;y;<span class="built_in">link</span>(x,y);</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">if</span>(c==<span class="string">'*'</span>){</span><br><span class="line">            cin&gt;&gt;x&gt;&gt;y&gt;&gt;v;</span><br><span class="line">            <span class="built_in">split</span>(x,y);</span><br><span class="line">            <span class="built_in">pushmul</span>(y,v);</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">if</span>(c==<span class="string">'/'</span>){</span><br><span class="line">            cin&gt;&gt;x&gt;&gt;y;</span><br><span class="line">            <span class="built_in">split</span>(x,y);</span><br><span class="line">            cout&lt;&lt;tr[y].sum&lt;&lt;<span class="string">'\n'</span>;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><hr><h2 id="用动态树解决树链剖分问题"><a href="#用动态树解决树链剖分问题" class="headerlink" title="用动态树解决树链剖分问题"></a>用动态树解决树链剖分问题</h2><p><img src="https://img-blog.csdnimg.cn/a79a5e489d514cd4a35aef17af47b734.png" alt="在这里插入图片描述"></p><figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N=<span class="number">1e6</span>+<span class="number">10</span>;</span><br><span class="line"><span class="meta">#<span class="keyword">define</span> int long long</span></span><br><span class="line"><span class="type">int</span> n,m,p[N],stk[N];</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">find</span><span class="params">(<span class="type">int</span> x)</span></span>{</span><br><span class="line">    <span class="keyword">if</span>(p[x]!=x)p[x]=<span class="built_in">find</span>(p[x]);</span><br><span class="line">    <span class="keyword">return</span> p[x];</span><br><span class="line">}</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Edge</span>{</span><br><span class="line">    <span class="type">int</span> x,y,a,b;</span><br><span class="line">    <span class="type">bool</span> <span class="keyword">operator</span>&lt;(<span class="type">const</span> Edge&amp;t)<span class="type">const</span>{</span><br><span class="line">        <span class="keyword">return</span> a&lt;t.a;</span><br><span class="line">    }</span><br><span class="line">}e[N];</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">node</span>{</span><br><span class="line">    <span class="type">int</span> s[<span class="number">2</span>],p,v;</span><br><span class="line">    <span class="type">int</span> max,min,sum,rev,lazy;</span><br><span class="line">    <span class="meta">#<span class="keyword">define</span> ls tr[u].s[0]</span></span><br><span class="line">    <span class="meta">#<span class="keyword">define</span> rs tr[u].s[1]</span></span><br><span class="line">    <span class="meta">#<span class="keyword">define</span> lx tr[x].s[0]</span></span><br><span class="line">    <span class="meta">#<span class="keyword">define</span> rx tr[x].s[1]</span></span><br><span class="line">}tr[N];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">pushup</span><span class="params">(<span class="type">int</span> u)</span></span>{</span><br><span class="line">    tr[u].sum=tr[ls].sum+tr[u].v+tr[rs].sum;</span><br><span class="line">    <span class="keyword">if</span>(u&gt;n)tr[u].max=tr[u].min=tr[u].v;</span><br><span class="line">    <span class="keyword">else</span> tr[u].max=<span class="number">-1e9</span>,tr[u].min=<span class="number">1e9</span>;</span><br><span class="line">    <span class="keyword">if</span>(ls){</span><br><span class="line">        tr[u].max=<span class="built_in">max</span>(tr[u].max,tr[ls].max);</span><br><span class="line">        tr[u].min=<span class="built_in">min</span>(tr[u].min,tr[ls].min);</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">if</span>(rs){</span><br><span class="line">        tr[u].max=<span class="built_in">max</span>(tr[u].max,tr[rs].max);</span><br><span class="line">        tr[u].min=<span class="built_in">min</span>(tr[u].min,tr[rs].min);</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">pushrev</span><span class="params">(<span class="type">int</span> u)</span></span>{</span><br><span class="line">    <span class="built_in">swap</span>(ls,rs);</span><br><span class="line">    tr[u].rev^=<span class="number">1</span>;</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">pushlazy</span><span class="params">(<span class="type">int</span> u)</span></span>{</span><br><span class="line">    tr[u].sum=-tr[u].sum;</span><br><span class="line">    tr[u].max=-tr[u].max;</span><br><span class="line">    tr[u].min=-tr[u].min;</span><br><span class="line">    tr[u].v=-tr[u].v;</span><br><span class="line">    <span class="built_in">swap</span>(tr[u].max,tr[u].min);</span><br><span class="line">    tr[u].lazy^=<span class="number">1</span>;</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">pushdown</span><span class="params">(<span class="type">int</span> u)</span></span>{</span><br><span class="line">    <span class="keyword">if</span>(tr[u].rev){</span><br><span class="line">        <span class="built_in">pushrev</span>(ls);</span><br><span class="line">        <span class="built_in">pushrev</span>(rs);</span><br><span class="line">        tr[u].rev=<span class="number">0</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">if</span>(tr[u].lazy){</span><br><span class="line">        <span class="built_in">pushlazy</span>(ls);</span><br><span class="line">        <span class="built_in">pushlazy</span>(rs);</span><br><span class="line">        tr[u].lazy=<span class="number">0</span>;</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">isroot</span><span class="params">(<span class="type">int</span> u)</span></span>{</span><br><span class="line">    <span class="keyword">return</span> tr[tr[u].p].s[<span class="number">0</span>]!=u&amp;&amp;tr[tr[u].p].s[<span class="number">1</span>]!=u;</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">rotate</span><span class="params">(<span class="type">int</span> x)</span></span>{</span><br><span class="line">    <span class="type">int</span> y=tr[x].p,z=tr[y].p;</span><br><span class="line">    <span class="type">int</span> k=tr[y].s[<span class="number">1</span>]==x;</span><br><span class="line">    <span class="keyword">if</span>(!<span class="built_in">isroot</span>(y))tr[z].s[tr[z].s[<span class="number">1</span>]==y]=x;</span><br><span class="line">    tr[x].p=z;</span><br><span class="line">    tr[y].s[k]=tr[x].s[k^<span class="number">1</span>],tr[tr[x].s[k^<span class="number">1</span>]].p=y;</span><br><span class="line">    tr[x].s[k^<span class="number">1</span>]=y,tr[y].p=x;</span><br><span class="line">    <span class="built_in">pushup</span>(y),<span class="built_in">pushup</span>(x);</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">splay</span><span class="params">(<span class="type">int</span> x)</span></span>{</span><br><span class="line">    <span class="type">int</span> top=<span class="number">0</span>,r=x;</span><br><span class="line">    stk[++top]=r;</span><br><span class="line">    <span class="keyword">while</span>(!<span class="built_in">isroot</span>(r))stk[++top]=r=tr[r].p;</span><br><span class="line">    <span class="keyword">while</span>(top)<span class="built_in">pushdown</span>(stk[top--]);</span><br><span class="line">    <span class="keyword">while</span>(!<span class="built_in">isroot</span>(x)){</span><br><span class="line">        <span class="type">int</span> y=tr[x].p,z=tr[y].p;</span><br><span class="line">        <span class="keyword">if</span>(!<span class="built_in">isroot</span>(y)){</span><br><span class="line">            <span class="keyword">if</span>((tr[z].s[<span class="number">1</span>]==y)^(tr[y].s[<span class="number">1</span>]==x))<span class="built_in">rotate</span>(x);</span><br><span class="line">            <span class="keyword">else</span> <span class="built_in">rotate</span>(y);</span><br><span class="line">        }</span><br><span class="line">        <span class="built_in">rotate</span>(x);</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">access</span><span class="params">(<span class="type">int</span> x)</span></span>{</span><br><span class="line">    <span class="type">int</span> z=x;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> y=<span class="number">0</span>;x;y=x,x=tr[y].p){</span><br><span class="line">        <span class="built_in">splay</span>(x);</span><br><span class="line">        tr[x].s[<span class="number">1</span>]=y,<span class="built_in">pushup</span>(x);</span><br><span class="line">    }</span><br><span class="line">    <span class="built_in">splay</span>(z);</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">makeroot</span><span class="params">(<span class="type">int</span> x)</span></span>{</span><br><span class="line">    <span class="built_in">access</span>(x);</span><br><span class="line">    <span class="built_in">pushrev</span>(x);</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">findroot</span><span class="params">(<span class="type">int</span> x)</span></span>{</span><br><span class="line">    <span class="built_in">access</span>(x);</span><br><span class="line">    <span class="keyword">while</span>(lx)<span class="built_in">pushdown</span>(x),x=lx;</span><br><span class="line">    <span class="built_in">splay</span>(x);</span><br><span class="line">    <span class="keyword">return</span> x;</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">split</span><span class="params">(<span class="type">int</span> x,<span class="type">int</span> y)</span></span>{</span><br><span class="line">    <span class="built_in">makeroot</span>(x);</span><br><span class="line">    <span class="built_in">access</span>(y);</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">link</span><span class="params">(<span class="type">int</span> x,<span class="type">int</span> y)</span></span>{</span><br><span class="line">    <span class="built_in">makeroot</span>(x);</span><br><span class="line">    <span class="keyword">if</span>(<span class="built_in">findroot</span>(y)!=x)tr[x].p=y;</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">cut</span><span class="params">(<span class="type">int</span> x,<span class="type">int</span> y)</span></span>{</span><br><span class="line">    <span class="built_in">makeroot</span>(x);</span><br><span class="line">    <span class="keyword">if</span>(<span class="built_in">findroot</span>(y)==x&amp;&amp;rx==y&amp;&amp;!tr[y].s[<span class="number">0</span>]){</span><br><span class="line">        tr[y].p=rx=<span class="number">0</span>;</span><br><span class="line">        <span class="built_in">pushup</span>(x);</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">change</span><span class="params">(<span class="type">int</span> x,<span class="type">int</span> w)</span></span>{</span><br><span class="line">    <span class="built_in">splay</span>(x);</span><br><span class="line">    tr[x].v=w;</span><br><span class="line">    <span class="built_in">pushup</span>(x);</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="type">signed</span> <span class="title">main</span><span class="params">()</span></span>{</span><br><span class="line">    ios::<span class="built_in">sync_with_stdio</span>(<span class="number">0</span>);cin.<span class="built_in">tie</span>(<span class="number">0</span>);cout.<span class="built_in">tie</span>(<span class="number">0</span>);</span><br><span class="line">    cin&gt;&gt;n;</span><br><span class="line">    <span class="comment">//for(int i=1;i&lt;=n;i++)tr[i].max=-1e9,tr[i].min=1e9;</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;n;i++){</span><br><span class="line">        <span class="type">int</span> a,b,c;</span><br><span class="line">        cin&gt;&gt;a&gt;&gt;b&gt;&gt;c;</span><br><span class="line">        a++,b++;</span><br><span class="line">        tr[i+n].max=tr[i+n].min=tr[i+n].sum=tr[i+n].v=c;</span><br><span class="line">        <span class="built_in">link</span>(a,i+n),<span class="built_in">link</span>(i+n,b);</span><br><span class="line">    }</span><br><span class="line">    cin&gt;&gt;m;</span><br><span class="line">    <span class="keyword">while</span>(m--){</span><br><span class="line">        string op;</span><br><span class="line">        <span class="type">int</span> x,y;</span><br><span class="line">        cin&gt;&gt;op&gt;&gt;x&gt;&gt;y;</span><br><span class="line">        <span class="keyword">if</span>(op==<span class="string">"C"</span>){<span class="built_in">change</span>(x+n,y);<span class="keyword">continue</span>;}</span><br><span class="line">        x++,y++;</span><br><span class="line">        <span class="keyword">if</span>(op==<span class="string">"N"</span>){</span><br><span class="line">            <span class="built_in">split</span>(x,y);</span><br><span class="line">            tr[y].max=-tr[y].max;</span><br><span class="line">            tr[y].min=-tr[y].min;</span><br><span class="line">            <span class="built_in">swap</span>(tr[y].max,tr[y].min);</span><br><span class="line">            tr[y].sum=-tr[y].sum;</span><br><span class="line">            tr[y].v=-tr[y].v;</span><br><span class="line">            tr[y].lazy^=<span class="number">1</span>;</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">if</span>(op==<span class="string">"SUM"</span>){</span><br><span class="line">            <span class="built_in">split</span>(x,y);</span><br><span class="line">            cout&lt;&lt;tr[y].sum&lt;&lt;<span class="string">'\n'</span>;</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">if</span>(op==<span class="string">"MAX"</span>){</span><br><span class="line">            <span class="built_in">split</span>(x,y);</span><br><span class="line">            cout&lt;&lt;tr[y].max&lt;&lt;<span class="string">'\n'</span>;</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">if</span>(op==<span class="string">"MIN"</span>){</span><br><span class="line">            <span class="built_in">split</span>(x,y);</span><br><span class="line">            cout&lt;&lt;tr[y].min&lt;&lt;<span class="string">'\n'</span>;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>]]></content>
      
      
      <categories>
          
          <category> 算法 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 数据结构 </tag>
            
            <tag> 动态树 </tag>
            
            <tag> LCT </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>5月8号补题</title>
      <link href="/2022/05/08/5-yue-8-hao-bu-ti/"/>
      <url>/2022/05/08/5-yue-8-hao-bu-ti/</url>
      
        <content type="html"><![CDATA[<h1 id="比赛补题"><a href="#比赛补题" class="headerlink" title="比赛补题"></a>比赛补题</h1><ul><li><p><a href="https://ac.nowcoder.com/acm/contest/11226/">牛客小白月赛49_ACM/NOI/CSP/CCPC/ICPC算法编程高难度练习赛_牛客竞赛OJ (nowcoder.com)</a></p></li><li><p><a href="https://codeforces.com/contest/1670">Dashboard - Codeforces Round #788 (Div. 2) - Codeforces</a></p></li><li><p><a href="https://codeforces.com/contest/1675">Dashboard - Codeforces Round #787 (Div. 3) - Codeforces</a></p></li><li><p><a href="https://codeforces.com/contest/1674">Dashboard - Codeforces Round #786 (Div. 3) - Codeforces</a></p></li><li><p><a href="https://codeforces.com/contest/1673">Dashboard - Codeforces Round #785 (Div. 2) - Codeforces</a></p></li><li><p><a href="https://leetcode-cn.com/contest/biweekly-contest-77">第 77 场双周赛 - 力扣（LeetCode） (leetcode-cn.com)</a></p></li></ul><h1 id="疑难杂题"><a href="#疑难杂题" class="headerlink" title="疑难杂题"></a>疑难杂题</h1><p>代码源 + cf + 牛客 + atcoder + 知乎严鸽哥</p><p><a href="http://oj.daimayuan.top/course/10/problem/731">数字替换 - 题目 - Daimayuan Online Judge</a></p><figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N=<span class="number">5e5</span>+<span class="number">10</span>;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">node</span>{</span><br><span class="line">    <span class="type">int</span> t,x,y;</span><br><span class="line">}q[N];</span><br><span class="line"><span class="type">int</span> mp[N],n;</span><br><span class="line">vector&lt;<span class="type">int</span>&gt;ans;</span><br><span class="line"><span class="function"><span class="type">signed</span> <span class="title">main</span><span class="params">()</span></span>{</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;N;i++)mp[i]=i;</span><br><span class="line">    cin&gt;&gt;n;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;i++){</span><br><span class="line">        <span class="type">int</span> t,x,y;</span><br><span class="line">        cin&gt;&gt;t;</span><br><span class="line">        <span class="keyword">if</span>(t==<span class="number">1</span>){</span><br><span class="line">            cin&gt;&gt;x;</span><br><span class="line">            q[i]={t,x};</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">else</span>{</span><br><span class="line">            cin&gt;&gt;x&gt;&gt;y;</span><br><span class="line">            q[i]={t,x,y};</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=n;i&gt;=<span class="number">1</span>;i--){</span><br><span class="line">        <span class="type">int</span> t=q[i].t;</span><br><span class="line">        <span class="type">int</span> x=q[i].x;</span><br><span class="line">        <span class="type">int</span> y=q[i].y;</span><br><span class="line">        <span class="keyword">if</span>(t==<span class="number">2</span>)mp[x]=mp[y];</span><br><span class="line">        <span class="keyword">else</span> ans.<span class="built_in">push_back</span>(mp[x]);</span><br><span class="line">    }</span><br><span class="line">    <span class="built_in">reverse</span>(ans.<span class="built_in">begin</span>(),ans.<span class="built_in">end</span>());</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">auto</span> x:ans)cout&lt;&lt;x&lt;&lt;<span class="string">" "</span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><hr><p><a href="http://oj.daimayuan.top/course/10/problem/701">画画 - 题目 - Daimayuan Online Judge</a></p><figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">int</span> n,m;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N=<span class="number">1100</span>;</span><br><span class="line"><span class="type">int</span> a[N][N];</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">get</span><span class="params">(<span class="type">int</span> i,<span class="type">int</span> j)</span></span>{</span><br><span class="line">    <span class="keyword">return</span> (i<span class="number">-1</span>)*m+j;</span><br><span class="line">}</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">node</span>{</span><br><span class="line">    <span class="type">int</span> x,y,c;</span><br><span class="line">}q[N*N];</span><br><span class="line"><span class="type">int</span> xx[]={<span class="number">-1</span>,<span class="number">-1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">2</span>,<span class="number">2</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">2</span>};</span><br><span class="line"><span class="type">int</span> yy[]={<span class="number">-1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">-1</span>,<span class="number">1</span>,<span class="number">-1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">2</span>,<span class="number">2</span>};</span><br><span class="line"><span class="type">int</span> dx[]={<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>};</span><br><span class="line"><span class="type">int</span> dy[]={<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>};</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">check</span><span class="params">(<span class="type">int</span> x,<span class="type">int</span> y)</span></span>{</span><br><span class="line">    <span class="type">int</span> p=<span class="number">-1</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> t=<span class="number">0</span>;t&lt;<span class="number">4</span>;t++){</span><br><span class="line">        <span class="type">int</span> i=x+dx[t];</span><br><span class="line">        <span class="type">int</span> j=y+dy[t];</span><br><span class="line">        <span class="keyword">if</span>(i&lt;<span class="number">1</span>||i&gt;n||j&lt;<span class="number">1</span>||j&gt;m)<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> c=a[i][j];</span><br><span class="line">        <span class="keyword">if</span>(c==<span class="number">-1</span>)<span class="keyword">continue</span>;</span><br><span class="line">        <span class="keyword">if</span>(p==<span class="number">-1</span>)p=c;</span><br><span class="line">        <span class="keyword">if</span>(c!=p)<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">}</span><br><span class="line"><span class="type">int</span> vis[N][N];</span><br><span class="line"><span class="function"><span class="type">signed</span> <span class="title">main</span><span class="params">()</span></span>{</span><br><span class="line">    ios::<span class="built_in">sync_with_stdio</span>(<span class="number">0</span>);</span><br><span class="line">    cin&gt;&gt;n&gt;&gt;m;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;i++){</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">1</span>;j&lt;=m;j++)cin&gt;&gt;a[i][j];</span><br><span class="line">    }</span><br><span class="line">    <span class="type">int</span> hh=<span class="number">0</span>,tt=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;i++){</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">1</span>;j&lt;=m;j++){</span><br><span class="line">            <span class="keyword">if</span>(<span class="built_in">check</span>(i,j)){</span><br><span class="line">                q[tt++]={i,j,a[i][j]};</span><br><span class="line">                vis[i][j]=<span class="number">1</span>;</span><br><span class="line">                <span class="comment">//cout&lt;&lt;"i="&lt;&lt;i&lt;&lt;"  j="&lt;&lt;j&lt;&lt;endl;</span></span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">if</span>(hh==tt){</span><br><span class="line">        cout&lt;&lt;<span class="string">"-1"</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    }</span><br><span class="line">    stack&lt;node&gt;ans;</span><br><span class="line">    <span class="keyword">while</span>(hh&lt;tt){</span><br><span class="line">        <span class="keyword">auto</span> t=q[hh++];</span><br><span class="line">        </span><br><span class="line">        ans.<span class="built_in">push</span>(t);</span><br><span class="line">        <span class="type">int</span> x=t.x,y=t.y,c=t.c;</span><br><span class="line">        a[x][y]=<span class="number">-1</span>,a[x+<span class="number">1</span>][y]=<span class="number">-1</span>,a[x][y+<span class="number">1</span>]=<span class="number">-1</span>,a[x+<span class="number">1</span>][y+<span class="number">1</span>]=<span class="number">-1</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> t=<span class="number">0</span>;t&lt;<span class="number">14</span>;t++){</span><br><span class="line">            <span class="type">int</span> i=x+xx[t];</span><br><span class="line">            <span class="type">int</span> j=y+yy[t];</span><br><span class="line">            <span class="keyword">if</span>(i&lt;<span class="number">1</span>||i&gt;n||j&lt;<span class="number">1</span>||j&gt;m)<span class="keyword">continue</span>;</span><br><span class="line">            <span class="keyword">if</span>(vis[i][j])<span class="keyword">continue</span>;</span><br><span class="line">            <span class="type">int</span> c=<span class="number">-1</span>;</span><br><span class="line">            <span class="comment">//cout&lt;&lt;"i="&lt;&lt;i&lt;&lt;" j="&lt;&lt;j&lt;&lt;endl;</span></span><br><span class="line">            <span class="keyword">if</span>(<span class="built_in">check</span>(i,j)){</span><br><span class="line">                <span class="keyword">if</span>(a[i][j]!=<span class="number">-1</span>)c=a[i][j];</span><br><span class="line">                <span class="keyword">if</span>(a[i+<span class="number">1</span>][j]!=<span class="number">-1</span>)c=a[i+<span class="number">1</span>][j];</span><br><span class="line">                <span class="keyword">if</span>(a[i][j+<span class="number">1</span>]!=<span class="number">-1</span>)c=a[i][j+<span class="number">1</span>];</span><br><span class="line">                <span class="keyword">if</span>(a[i+<span class="number">1</span>][j+<span class="number">1</span>]!=<span class="number">-1</span>)c=a[i+<span class="number">1</span>][j+<span class="number">1</span>];</span><br><span class="line">                <span class="keyword">if</span>(c==<span class="number">-1</span>)c=<span class="number">1</span>;</span><br><span class="line">                q[tt++]={i,j,c};</span><br><span class="line">                vis[i][j]=<span class="number">1</span>;</span><br><span class="line">                <span class="comment">//cout&lt;&lt;"i="&lt;&lt;i&lt;&lt;" j="&lt;&lt;j&lt;&lt;endl;</span></span><br><span class="line">            }</span><br><span class="line">            </span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    cout&lt;&lt;ans.<span class="built_in">size</span>()&lt;&lt;<span class="string">'\n'</span>;</span><br><span class="line">    <span class="keyword">while</span>(ans.<span class="built_in">size</span>()){</span><br><span class="line">        <span class="keyword">auto</span> t=ans.<span class="built_in">top</span>();</span><br><span class="line">        ans.<span class="built_in">pop</span>();</span><br><span class="line">        cout&lt;&lt;t.x&lt;&lt;<span class="string">" "</span>&lt;&lt;t.y&lt;&lt;<span class="string">" "</span>&lt;&lt;t.c&lt;&lt;<span class="string">'\n'</span>;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><hr><p><a href="https://blog.nowcoder.net/n/5f6ff64391d546e38bd17dc1b7448ef1">小雨坐地铁（分层图_牛客博客 (nowcoder.net)</a></p><hr><p><a href="http://oj.daimayuan.top/course/10/problem/704">环的数量 - 题目 - Daimayuan Online Judge</a></p><figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N=<span class="number">20</span>,M=<span class="number">1</span>&lt;&lt;N;</span><br><span class="line"><span class="type">int</span> f[M][N],n,m,g[N][N];</span><br><span class="line"><span class="type">long</span> <span class="type">long</span> ans;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">lowbit</span><span class="params">(<span class="type">int</span> x)</span></span>{<span class="keyword">return</span> (<span class="type">int</span>)<span class="built_in">log2</span>(x&amp;-x);}</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">cal</span><span class="params">(<span class="type">int</span> x)</span></span>{</span><br><span class="line">    <span class="type">int</span> cnt=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(x)cnt+=x&amp;<span class="number">1</span>,x&gt;&gt;=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">return</span> cnt;</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="type">signed</span> <span class="title">main</span><span class="params">()</span></span>{</span><br><span class="line">    ios::<span class="built_in">sync_with_stdio</span>(<span class="number">0</span>);</span><br><span class="line">    cin.<span class="built_in">tie</span>(<span class="number">0</span>);</span><br><span class="line">    cout.<span class="built_in">tie</span>(<span class="number">0</span>);</span><br><span class="line">    cin&gt;&gt;n&gt;&gt;m;</span><br><span class="line">    <span class="type">int</span> mm=m;</span><br><span class="line">    <span class="keyword">while</span>(m--){</span><br><span class="line">        <span class="type">int</span> a,b;</span><br><span class="line">        cin&gt;&gt;a&gt;&gt;b;</span><br><span class="line">        a--,b--;</span><br><span class="line">        g[a][b]=g[b][a]=<span class="number">1</span>;</span><br><span class="line">        <span class="comment">//f[(1&lt;&lt;a)|(1&lt;&lt;b)][max(a,b)]=1;</span></span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;n;i++)f[<span class="number">1</span>&lt;&lt;i][i]=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;<span class="number">1</span>&lt;&lt;n;i++){</span><br><span class="line">        <span class="type">int</span> u=<span class="built_in">lowbit</span>(i);</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">0</span>;j&lt;n;j++){<span class="comment">//j表示我现在走到了点集的哪个点上</span></span><br><span class="line">            <span class="keyword">if</span>(!(i&gt;&gt;j&amp;<span class="number">1</span>))<span class="keyword">continue</span>;</span><br><span class="line">            <span class="keyword">if</span>(g[u][j])ans+=f[i][j];</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> k=u+<span class="number">1</span>;k&lt;n;k++){<span class="comment">//k表示我现在要走到哪个点</span></span><br><span class="line">                <span class="keyword">if</span>(i&gt;&gt;k&amp;<span class="number">1</span>)<span class="keyword">continue</span>;</span><br><span class="line">                <span class="keyword">if</span>(!g[j][k])<span class="keyword">continue</span>;</span><br><span class="line">                f[i|(<span class="number">1</span>&lt;&lt;k)][k]+=f[i][j];</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    cout&lt;&lt;(ans-mm)/<span class="number">2</span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><hr><p><a href="http://oj.daimayuan.top/course/10/problem/709">最大权值划分 - 题目 - Daimayuan Online Judge</a></p><figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N=<span class="number">1e6</span>+<span class="number">10</span>;</span><br><span class="line"><span class="meta">#<span class="keyword">define</span> int long long</span></span><br><span class="line"><span class="type">int</span> a[N],f[N][<span class="number">2</span>],n;</span><br><span class="line"><span class="function"><span class="type">signed</span> <span class="title">main</span><span class="params">()</span></span>{</span><br><span class="line">    ios::<span class="built_in">sync_with_stdio</span>(<span class="number">0</span>);</span><br><span class="line">    cin&gt;&gt;n;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;i++)cin&gt;&gt;a[i];</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">2</span>;i&lt;=n;i++){</span><br><span class="line">        <span class="keyword">if</span>(a[i]&lt;a[i<span class="number">-1</span>]){</span><br><span class="line">            f[i][<span class="number">0</span>]=<span class="built_in">max</span>(f[i<span class="number">-1</span>][<span class="number">0</span>]+a[i<span class="number">-1</span>]-a[i],f[i<span class="number">-1</span>][<span class="number">1</span>]);</span><br><span class="line">            f[i][<span class="number">1</span>]=<span class="built_in">max</span>(f[i<span class="number">-1</span>][<span class="number">0</span>],f[i<span class="number">-1</span>][<span class="number">1</span>]);</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">else</span>{</span><br><span class="line">            f[i][<span class="number">1</span>]=<span class="built_in">max</span>(f[i<span class="number">-1</span>][<span class="number">1</span>]+a[i]-a[i<span class="number">-1</span>],f[i<span class="number">-1</span>][<span class="number">0</span>]);</span><br><span class="line">            f[i][<span class="number">0</span>]=<span class="built_in">max</span>(f[i<span class="number">-1</span>][<span class="number">1</span>],f[i<span class="number">-1</span>][<span class="number">0</span>]);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    cout&lt;&lt;<span class="built_in">max</span>(f[n][<span class="number">0</span>],f[n][<span class="number">1</span>]);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><hr><p><a href="http://oj.daimayuan.top/course/10/problem/673">Ayoub’s function - 题目 - Daimayuan Online Judge</a></p><p>组合数学+思维</p><p><a href="https://blog.csdn.net/starlet_kiss/article/details/104323776">(8条消息) Ayoub’s function CodeForces - 1301C（组合数学）_starlet_kiss的博客-CSDN博客</a></p><hr><p><a href="http://oj.daimayuan.top/course/10/problem/707">括号序列 - 题目 - Daimayuan Online Judge</a></p><figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line">string s;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N=<span class="number">1e6</span>+<span class="number">10</span>;</span><br><span class="line"><span class="type">int</span> f[N],match[N];</span><br><span class="line"><span class="function"><span class="type">signed</span> <span class="title">main</span><span class="params">()</span></span>{</span><br><span class="line">    <span class="keyword">while</span>(cin&gt;&gt;s){</span><br><span class="line">        <span class="built_in">memset</span>(f,<span class="number">0</span>,<span class="keyword">sizeof</span> f);</span><br><span class="line">        stack&lt;<span class="type">int</span>&gt;stk;</span><br><span class="line">        <span class="type">int</span> n =s.<span class="built_in">length</span>();</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;i++){</span><br><span class="line">            <span class="keyword">if</span>(s[i<span class="number">-1</span>]==<span class="string">'('</span>)stk.<span class="built_in">push</span>(i);</span><br><span class="line">            <span class="keyword">else</span>{</span><br><span class="line">                <span class="keyword">if</span>(stk.<span class="built_in">empty</span>())<span class="keyword">continue</span>;</span><br><span class="line">                <span class="keyword">else</span> match[i]=stk.<span class="built_in">top</span>(),stk.<span class="built_in">pop</span>();</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;i++){</span><br><span class="line">            <span class="keyword">if</span>(s[i<span class="number">-1</span>]==<span class="string">')'</span>&amp;&amp;match[i])f[i]=f[match[i]<span class="number">-1</span>]+<span class="number">1</span>;</span><br><span class="line">        }</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// for(int i=1;i&lt;=n;i++){</span></span><br><span class="line">        <span class="comment">//     if(s[i-1]=='(')stk.push(i);</span></span><br><span class="line">        <span class="comment">//     else{</span></span><br><span class="line">        <span class="comment">//         if(stk.empty())continue;</span></span><br><span class="line">        <span class="comment">//         int t=stk.top();</span></span><br><span class="line">        <span class="comment">//         stk.pop();</span></span><br><span class="line">        <span class="comment">//         match[t]=i;</span></span><br><span class="line">        <span class="comment">//     }</span></span><br><span class="line">        <span class="comment">// }</span></span><br><span class="line">        <span class="comment">// for(int i=n;i&gt;=1;i--){</span></span><br><span class="line">        <span class="comment">//     f[i]=f[i-1];</span></span><br><span class="line">        <span class="comment">//     if(s[i-1]=='('&amp;&amp;match[i]!=0)f[i]=f[match[i]+1]+1;</span></span><br><span class="line">        <span class="comment">// }</span></span><br><span class="line">        <span class="type">long</span> <span class="type">long</span> ans=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;i++){</span><br><span class="line">            <span class="keyword">if</span>(s[i<span class="number">-1</span>]==<span class="string">')'</span>&amp;&amp;match[i])ans+=f[i];</span><br><span class="line">        }</span><br><span class="line">        cout&lt;&lt;ans&lt;&lt;<span class="string">'\n'</span>;</span><br><span class="line">    }</span><br><span class="line">    </span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><hr><p><a href="http://oj.daimayuan.top/course/11/problem/677">弗拉德和糖果 II - 题目 - Daimayuan Online Judge</a></p><p>贪心+小思维</p><figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="keyword">define</span> int long long</span></span><br><span class="line"><span class="type">int</span> sum,ma,n;</span><br><span class="line"><span class="function"><span class="type">signed</span> <span class="title">main</span><span class="params">()</span></span>{</span><br><span class="line">    ios::<span class="built_in">sync_with_stdio</span>(<span class="number">0</span>);</span><br><span class="line">    cin&gt;&gt;n;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;i++){</span><br><span class="line">        <span class="type">int</span> x;</span><br><span class="line">        cin&gt;&gt;x;</span><br><span class="line">        sum+=x;</span><br><span class="line">        ma=<span class="built_in">max</span>(ma,x);</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">if</span>(ma<span class="number">-1</span>&gt;sum-ma)<span class="built_in">puts</span>(<span class="string">"NO"</span>);</span><br><span class="line">    <span class="keyword">else</span> <span class="built_in">puts</span>(<span class="string">"YES"</span>);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><hr><p><a href="http://oj.daimayuan.top/course/11/problem/461">任务分配 - 题目 - Daimayuan Online Judge</a></p><hr><p><a href="http://oj.daimayuan.top/problem/737">质区间长度 - 题目 - Daimayuan Online Judge</a></p><figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N=<span class="number">1e6</span>+<span class="number">10</span>;</span><br><span class="line"><span class="type">int</span> primes[N],cnt,st[N],l,r,k,a[N];</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">init</span><span class="params">()</span></span>{</span><br><span class="line">    st[<span class="number">1</span>]=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">2</span>;i&lt;N;i++){</span><br><span class="line">        <span class="keyword">if</span>(!st[i])primes[cnt++]=i;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">0</span>;i*primes[j]&lt;N;j++){</span><br><span class="line">            st[primes[j]*i]=<span class="number">1</span>;</span><br><span class="line">            <span class="keyword">if</span>(i%primes[j]==<span class="number">0</span>)<span class="keyword">break</span>;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">check</span><span class="params">(<span class="type">int</span> mid)</span></span>{</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=l;i&lt;=r;i++){</span><br><span class="line">        <span class="type">int</span> j=i+mid<span class="number">-1</span>;</span><br><span class="line">        <span class="keyword">if</span>(j&gt;r)<span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">if</span>(a[j]-a[i<span class="number">-1</span>]&lt;k)<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="type">signed</span> <span class="title">main</span><span class="params">()</span></span>{</span><br><span class="line">    <span class="built_in">init</span>();</span><br><span class="line">    cin&gt;&gt;l&gt;&gt;r&gt;&gt;k;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=l;i&lt;=r;i++){</span><br><span class="line">        <span class="keyword">if</span>(!st[i])a[i]=a[i<span class="number">-1</span>]+<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">else</span> a[i]=a[i<span class="number">-1</span>];</span><br><span class="line">        <span class="comment">//cout&lt;&lt;i&lt;&lt;" "&lt;&lt;a[i]&lt;&lt;endl;</span></span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">if</span>(a[r]-a[l<span class="number">-1</span>]&lt;k){</span><br><span class="line">        <span class="comment">//cout&lt;&lt;a[r]&lt;&lt;" "&lt;&lt;a[l-1]&lt;&lt;endl;</span></span><br><span class="line">        cout&lt;&lt;<span class="string">"-1"</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="type">int</span> L=k,R=r-l+<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span>(L&lt;R){</span><br><span class="line">        <span class="type">int</span> mid=L+R&gt;&gt;<span class="number">1</span>;</span><br><span class="line">        <span class="comment">//cout&lt;&lt;"mid="&lt;&lt;mid&lt;&lt;endl;</span></span><br><span class="line">        <span class="keyword">if</span>(<span class="built_in">check</span>(mid))R=mid;</span><br><span class="line">        <span class="keyword">else</span> L=mid+<span class="number">1</span>;</span><br><span class="line">    }</span><br><span class="line">    cout&lt;&lt;<span class="built_in">max</span>(<span class="number">1</span>,R);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><hr><p><a href="https://www.acwing.com/problem/content/description/4012/">4009. 收集卡牌 - AcWing题库</a></p><figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N=<span class="number">16</span>,M=<span class="number">1</span>&lt;&lt;N;</span><br><span class="line"><span class="type">int</span> n,k;</span><br><span class="line"><span class="type">double</span> p[N],f[M][N*<span class="number">5</span>+<span class="number">1</span>];</span><br><span class="line"><span class="function"><span class="type">double</span> <span class="title">dfs</span><span class="params">(<span class="type">int</span> x,<span class="type">int</span> sum,<span class="type">int</span> need)</span></span>{</span><br><span class="line">    <span class="keyword">if</span>(f[x][sum]&gt;=<span class="number">0</span>)<span class="keyword">return</span> f[x][sum];</span><br><span class="line">    <span class="keyword">if</span>(sum&gt;=need*k)<span class="keyword">return</span> f[x][sum]=<span class="number">0</span>;</span><br><span class="line">    f[x][sum]=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;n;i++){</span><br><span class="line">        <span class="keyword">if</span>(x&gt;&gt;i&amp;<span class="number">1</span>)f[x][sum]+=p[i]*(<span class="built_in">dfs</span>(x,sum+<span class="number">1</span>,need)+<span class="number">1</span>);</span><br><span class="line">        <span class="keyword">else</span> f[x][sum]+=p[i]*(<span class="built_in">dfs</span>(x^(<span class="number">1</span>&lt;&lt;i),sum,need<span class="number">-1</span>)+<span class="number">1</span>);</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> f[x][sum];</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="type">signed</span> <span class="title">main</span><span class="params">()</span></span>{</span><br><span class="line">    cin&gt;&gt;n&gt;&gt;k;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;n;i++)cin&gt;&gt;p[i];</span><br><span class="line">    <span class="built_in">memset</span>(f,<span class="number">-1</span>,<span class="keyword">sizeof</span> f);</span><br><span class="line">    cout&lt;&lt;<span class="built_in">dfs</span>(<span class="number">0</span>,<span class="number">0</span>,n);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><hr><p><a href="https://www.acwing.com/problem/content/description/1214/">1212. 地宫取宝 - AcWing题库</a></p><figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N = <span class="number">55</span>, MOD = <span class="number">1000000007</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> n, m, k;</span><br><span class="line"><span class="type">int</span> w[N][N];</span><br><span class="line"><span class="type">int</span> f[N][N][<span class="number">13</span>][<span class="number">14</span>];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">    cin &gt;&gt; n &gt;&gt; m &gt;&gt; k;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i ++ )</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">1</span>; j &lt;= m; j ++ )</span><br><span class="line">        {</span><br><span class="line">            cin &gt;&gt; w[i][j];</span><br><span class="line">            w[i][j] ++ ;</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">    f[<span class="number">1</span>][<span class="number">1</span>][<span class="number">1</span>][w[<span class="number">1</span>][<span class="number">1</span>]] = <span class="number">1</span>;</span><br><span class="line">    f[<span class="number">1</span>][<span class="number">1</span>][<span class="number">0</span>][<span class="number">0</span>] = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i ++ )</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">1</span>; j &lt;= m; j ++ )</span><br><span class="line">        {</span><br><span class="line">            <span class="keyword">if</span> (i == <span class="number">1</span> &amp;&amp; j == <span class="number">1</span>) <span class="keyword">continue</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> u = <span class="number">0</span>; u &lt;= k; u ++ )</span><br><span class="line">                <span class="keyword">for</span> (<span class="type">int</span> v = <span class="number">0</span>; v &lt;= <span class="number">13</span>; v ++ )</span><br><span class="line">                {</span><br><span class="line">                    <span class="type">int</span> &amp;val = f[i][j][u][v];</span><br><span class="line">                    val = (val + f[i - <span class="number">1</span>][j][u][v]) % MOD;</span><br><span class="line">                    val = (val + f[i][j - <span class="number">1</span>][u][v]) % MOD;</span><br><span class="line">                    <span class="keyword">if</span> (u &gt; <span class="number">0</span> &amp;&amp; v == w[i][j])</span><br><span class="line">                    {</span><br><span class="line">                        <span class="keyword">for</span> (<span class="type">int</span> c = <span class="number">0</span>; c &lt; v; c ++ )</span><br><span class="line">                        {</span><br><span class="line">                            val = (val + f[i - <span class="number">1</span>][j][u - <span class="number">1</span>][c]) % MOD;</span><br><span class="line">                            val = (val + f[i][j - <span class="number">1</span>][u - <span class="number">1</span>][c]) % MOD;</span><br><span class="line">                        }</span><br><span class="line">                    }</span><br><span class="line">                }</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> res = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt;= <span class="number">13</span>; i ++ ) res = (res + f[n][m][k][i]) % MOD;</span><br><span class="line"></span><br><span class="line">    cout &lt;&lt; res &lt;&lt; endl;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure><hr><p><a href="https://www.acwing.com/problem/content/description/4384/">4381. 翻转树边 - AcWing题库</a></p><figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N = <span class="number">2e5</span> + <span class="number">10</span>, M = <span class="number">2</span> * N;</span><br><span class="line"><span class="type">int</span> h[N], ne[M], e[M], w[M], idx, dp[N];</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">add</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> b, <span class="type">int</span> c)</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">    e[idx] = b, ne[idx] = h[a], w[idx] = c, h[a] = idx++;</span><br><span class="line">}</span><br><span class="line"><span class="type">int</span> f[N];</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">dfs1</span><span class="params">(<span class="type">int</span> u, <span class="type">int</span> fa)</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = h[u]; i != <span class="number">-1</span>; i = ne[i])</span><br><span class="line">    {</span><br><span class="line">        <span class="type">int</span> j = e[i], k = w[i];</span><br><span class="line">        <span class="keyword">if</span> (j == fa)</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        <span class="built_in">dfs1</span>(j, u);</span><br><span class="line">        f[u] += f[j] + k;</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">dfs2</span><span class="params">(<span class="type">int</span> u, <span class="type">int</span> fa)</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = h[u]; i != <span class="number">-1</span>; i = ne[i])</span><br><span class="line">    {</span><br><span class="line">        <span class="type">int</span> j = e[i], k = w[i];</span><br><span class="line">        <span class="keyword">if</span> (j == fa)</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        dp[j] = dp[u] + (k == <span class="number">1</span> ? <span class="number">0</span> : <span class="number">1</span>) - (k == <span class="number">1</span> ? <span class="number">1</span> : <span class="number">0</span>);</span><br><span class="line">        <span class="built_in">dfs2</span>(j, u);</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">    <span class="type">int</span> n;</span><br><span class="line">    cin &gt;&gt; n;</span><br><span class="line">    <span class="built_in">memset</span>(h, <span class="number">-1</span>, <span class="keyword">sizeof</span> h);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt; n; i++)</span><br><span class="line">    {</span><br><span class="line">        <span class="type">int</span> a, b;</span><br><span class="line">        cin &gt;&gt; a &gt;&gt; b;</span><br><span class="line">        <span class="built_in">add</span>(a, b, <span class="number">0</span>), <span class="built_in">add</span>(b, a, <span class="number">1</span>);</span><br><span class="line">    }</span><br><span class="line">    <span class="built_in">dfs1</span>(<span class="number">1</span>, <span class="number">-1</span>);</span><br><span class="line">    dp[<span class="number">1</span>] = f[<span class="number">1</span>];</span><br><span class="line">    <span class="built_in">dfs2</span>(<span class="number">1</span>, <span class="number">-1</span>);</span><br><span class="line">    <span class="type">int</span> mx = <span class="number">0x3f3f3f3f</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i++)</span><br><span class="line">        mx = <span class="built_in">min</span>(mx, dp[i]);</span><br><span class="line">    cout &lt;&lt; mx &lt;&lt; <span class="string">"\n"</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i++)</span><br><span class="line">        <span class="keyword">if</span> (dp[i] == mx)</span><br><span class="line">            cout &lt;&lt; i &lt;&lt; <span class="string">" "</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure><hr><p><a href="https://www.acwing.com/problem/content/description/3114/">3111. 回转寿司 - AcWing题库</a></p><p>值域树状数组，离散化后求值</p><figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="keyword">define</span> int long long</span></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N=<span class="number">3e5</span>+<span class="number">10</span>;</span><br><span class="line"><span class="type">long</span> <span class="type">long</span> a[N],tr[N],n,L,R,ans,tot;</span><br><span class="line">vector&lt;<span class="type">long</span> <span class="type">long</span>&gt;xs;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">add</span><span class="params">(<span class="type">int</span> x,<span class="type">int</span> c)</span></span>{</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=x;i&lt;N;i+=i&amp;-i)tr[i]+=c;</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="type">long</span> <span class="type">long</span> <span class="title">sum</span><span class="params">(<span class="type">int</span> x)</span></span>{</span><br><span class="line">    <span class="type">int</span> ans=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=x;i;i-=i&amp;-i)ans+=tr[i];</span><br><span class="line">    <span class="keyword">return</span> ans;</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">get</span><span class="params">(<span class="type">long</span> <span class="type">long</span> x)</span></span>{</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">lower_bound</span>(xs.<span class="built_in">begin</span>(),xs.<span class="built_in">end</span>(),x)-xs.<span class="built_in">begin</span>()+<span class="number">1</span>;</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="type">signed</span> <span class="title">main</span><span class="params">()</span></span>{</span><br><span class="line">    cin&gt;&gt;n&gt;&gt;L&gt;&gt;R;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;i++){</span><br><span class="line">        cin&gt;&gt;a[i];</span><br><span class="line">        a[i]+=a[i<span class="number">-1</span>];</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;i++){</span><br><span class="line">        xs.<span class="built_in">push_back</span>(a[i]);</span><br><span class="line">        xs.<span class="built_in">push_back</span>(a[i]-R<span class="number">-1</span>);</span><br><span class="line">        xs.<span class="built_in">push_back</span>(a[i]-L);</span><br><span class="line">    }</span><br><span class="line">    <span class="built_in">sort</span>(xs.<span class="built_in">begin</span>(),xs.<span class="built_in">end</span>());</span><br><span class="line">    xs.<span class="built_in">erase</span>(<span class="built_in">unique</span>(xs.<span class="built_in">begin</span>(),xs.<span class="built_in">end</span>()),xs.<span class="built_in">end</span>());</span><br><span class="line">    tot=xs.<span class="built_in">size</span>();</span><br><span class="line">    <span class="built_in">add</span>(<span class="built_in">get</span>(a[<span class="number">0</span>]),<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;i++){</span><br><span class="line">        <span class="type">int</span> x=<span class="built_in">get</span>(a[i]);</span><br><span class="line">        <span class="type">int</span> y=<span class="built_in">get</span>(a[i]-R<span class="number">-1</span>);</span><br><span class="line">        <span class="type">int</span> z=<span class="built_in">get</span>(a[i]-L);</span><br><span class="line">        ans+=<span class="built_in">sum</span>(z)-<span class="built_in">sum</span>(y);</span><br><span class="line">        <span class="built_in">add</span>(x,<span class="number">1</span>);</span><br><span class="line">    }</span><br><span class="line">    cout&lt;&lt;ans;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p><a href="https://www.acwing.com/problem/content/description/4319/">4316. 合适数对 - AcWing题库</a></p><p>同方法题</p><hr><p><a href="https://www.acwing.com/problem/content/description/2662/">2660. 方伯伯的玉米田 - AcWing题库</a></p><p>利用树状数组的dp</p><figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N=<span class="number">1e4</span>+<span class="number">10</span>,M=<span class="number">550</span>;</span><br><span class="line"><span class="type">int</span> tr[M][N],a[N],n,k,ans;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">add</span><span class="params">(<span class="type">int</span> k,<span class="type">int</span> v,<span class="type">int</span> c)</span></span>{</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=k;i&lt;=<span class="number">551</span>;i+=i&amp;-i){</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> j=v;j&lt;=<span class="number">5500</span>;j+=j&amp;-j){</span><br><span class="line">            tr[i][j]=<span class="built_in">max</span>(tr[i][j],c);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">sum</span><span class="params">(<span class="type">int</span> k,<span class="type">int</span> v)</span></span>{</span><br><span class="line">    <span class="type">int</span> ans=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=k;i;i-=i&amp;-i){</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> j=v;j;j-=j&amp;-j){</span><br><span class="line">            ans=<span class="built_in">max</span>(ans,tr[i][j]);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> ans;</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="type">signed</span> <span class="title">main</span><span class="params">()</span></span>{</span><br><span class="line">    ios::<span class="built_in">sync_with_stdio</span>(<span class="number">0</span>);</span><br><span class="line">    cin.<span class="built_in">tie</span>(<span class="number">0</span>);</span><br><span class="line">    cout.<span class="built_in">tie</span>(<span class="number">0</span>);</span><br><span class="line">    cin&gt;&gt;n&gt;&gt;k;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;i++)cin&gt;&gt;a[i];</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;i++){</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> j=k;j&gt;=<span class="number">0</span>;j--){</span><br><span class="line">            <span class="type">int</span> t=<span class="built_in">sum</span>(j+<span class="number">1</span>,a[i]+j)+<span class="number">1</span>;</span><br><span class="line">            ans=<span class="built_in">max</span>(ans,t);</span><br><span class="line">            <span class="built_in">add</span>(j+<span class="number">1</span>,a[i]+j,t);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    cout&lt;&lt;ans;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><hr><p><a href="https://www.acwing.com/solution/content/105366/">AcWing 2978. 最长上升子序列 - AcWing</a></p><figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N=<span class="number">1e5</span>+<span class="number">10</span>;</span><br><span class="line">vector&lt;<span class="type">int</span>&gt;a;</span><br><span class="line"><span class="type">int</span> n,tr[N],dp[N];</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">add</span><span class="params">(<span class="type">int</span> x,<span class="type">int</span> c)</span></span>{</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=x;i&lt;=n;i+=i&amp;-i)tr[i]=<span class="built_in">max</span>(tr[i],c);</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">sum</span><span class="params">(<span class="type">int</span> x)</span></span>{</span><br><span class="line">    <span class="type">int</span> ans=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=x;i;i-=i&amp;-i)ans=<span class="built_in">max</span>(ans,tr[i]);</span><br><span class="line">    <span class="keyword">return</span> ans;</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="type">signed</span> <span class="title">main</span><span class="params">()</span></span>{</span><br><span class="line">    cin&gt;&gt;n;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;i++){</span><br><span class="line">        <span class="type">int</span> x;</span><br><span class="line">        cin&gt;&gt;x;</span><br><span class="line">        a.<span class="built_in">insert</span>(x+a.<span class="built_in">begin</span>(),i);</span><br><span class="line">    }</span><br><span class="line">    <span class="type">int</span> ans=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;n;i++){</span><br><span class="line">        <span class="type">int</span> t=a[i];</span><br><span class="line">        dp[t]=<span class="built_in">sum</span>(t)+<span class="number">1</span>;</span><br><span class="line">        <span class="built_in">add</span>(t,dp[t]);</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;i++){</span><br><span class="line">        dp[i]=<span class="built_in">max</span>(dp[i],dp[i<span class="number">-1</span>]);</span><br><span class="line">        cout&lt;&lt;dp[i]&lt;&lt;<span class="string">'\n'</span>;</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">作者：我已经不想再做刺客了</span><br><span class="line">链接：https:<span class="comment">//www.acwing.com/solution/content/105366/</span></span><br><span class="line">来源：AcWing</span><br><span class="line">著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。</span><br></pre></td></tr></tbody></table></figure><hr><p><a href="https://www.acwing.com/problem/content/description/1268/">1266. 校门外的树 - AcWing题库</a></p><p>很巧妙的思路<br>把区间想象成一条条线段<br>要求区间种数转化为求有多少个线段覆盖过这个区间<br>r之前的左端点数量减去l之前的右端点数量</p><figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N=<span class="number">1e5</span>+<span class="number">10</span>;</span><br><span class="line"><span class="type">int</span> n,m,l,r,t1[N],t2[N],op;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">add</span><span class="params">(<span class="type">int</span> x,<span class="type">int</span> tr[])</span></span>{</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=x;i&lt;=n;i+=i&amp;-i)tr[i]+=<span class="number">1</span>;</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">sum</span><span class="params">(<span class="type">int</span> x,<span class="type">int</span> tr[])</span></span>{</span><br><span class="line">    <span class="type">int</span> ans=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=x;i;i-=i&amp;-i)ans+=tr[i];</span><br><span class="line">    <span class="keyword">return</span> ans;</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="type">signed</span> <span class="title">main</span><span class="params">()</span></span>{</span><br><span class="line">    cin&gt;&gt;n&gt;&gt;m;</span><br><span class="line">    <span class="keyword">while</span>(m--){</span><br><span class="line">        cin&gt;&gt;op&gt;&gt;l&gt;&gt;r;</span><br><span class="line">        <span class="keyword">if</span>(op==<span class="number">1</span>){</span><br><span class="line">            <span class="built_in">add</span>(l,t1);</span><br><span class="line">            <span class="built_in">add</span>(r,t2);</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">else</span>{</span><br><span class="line">            cout&lt;&lt;<span class="built_in">sum</span>(r,t1)-<span class="built_in">sum</span>(l<span class="number">-1</span>,t2)&lt;&lt;<span class="string">'\n'</span>;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure><hr><p><a href="https://www.acwing.com/problem/content/description/2955/">2952. 不等式组 - AcWing题库</a></p><figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> endl <span class="string">'\n'</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N=<span class="number">2e6</span>+<span class="number">10</span>;</span><br><span class="line"><span class="type">int</span> n,t1[N],t2[N],ok,k[N],idx,vis[N],p[N];</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">add</span><span class="params">(<span class="type">int</span> tr[],<span class="type">int</span> x,<span class="type">int</span> c)</span></span>{</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=x;i&lt;N;i+=i&amp;-i)tr[i]+=c;</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">sum</span><span class="params">(<span class="type">int</span> tr[],<span class="type">int</span> x)</span></span>{</span><br><span class="line">    <span class="type">int</span> ans=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=x;i;i-=i&amp;-i)ans+=tr[i];</span><br><span class="line">    <span class="keyword">return</span> ans;</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="type">signed</span> <span class="title">main</span><span class="params">()</span></span>{</span><br><span class="line">    ios::<span class="built_in">sync_with_stdio</span>(<span class="number">0</span>);</span><br><span class="line">    cin.<span class="built_in">tie</span>(<span class="number">0</span>);</span><br><span class="line">    cout.<span class="built_in">tie</span>(<span class="number">0</span>);</span><br><span class="line">    cin&gt;&gt;n;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;i++){</span><br><span class="line">        string s;</span><br><span class="line">        cin&gt;&gt;s;</span><br><span class="line">        <span class="keyword">if</span>(s[<span class="number">0</span>]==<span class="string">'A'</span>){</span><br><span class="line">            <span class="type">int</span> a,b,c;</span><br><span class="line">            cin&gt;&gt;a&gt;&gt;b&gt;&gt;c;</span><br><span class="line">            <span class="keyword">if</span>(a==<span class="number">0</span>){</span><br><span class="line">                <span class="keyword">if</span>(b&gt;c){</span><br><span class="line">                    ok++;</span><br><span class="line">                    k[++idx]=<span class="number">1</span>;</span><br><span class="line">                }</span><br><span class="line">                <span class="keyword">else</span>{</span><br><span class="line">                    k[++idx]=<span class="number">0</span>;</span><br><span class="line">                }</span><br><span class="line">            }</span><br><span class="line">            <span class="keyword">if</span>(a&gt;<span class="number">0</span>){<span class="comment">// k&gt;x</span></span><br><span class="line">                <span class="type">int</span> x=<span class="built_in">floor</span>((<span class="number">1.0</span>*c-b)/a);</span><br><span class="line">                <span class="keyword">if</span>(x&lt;<span class="number">-1e6</span>){</span><br><span class="line">                    ok++;</span><br><span class="line">                    k[++idx]=<span class="number">1</span>;</span><br><span class="line">                }</span><br><span class="line">                <span class="keyword">else</span> <span class="keyword">if</span>(x&gt;<span class="number">1e6</span>){</span><br><span class="line">                    k[++idx]=<span class="number">0</span>;</span><br><span class="line">                }</span><br><span class="line">                <span class="keyword">else</span>{</span><br><span class="line">                    <span class="built_in">add</span>(t1,x+<span class="number">1e6</span>+<span class="number">1</span>,<span class="number">1</span>);</span><br><span class="line">                    k[++idx]=<span class="number">2</span>;</span><br><span class="line">                    p[idx]=x+<span class="number">1e6</span>+<span class="number">1</span>;</span><br><span class="line">                }</span><br><span class="line">            }</span><br><span class="line">            <span class="keyword">if</span>(a&lt;<span class="number">0</span>){<span class="comment">// k&lt;x</span></span><br><span class="line">                <span class="type">int</span> x=<span class="built_in">ceil</span>((<span class="number">1.0</span>*c-b)/a);</span><br><span class="line">                <span class="keyword">if</span>(x&gt;<span class="number">1e6</span>){</span><br><span class="line">                    ok++;</span><br><span class="line">                    k[++idx]=<span class="number">1</span>;</span><br><span class="line">                }</span><br><span class="line">                <span class="keyword">else</span> <span class="keyword">if</span>(x&lt;<span class="number">-1e6</span>){</span><br><span class="line">                    k[++idx]=<span class="number">0</span>;</span><br><span class="line">                }</span><br><span class="line">                <span class="keyword">else</span>{</span><br><span class="line">                    <span class="built_in">add</span>(t2,x+<span class="number">1e6</span>+<span class="number">1</span>,<span class="number">1</span>);</span><br><span class="line">                    k[++idx]=<span class="number">3</span>;</span><br><span class="line">                    p[idx]=x+<span class="number">1e6</span>+<span class="number">1</span>;</span><br><span class="line">                }</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">if</span>(s[<span class="number">0</span>]==<span class="string">'Q'</span>){</span><br><span class="line">            <span class="type">int</span> x;</span><br><span class="line">            cin&gt;&gt;x;</span><br><span class="line">            x+=<span class="number">1e6</span>+<span class="number">1</span>;</span><br><span class="line">            <span class="type">int</span> ans1=<span class="built_in">sum</span>(t1,x<span class="number">-1</span>);</span><br><span class="line">            <span class="type">int</span> ans2=<span class="built_in">sum</span>(t2,N<span class="number">-1</span>)-<span class="built_in">sum</span>(t2,x);</span><br><span class="line">            cout&lt;&lt;ans1+ans2+ok&lt;&lt;endl;</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">if</span>(s[<span class="number">0</span>]==<span class="string">'D'</span>){</span><br><span class="line">            <span class="type">int</span> x;</span><br><span class="line">            cin&gt;&gt;x;</span><br><span class="line">            <span class="keyword">if</span>(vis[x])<span class="keyword">continue</span>;</span><br><span class="line">            vis[x]=<span class="number">1</span>;</span><br><span class="line">            <span class="keyword">if</span>(k[x]==<span class="number">1</span>)ok--;</span><br><span class="line">            <span class="keyword">if</span>(k[x]==<span class="number">2</span>)<span class="built_in">add</span>(t1,p[x],<span class="number">-1</span>);</span><br><span class="line">            <span class="keyword">if</span>(k[x]==<span class="number">3</span>)<span class="built_in">add</span>(t2,p[x],<span class="number">-1</span>);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure><hr><p><a href="https://www.acwing.com/problem/content/4084/">4081. 选数 - AcWing题库</a></p><p>混合背包dp</p><figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N=<span class="number">220</span>,M=<span class="number">200</span>*<span class="number">26</span>;</span><br><span class="line"><span class="meta">#<span class="keyword">define</span> int long long</span></span><br><span class="line"><span class="type">int</span> f[N][M];</span><br><span class="line"><span class="type">int</span> n,k;</span><br><span class="line"><span class="function"><span class="type">signed</span> <span class="title">main</span><span class="params">()</span></span>{</span><br><span class="line">    cin&gt;&gt;n&gt;&gt;k;</span><br><span class="line">    <span class="built_in">memset</span>(f,<span class="number">-0x3f</span>,<span class="keyword">sizeof</span> f);</span><br><span class="line">    f[<span class="number">0</span>][<span class="number">0</span>]=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;i++){</span><br><span class="line">        <span class="type">int</span> a;</span><br><span class="line">        cin&gt;&gt;a;</span><br><span class="line">        </span><br><span class="line">        <span class="type">int</span> w=<span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> v=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span>(a%<span class="number">5</span>==<span class="number">0</span>)a/=<span class="number">5</span>,w++;</span><br><span class="line">        <span class="keyword">while</span>(a%<span class="number">2</span>==<span class="number">0</span>)a/=<span class="number">2</span>,v++;</span><br><span class="line">        <span class="comment">//cout&lt;&lt;w&lt;&lt;" "&lt;&lt;v&lt;&lt;endl;</span></span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> j=k;j&gt;=<span class="number">1</span>;j--){</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> t=M<span class="number">-1</span>;t&gt;=w;t--){</span><br><span class="line">                f[j][t]=<span class="built_in">max</span>(f[j][t],f[j<span class="number">-1</span>][t-w]+v);</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="type">int</span> ans=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;M;i++)ans=<span class="built_in">max</span>(ans,<span class="built_in">min</span>(i,f[k][i]));</span><br><span class="line">    cout&lt;&lt;ans;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><hr><p><a href="https://www.acwing.com/problem/content/3284/">3281. 城市规划 - AcWing题库</a></p><p>树形dp 分组背包</p><figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N = <span class="number">5e4</span>+<span class="number">10</span>,M=<span class="number">2</span>*N;</span><br><span class="line"><span class="type">const</span> <span class="type">long</span> <span class="type">long</span> INF=<span class="number">0x3f3f3f3f3f3f3f3f</span>;</span><br><span class="line"><span class="type">int</span> h[N],ne[M],e[M],idx,n,m,K;</span><br><span class="line"><span class="type">int</span> s[N];</span><br><span class="line"><span class="type">int</span> st[N];</span><br><span class="line"><span class="type">long</span> <span class="type">long</span> w[M];</span><br><span class="line"><span class="type">long</span> <span class="type">long</span> f[N][<span class="number">110</span>];<span class="comment">//f【u】【k】表示以u为根选k个点的最大值</span></span><br><span class="line"><span class="type">long</span> <span class="type">long</span> ans=INF;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">add</span><span class="params">(<span class="type">int</span> a,<span class="type">int</span> b,<span class="type">int</span> c)</span></span>{</span><br><span class="line">    e[idx]=b,w[idx]=c,ne[idx]=h[a],h[a]=idx++;</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">dfs</span><span class="params">(<span class="type">int</span> u,<span class="type">int</span> fa)</span></span>{</span><br><span class="line">    f[u][<span class="number">0</span>]=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span>(st[u])f[u][<span class="number">1</span>]=<span class="number">0</span>,s[u]=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=h[u];~i;i=ne[i]){</span><br><span class="line">        <span class="type">int</span> j=e[i];</span><br><span class="line">        <span class="keyword">if</span>(j==fa)<span class="keyword">continue</span>;</span><br><span class="line">        <span class="built_in">dfs</span>(j,u);</span><br><span class="line">        s[u]+=s[j];</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> k=<span class="built_in">min</span>(s[u],K);k&gt;=<span class="number">0</span>;k--){</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> x=<span class="number">0</span>;x&lt;=<span class="built_in">min</span>(k,s[j]);x++)</span><br><span class="line">            f[u][k]=<span class="built_in">min</span>(f[u][k],f[u][k-x]+f[j][x]+w[i]*x*(K-x));</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    ans=<span class="built_in">min</span>(ans,f[u][K]);</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="type">signed</span> <span class="title">main</span><span class="params">()</span></span>{</span><br><span class="line">    <span class="built_in">memset</span>(h, <span class="number">-1</span>, <span class="keyword">sizeof</span> h);</span><br><span class="line">    cin&gt;&gt;n&gt;&gt;m&gt;&gt;K;</span><br><span class="line">    <span class="keyword">while</span>(m--){</span><br><span class="line">        <span class="type">int</span> x;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">"%d"</span>,&amp;x);</span><br><span class="line">        st[x]=<span class="number">1</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;n;i++){</span><br><span class="line">        <span class="type">int</span> a,b,c;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">"%d %d %d"</span>,&amp;a,&amp;b,&amp;c);</span><br><span class="line">        <span class="built_in">add</span>(a,b,c);</span><br><span class="line">        <span class="built_in">add</span>(b,a,c);</span><br><span class="line">    }</span><br><span class="line">    <span class="comment">// for(int i=0;i&lt;N;i++){</span></span><br><span class="line">    <span class="comment">//     for(int j=0;j&lt;110;j++){</span></span><br><span class="line">    <span class="comment">//         f[i][j]=0x3f3f3f3f;</span></span><br><span class="line">    <span class="comment">//     }</span></span><br><span class="line">    <span class="comment">// }</span></span><br><span class="line">    <span class="built_in">memset</span>(f,<span class="number">0x3f3f</span>,<span class="keyword">sizeof</span> f);</span><br><span class="line">    <span class="built_in">dfs</span>(<span class="number">1</span>,<span class="number">-1</span>);</span><br><span class="line">    cout&lt;&lt;ans;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><hr><p><a href="https://ac.nowcoder.com/acm/contest/11226/E">E-禅_牛客小白月赛49 (nowcoder.com)</a></p><p>思维递推</p><p>从起点p向两边递推，考虑每个单调区间，这种做法是错误的</p><p>比如2 2 2 2 1 10 0</p><p>从最左边开始代价是最小的，会一直加</p><p>那么既然无法确定起点，如何处理这n方复杂度？</p><p>设dp【i】表示从点i开始的代价，考虑答案之间的递推关系</p><figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="keyword">define</span> int long long</span></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N=<span class="number">1e5</span>+<span class="number">10</span>;</span><br><span class="line"><span class="type">int</span> n,a[N],T,f[N];</span><br><span class="line"><span class="function"><span class="type">signed</span> <span class="title">main</span><span class="params">()</span></span>{</span><br><span class="line">    ios::<span class="built_in">sync_with_stdio</span>(<span class="number">0</span>);</span><br><span class="line">    cin.<span class="built_in">tie</span>(<span class="number">0</span>);</span><br><span class="line">    cout.<span class="built_in">tie</span>(<span class="number">0</span>);</span><br><span class="line">    cin&gt;&gt;T;</span><br><span class="line">    <span class="keyword">while</span>(T--){</span><br><span class="line">        cin&gt;&gt;n;</span><br><span class="line">        <span class="type">int</span> p;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;i++){</span><br><span class="line">            cin&gt;&gt;a[i];</span><br><span class="line">            <span class="keyword">if</span>(a[i]==<span class="number">0</span>)p=i;</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">if</span>(n==<span class="number">1</span>){</span><br><span class="line">            cout&lt;&lt;<span class="string">"No Solution"</span>&lt;&lt;<span class="string">'\n'</span>;</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;i++)f[i]=<span class="number">0</span>;</span><br><span class="line">        f[p<span class="number">-1</span>]=a[p<span class="number">-1</span>]+<span class="number">1</span>;</span><br><span class="line">        f[p+<span class="number">1</span>]=a[p+<span class="number">1</span>]+<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=p+<span class="number">2</span>;i&lt;=n;i++)f[i]=<span class="built_in">max</span>(a[i]+<span class="number">1</span>,f[i<span class="number">-1</span>]-a[i]);</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=p<span class="number">-2</span>;i&gt;=<span class="number">1</span>;i--)f[i]=<span class="built_in">max</span>(a[i]+<span class="number">1</span>,f[i+<span class="number">1</span>]-a[i]);</span><br><span class="line">        <span class="type">int</span> ans=<span class="number">1e9</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;i++){</span><br><span class="line">            <span class="keyword">if</span>(i==p)<span class="keyword">continue</span>;</span><br><span class="line">            ans=<span class="built_in">min</span>(ans,f[i]);</span><br><span class="line">        }</span><br><span class="line">        cout&lt;&lt;ans&lt;&lt;<span class="string">'\n'</span>;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><hr><p>二维RMQ</p><figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N=<span class="number">1100</span>;</span><br><span class="line"><span class="type">int</span> ma[N][N][<span class="number">11</span>],mi[N][N][<span class="number">11</span>],n,a[N][N],p,m,k;</span><br><span class="line"><span class="type">int</span> ans=<span class="number">1e9</span>;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">qmax</span><span class="params">(<span class="type">int</span> i,<span class="type">int</span> j)</span></span>{</span><br><span class="line">    <span class="type">int</span> ma1=<span class="built_in">max</span>(ma[i][j][k],ma[i+p-(<span class="number">1</span>&lt;&lt;k)][j+p-(<span class="number">1</span>&lt;&lt;k)][k]);</span><br><span class="line">    <span class="type">int</span> ma2=<span class="built_in">max</span>(ma[i+p-(<span class="number">1</span>&lt;&lt;k)][j][k],ma[i][j+p-(<span class="number">1</span>&lt;&lt;k)][k]);</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">max</span>(ma1,ma2);</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">qmin</span><span class="params">(<span class="type">int</span> i,<span class="type">int</span> j)</span></span>{</span><br><span class="line">    <span class="type">int</span> mi1=<span class="built_in">min</span>(mi[i][j][k],mi[i+p<span class="number">-1</span>-(<span class="number">1</span>&lt;&lt;k)+<span class="number">1</span>][j+p-(<span class="number">1</span>&lt;&lt;k)][k]);</span><br><span class="line">    <span class="type">int</span> mi2=<span class="built_in">min</span>(mi[i+p<span class="number">-1</span>-(<span class="number">1</span>&lt;&lt;k)+<span class="number">1</span>][j][k],mi[i][j+p-(<span class="number">1</span>&lt;&lt;k)][k]);</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">min</span>(mi1,mi2);</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="type">signed</span> <span class="title">main</span><span class="params">()</span></span>{</span><br><span class="line">    ios::<span class="built_in">sync_with_stdio</span>(<span class="number">0</span>);</span><br><span class="line">    cin.<span class="built_in">tie</span>(<span class="number">0</span>);</span><br><span class="line">    cout.<span class="built_in">tie</span>(<span class="number">0</span>);</span><br><span class="line">    cin&gt;&gt;n&gt;&gt;m&gt;&gt;p;k=<span class="built_in">log2</span>(p);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;i++){</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">1</span>;j&lt;=m;j++){</span><br><span class="line">            cin&gt;&gt;a[i][j];</span><br><span class="line">            ma[i][j][<span class="number">0</span>]=a[i][j];</span><br><span class="line">            mi[i][j][<span class="number">0</span>]=a[i][j];</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> k=<span class="number">1</span>;k&lt;=<span class="number">10</span>;k++){</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i+(<span class="number">1</span>&lt;&lt;k<span class="number">-1</span>)&lt;=n;i++){</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">1</span>;j+(<span class="number">1</span>&lt;&lt;k<span class="number">-1</span>)&lt;=m;j++){</span><br><span class="line">                <span class="type">int</span> ma1=<span class="built_in">max</span>(ma[i][j][k<span class="number">-1</span>],ma[i+(<span class="number">1</span>&lt;&lt;k<span class="number">-1</span>)][j+(<span class="number">1</span>&lt;&lt;k<span class="number">-1</span>)][k<span class="number">-1</span>]);</span><br><span class="line">                <span class="type">int</span> ma2=<span class="built_in">max</span>(ma[i+(<span class="number">1</span>&lt;&lt;k<span class="number">-1</span>)][j][k<span class="number">-1</span>],ma[i][j+(<span class="number">1</span>&lt;&lt;k<span class="number">-1</span>)][k<span class="number">-1</span>]);</span><br><span class="line">                ma[i][j][k]=<span class="built_in">max</span>(ma1,ma2);</span><br><span class="line">                <span class="type">int</span> mi1=<span class="built_in">min</span>(mi[i][j][k<span class="number">-1</span>],mi[i+(<span class="number">1</span>&lt;&lt;k<span class="number">-1</span>)][j+(<span class="number">1</span>&lt;&lt;k<span class="number">-1</span>)][k<span class="number">-1</span>]);</span><br><span class="line">                <span class="type">int</span> mi2=<span class="built_in">min</span>(mi[i+(<span class="number">1</span>&lt;&lt;k<span class="number">-1</span>)][j][k<span class="number">-1</span>],mi[i][j+(<span class="number">1</span>&lt;&lt;k<span class="number">-1</span>)][k<span class="number">-1</span>]);</span><br><span class="line">                mi[i][j][k]=<span class="built_in">min</span>(mi1,mi2);</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i+p<span class="number">-1</span>&lt;=n;i++){</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">1</span>;j+p<span class="number">-1</span>&lt;=m;j++){</span><br><span class="line">            ans=<span class="built_in">min</span>(ans,<span class="built_in">qmax</span>(i,j)-<span class="built_in">qmin</span>(i,j));</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    </span><br><span class="line">    cout&lt;&lt;ans;</span><br><span class="line">    <span class="comment">//cout&lt;&lt;ma[1][2][3];</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><hr><figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="keyword">define</span> int long long</span></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N=<span class="number">2e5</span>+<span class="number">10</span>;</span><br><span class="line"><span class="type">int</span> n,m;</span><br><span class="line"><span class="type">int</span> ru[N],chu[N],vis[N];</span><br><span class="line">vector&lt;<span class="type">int</span>&gt;g[N];</span><br><span class="line"><span class="type">int</span> f[N],ans=<span class="number">1</span>;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">dfs</span><span class="params">(<span class="type">int</span> u)</span></span>{</span><br><span class="line">    <span class="keyword">if</span>(chu[u]&lt;=<span class="number">1</span>)<span class="keyword">return</span> f[u]=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">if</span>(f[u])<span class="keyword">return</span> f[u];</span><br><span class="line">    f[u]=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">auto</span> j:g[u]){</span><br><span class="line">        <span class="built_in">dfs</span>(j);</span><br><span class="line">        <span class="keyword">if</span>(ru[j]&gt;=<span class="number">2</span>)f[u]=<span class="built_in">max</span>(f[u],f[j]+<span class="number">1</span>);</span><br><span class="line">    }</span><br><span class="line">    ans=<span class="built_in">max</span>(ans,f[u]);</span><br><span class="line">    <span class="keyword">return</span> f[u];</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="type">signed</span> <span class="title">main</span><span class="params">()</span></span>{</span><br><span class="line">    ios::<span class="built_in">sync_with_stdio</span>(<span class="number">0</span>);</span><br><span class="line">    cin&gt;&gt;n&gt;&gt;m;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=m;i++){</span><br><span class="line">        <span class="type">int</span> a,b;</span><br><span class="line">        cin&gt;&gt;a&gt;&gt;b;</span><br><span class="line">        chu[a]++,ru[b]++;</span><br><span class="line">        g[a].<span class="built_in">push_back</span>(b);</span><br><span class="line">    }</span><br><span class="line">    <span class="comment">//如果我的出度&gt;1则可以出发，如果你的入度&gt;1则可以到达</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;i++)<span class="built_in">dfs</span>(i);</span><br><span class="line">    cout&lt;&lt;ans;</span><br><span class="line">    </span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><hr><p><a href="https://ac.nowcoder.com/acm/contest/19483/F">F-牛牛的猜球游戏_牛客竞赛数据结构专题班前缀和练习题 (nowcoder.com)</a></p><figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N=<span class="number">1e5</span>+<span class="number">10</span>;</span><br><span class="line"><span class="type">int</span> f[N][<span class="number">10</span>],ans[N];</span><br><span class="line"><span class="type">int</span> n,m;</span><br><span class="line"><span class="function"><span class="type">signed</span> <span class="title">main</span><span class="params">()</span></span>{</span><br><span class="line">    ios::<span class="built_in">sync_with_stdio</span>(<span class="number">0</span>);</span><br><span class="line">    cin.<span class="built_in">tie</span>(<span class="number">0</span>);</span><br><span class="line">    cout.<span class="built_in">tie</span>(<span class="number">0</span>);</span><br><span class="line">    cin&gt;&gt;n&gt;&gt;m;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;<span class="number">10</span>;i++)f[<span class="number">0</span>][i]=i;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;i++){</span><br><span class="line">        <span class="type">int</span> l,r;</span><br><span class="line">        cin&gt;&gt;l&gt;&gt;r;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">0</span>;j&lt;<span class="number">10</span>;j++)f[i][j]=f[i<span class="number">-1</span>][j];</span><br><span class="line">        <span class="built_in">swap</span>(f[i][l],f[i][r]);</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">while</span>(m--){</span><br><span class="line">        <span class="type">int</span> l,r;</span><br><span class="line">        cin&gt;&gt;l&gt;&gt;r;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;<span class="number">10</span>;i++)ans[  f[l<span class="number">-1</span>][i]  ]=i;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;<span class="number">10</span>;i++)cout&lt;&lt;ans[  f[r][i]  ]&lt;&lt;<span class="string">" "</span>;</span><br><span class="line">        cout&lt;&lt;<span class="string">'\n'</span>;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>]]></content>
      
      
      <categories>
          
          <category> 算法 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 前缀和 </tag>
            
            <tag> 贪心 </tag>
            
            <tag> 状态压缩 </tag>
            
            <tag> 思维 </tag>
            
            <tag> 树状数组 </tag>
            
            <tag> 树形dp </tag>
            
            <tag> 混合背包 </tag>
            
            <tag> 分组背包 </tag>
            
            <tag> 分层图 </tag>
            
            <tag> 组合数学 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>acm工作分配</title>
      <link href="/2022/05/02/acm-gong-zuo-fen-pei/"/>
      <url>/2022/05/02/acm-gong-zuo-fen-pei/</url>
      
        <content type="html"><![CDATA[<h2 id="xcpc"><a href="#xcpc" class="headerlink" title="xcpc"></a>xcpc</h2><p>下半年我们大三的时候是最后一届了</p><p>无论有没有拿牌都会退役，</p><p>考研的考研，实习的实习，</p><p>所以希望我们现役的时候要好好备战，</p><p>区域赛名额打一次少一次，</p><p>明年名额不会像今年一样那么多的，</p><p>在几个重要的时间节点要打出好成绩</p><h2 id="时间点-x2F-日程"><a href="#时间点-x2F-日程" class="headerlink" title="时间点/日程"></a>时间点/日程</h2><p>下面是几个重要的节点：</p><p>6-7月份 校赛 （听说好像不会举办）</p><p>暑假 多校联赛（一定要好好打！！！）</p><p>ICPC比赛日程（2022年应该会差不太多，都是这个时间段）<br>北京 西北工业大学（牛客，邀请赛）11月21-22日<br>上海 上海大学 12月12-13日<br>南京 南京航空航天大学 12月19-20日<br>济南 齐鲁工业大学 12月26-27日<br>沈阳 东北大学 2021年7月17日<br>昆明 昆明理工大学 2021年4月3日<br>银川 宁夏理工学院 2021年5月16日</p><p>CCPC比赛日程（2022年应该会差不太多，都是这个时间段）<br>网络赛 9月20日 12：00-17：00，HDOJ<br>秦皇岛站 10月17-18日 东北大学秦皇岛分校<br>威海站 10月24-25日 哈尔滨工业大学（威海）<br>绵阳站 10月30日-11月1日 西南科技大学<br>长春站 11月7-8日 长春理工大学<br>总决赛 北京 北京邮电大学</p><h2 id="分工，每个人负责的part"><a href="#分工，每个人负责的part" class="headerlink" title="分工，每个人负责的part"></a>分工，每个人负责的part</h2><p>按照专题分工合作：</p><p>动态规划：胡耀文 沈金辉 陈沛桐</p><p>数据结构：胡耀文</p><p>图论：陈沛桐 胡耀文</p><p>数学：沈金辉 胡耀文</p><p>搜索：陈沛桐 胡耀文 沈金辉</p><p>网络流：胡耀文</p><p>字符串：沈金辉 陈沛桐（重点）</p><p>计算几何：胡耀文</p><p>博弈论：沈金辉 胡耀文</p><p>有几个比较特殊的专题单拎出来了</p><p>三个名字表示全部都要刷都要补这个专题</p><p>名字先后顺序表示主要是你来写和次要让我来写</p><h2 id="安排"><a href="#安排" class="headerlink" title="安排"></a>安排</h2><h3 id="1-acwing"><a href="#1-acwing" class="headerlink" title="1.acwing"></a>1.acwing</h3><p><a href="https://www.acwing.com/">AcWing</a></p><p>可以补知识点，要把相应的打卡题全部做完</p><h2 id="2-luogu"><a href="#2-luogu" class="headerlink" title="2.luogu"></a>2.luogu</h2><p><a href="https://www.luogu.com.cn/training/9391">能力全面提升综合题单 - 题单 - 洛谷 | 计算机科学教育新生态 (luogu.com.cn)</a></p><p>综合能力提升题单自己负责的部分要刷完</p><p>如果有时间的话，luogu除了这个题单还有别的题单，对自己的part掌握的不足的话可以去专精</p><h2 id="3-牛客"><a href="#3-牛客" class="headerlink" title="3.牛客"></a>3.牛客</h2><p><a href="https://ac.nowcoder.com/discuss/460570">(2条未读通知) 【竞赛课程】牛客竞赛课程汇总贴_ACM竞赛_ACM/CSP/ICPC/CCPC/比赛经验/题解/资讯_牛客竞赛OJ_牛客网 (nowcoder.com)</a></p><p>往届有很多专题的重现赛，比如</p><p>自己的专题一个一个来，不求广度要求深度，可以去补</p><h2 id="4-cf"><a href="#4-cf" class="headerlink" title="4.cf"></a>4.cf</h2><p>cf的每一场都尽量去打，这是真的，因为就算你刷完了123，你不把4搞好也打不出成绩</p><h2 id="5-算法进阶指南"><a href="#5-算法进阶指南" class="headerlink" title="5.算法进阶指南"></a>5.算法进阶指南</h2><p>对应部分刷完</p>]]></content>
      
      
      <categories>
          
          <category> 规划 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ICPC </tag>
            
            <tag> CCPC </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>4月30号训练任务</title>
      <link href="/2022/04/30/4-yue-30-hao-xun-lian-ren-wu/"/>
      <url>/2022/04/30/4-yue-30-hao-xun-lian-ren-wu/</url>
      
        <content type="html"><![CDATA[<p>4月30号训练</p><p>7：00点起床<br>7：30开始CCF-CSP第一套</p><p><a href="http://118.190.20.162/home.page">首页 - 计算机软件能力认证考试系统</a></p><p><img src="C:/Users/Lenovo/AppData/Roaming/Typora/typora-user-images/image-20220429224116809.png" alt="image-20220429224116809"></p><p>写3个小时，第四个小时补题写题解报告以便后面交到学者网算法设计作业上</p><p>12：00牛客五一集训派对day1</p><p><a href="https://ac.nowcoder.com/acm/contest/33549">https://ac.nowcoder.com/acm/contest/33549</a></p><p>打三个小时，后一个小时搜题解补题</p><p>下午六点开始 刷第二套CCF-CSP</p><p>晚上七点的时候跑去打acwing周赛</p><p><a href="https://www.acwing.com/activity/content/1740/">竞赛 - AcWing</a></p><p>打30分钟补题跑路</p><p><img src="C:/Users/Lenovo/AppData/Roaming/Typora/typora-user-images/image-20220429224625290.png" alt="image-20220429224625290"></p><p>晚上10点半leetcode第77场双周赛</p><p><a href="https://leetcode-cn.com/contest/">全球竞赛 - 力扣 (LeetCode) 全球极客挚爱的技术成长平台 (leetcode-cn.com)</a></p><p>打20分钟跑路</p><p>比赛名称：Codeforces Round #785 (Div. 2)<br>比赛时间：2022-04-30 22:35:00<br>比赛链接：<a href="https://codeforces.com/contest/1673">https://codeforces.com/contest/1673</a></p><p>腾讯会议开黑联系</p>]]></content>
      
      
      <categories>
          
          <category> 规划 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 训练 </tag>
            
            <tag> csp </tag>
            
            <tag> acwing </tag>
            
            <tag> leetcode </tag>
            
            <tag> 牛客 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>2022天梯赛</title>
      <link href="/2022/04/27/2022-tian-ti-sai/"/>
      <url>/2022/04/27/2022-tian-ti-sai/</url>
      
        <content type="html"><![CDATA[<h1 id="2022天梯赛"><a href="#2022天梯赛" class="headerlink" title="2022天梯赛"></a>2022天梯赛</h1><h1 id="L1"><a href="#L1" class="headerlink" title="L1"></a>L1</h1><p>L1的题目冲的非常快，就败在了L2-1的模拟题，主要是种种原因后面心态炸了</p><h2 id="L1-7"><a href="#L1-7" class="headerlink" title="L1-7"></a>L1-7</h2><p>赛场上我用容斥写的<br>但是听说下面这种解法更简便</p><figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">int</span> visn[<span class="number">100010</span>],vism[<span class="number">100010</span>];</span><br><span class="line"><span class="meta">#<span class="keyword">define</span> int long long</span></span><br><span class="line"><span class="type">int</span> n,m,k,op,x;</span><br><span class="line"><span class="function"><span class="type">signed</span> <span class="title">main</span><span class="params">()</span></span>{</span><br><span class="line">    cin&gt;&gt;n&gt;&gt;m&gt;&gt;k;</span><br><span class="line">    <span class="keyword">while</span>(k--){</span><br><span class="line">        cin&gt;&gt;op&gt;&gt;x;</span><br><span class="line">        <span class="keyword">if</span>(op==<span class="number">0</span>)</span><br><span class="line">            <span class="keyword">if</span>(!visn[x])n--,visn[x]=<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span>(op==<span class="number">1</span>)</span><br><span class="line">            <span class="keyword">if</span>(!vism[x])m--,vism[x]=<span class="number">1</span>;</span><br><span class="line">    }</span><br><span class="line">    cout&lt;&lt;n*m;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><hr><h2 id="L1-8"><a href="#L1-8" class="headerlink" title="L1-8"></a>L1-8</h2><p>对权值进行维护就好了</p><h2 id="L2-1"><a href="#L2-1" class="headerlink" title="L2-1"></a>L2-1</h2><p>天梯赛就三个小时占了我<br>这个一个半小时的题目，我觉得写不出来一是基础不扎实，二就是当时心态炸了，后面根本没心思调</p><figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N=<span class="number">1e3</span>+<span class="number">10</span>;</span><br><span class="line">queue&lt;<span class="type">int</span>&gt;q;</span><br><span class="line">stack&lt;<span class="type">int</span>&gt;stk;</span><br><span class="line"><span class="type">int</span> n,m,k;</span><br><span class="line">vector&lt;vector&lt;<span class="type">int</span>&gt;&gt;ans;</span><br><span class="line"><span class="function"><span class="type">signed</span> <span class="title">main</span><span class="params">()</span></span>{</span><br><span class="line">    ios::<span class="built_in">sync_with_stdio</span>(<span class="number">0</span>);</span><br><span class="line">    cin.<span class="built_in">tie</span>(<span class="number">0</span>);</span><br><span class="line">    cout.<span class="built_in">tie</span>(<span class="number">0</span>);</span><br><span class="line">    cin&gt;&gt;n&gt;&gt;m&gt;&gt;k;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;i++){</span><br><span class="line">        <span class="type">int</span> x;</span><br><span class="line">        cin&gt;&gt;x;</span><br><span class="line">        q.<span class="built_in">push</span>(x);</span><br><span class="line">    }</span><br><span class="line">    vector&lt;<span class="type">int</span>&gt;t;</span><br><span class="line">    <span class="type">int</span> cnt=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span>(q.<span class="built_in">size</span>()||stk.<span class="built_in">size</span>()){</span><br><span class="line"><span class="comment">//         cout&lt;&lt;"cnt="&lt;&lt;cnt&lt;&lt;endl;</span></span><br><span class="line">        <span class="comment">//if(++cnt&gt;20)break;</span></span><br><span class="line">        <span class="keyword">if</span>(stk.<span class="built_in">empty</span>()&amp;&amp;q.<span class="built_in">size</span>()){</span><br><span class="line">            <span class="type">int</span> x=q.<span class="built_in">front</span>();</span><br><span class="line">            <span class="comment">//cout&lt;&lt;"x="&lt;&lt;x&lt;&lt;endl;</span></span><br><span class="line">            <span class="keyword">if</span>(t.<span class="built_in">size</span>()==<span class="number">0</span>)t.<span class="built_in">push_back</span>(x),q.<span class="built_in">pop</span>();</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span>(x&lt;=t.<span class="built_in">back</span>())t.<span class="built_in">push_back</span>(x),q.<span class="built_in">pop</span>();</span><br><span class="line">            <span class="keyword">else</span> stk.<span class="built_in">push</span>(x),q.<span class="built_in">pop</span>();</span><br><span class="line">            <span class="keyword">if</span>(t.<span class="built_in">size</span>()==k)ans.<span class="built_in">push_back</span>(t),t.<span class="built_in">clear</span>();</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">else</span>{</span><br><span class="line">            <span class="comment">//如果栈符合要求就塞进去</span></span><br><span class="line">            <span class="type">int</span> x;</span><br><span class="line">            x=stk.<span class="built_in">top</span>();</span><br><span class="line">            <span class="comment">//cout&lt;&lt;"x="&lt;&lt;x&lt;&lt;endl;</span></span><br><span class="line">            <span class="keyword">if</span>(t.<span class="built_in">size</span>()==<span class="number">0</span>)t.<span class="built_in">push_back</span>(x),stk.<span class="built_in">pop</span>();</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span>(x&lt;=t.<span class="built_in">back</span>())t.<span class="built_in">push_back</span>(x),stk.<span class="built_in">pop</span>();</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span>(q.<span class="built_in">size</span>()){</span><br><span class="line">                <span class="comment">//说明栈不能放</span></span><br><span class="line">                <span class="comment">//从队列里面找</span></span><br><span class="line">                x=q.<span class="built_in">front</span>();</span><br><span class="line">                <span class="comment">//cout&lt;&lt;"x="&lt;&lt;x&lt;&lt;endl;</span></span><br><span class="line">                <span class="keyword">if</span>(x&lt;=t.<span class="built_in">back</span>())t.<span class="built_in">push_back</span>(x),q.<span class="built_in">pop</span>();</span><br><span class="line">                <span class="keyword">else</span> <span class="keyword">if</span>(stk.<span class="built_in">size</span>()&lt;m)stk.<span class="built_in">push</span>(x),q.<span class="built_in">pop</span>();</span><br><span class="line">                <span class="keyword">else</span> ans.<span class="built_in">push_back</span>(t),t.<span class="built_in">clear</span>();</span><br><span class="line">            }</span><br><span class="line">            <span class="keyword">else</span> ans.<span class="built_in">push_back</span>(t),t.<span class="built_in">clear</span>();</span><br><span class="line">            <span class="keyword">if</span>(t.<span class="built_in">size</span>()==k)ans.<span class="built_in">push_back</span>(t),t.<span class="built_in">clear</span>();</span><br><span class="line">            </span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">if</span>(t.<span class="built_in">size</span>())ans.<span class="built_in">push_back</span>(t);</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">auto</span> t:ans){</span><br><span class="line">        cout&lt;&lt;t[<span class="number">0</span>];</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;t.<span class="built_in">size</span>();i++)cout&lt;&lt;<span class="string">" "</span>&lt;&lt;t[i];</span><br><span class="line">        cout&lt;&lt;<span class="string">'\n'</span>;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><hr><h2 id="L2-2"><a href="#L2-2" class="headerlink" title="L2-2"></a>L2-2</h2><p>垃圾题<br>傻逼题</p><figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">int</span> n;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">node</span>{</span><br><span class="line">    <span class="type">int</span> h,m,s,hh,mm,ss;</span><br><span class="line">    <span class="type">bool</span> <span class="keyword">operator</span>&lt;(<span class="type">const</span> node&amp;t){</span><br><span class="line">        <span class="keyword">if</span>(h!=t.h)<span class="keyword">return</span> h&lt;t.h;</span><br><span class="line">        <span class="keyword">if</span>(m!=t.m)<span class="keyword">return</span> m&lt;t.m;</span><br><span class="line">        <span class="keyword">return</span> s&lt;t.s;</span><br><span class="line">    }</span><br><span class="line">}a[<span class="number">100010</span>];</span><br><span class="line"><span class="function"><span class="type">signed</span> <span class="title">main</span><span class="params">()</span></span>{</span><br><span class="line">    cin&gt;&gt;n;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;i++){</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">"%d:%d:%d - %d:%d:%d"</span>,&amp;a[i].h,&amp;a[i].m,&amp;a[i].s,&amp;a[i].hh,&amp;a[i].mm,&amp;a[i].ss);</span><br><span class="line">    }</span><br><span class="line">    <span class="built_in">sort</span>(a+<span class="number">1</span>,a+<span class="number">1</span>+n);</span><br><span class="line">    <span class="type">int</span> ph=<span class="number">0</span>,pm=<span class="number">0</span>,ps=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;i++){</span><br><span class="line">        <span class="type">int</span> h=a[i].h,m=a[i].m,s=a[i].s,hh=a[i].hh,mm=a[i].mm,ss=a[i].ss;</span><br><span class="line">        <span class="keyword">if</span>(ph==h&amp;&amp;pm==m&amp;&amp;ps==s);<span class="comment">//printf("%02d:%02d:%02d - %02d:%02d:%02d\n",a[i].h,a[i].m,a[i].s,a[i].hh,a[i].mm,a[i].ss);</span></span><br><span class="line">        <span class="keyword">else</span> <span class="built_in">printf</span>(<span class="string">"%02d:%02d:%02d - %02d:%02d:%02d\n"</span>,ph,pm,ps,a[i].h,a[i].m,a[i].s);</span><br><span class="line">        ph=hh,pm=mm,ps=ss;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">if</span>(ph!=<span class="number">23</span>||pm!=<span class="number">59</span>||ps!=<span class="number">59</span>)<span class="built_in">printf</span>(<span class="string">"%02d:%02d:%02d - %02d:%02d:%02d\n"</span>,ph,pm,ps,<span class="number">23</span>,<span class="number">59</span>,<span class="number">59</span>);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><hr><h2 id="L2-3"><a href="#L2-3" class="headerlink" title="L2-3"></a>L2-3</h2><p>就是个典型的小树形dp，但是赛场上没思路，感觉把时间丢在这道题而不是L2-1的模拟应该可以冲<br>题目要求的是最后不用回来的总代价距离最小值<br>但是对确切的外卖点，往返各一次是确定的，所以很显然预处理到根的距离，剪掉要送外卖的地点集合的最大值就好了</p><figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N=<span class="number">1e5</span>+<span class="number">10</span>;</span><br><span class="line"><span class="meta">#<span class="keyword">define</span> int long long</span></span><br><span class="line">vector&lt;<span class="type">int</span>&gt;g[N];</span><br><span class="line"><span class="type">int</span> vis[N],n,m,fa[N],ans,ma,f[N],x;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">dfs</span><span class="params">(<span class="type">int</span> u)</span></span>{</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">auto</span> j:g[u]){</span><br><span class="line">        f[j]=f[u]+<span class="number">1</span>;</span><br><span class="line">        <span class="built_in">dfs</span>(j);</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">dfs</span><span class="params">(<span class="type">int</span> x,<span class="type">int</span> d)</span></span>{</span><br><span class="line">    <span class="keyword">if</span>(vis[x]){</span><br><span class="line">        ma=<span class="built_in">max</span>(ma,f[x]+d);</span><br><span class="line">        <span class="keyword">return</span> d*<span class="number">2</span>;</span><br><span class="line">    }</span><br><span class="line">    vis[x]=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">dfs</span>(fa[x],d+<span class="number">1</span>);</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="type">signed</span> <span class="title">main</span><span class="params">()</span></span>{</span><br><span class="line">    ios::<span class="built_in">sync_with_stdio</span>(<span class="number">0</span>);</span><br><span class="line">    cin.<span class="built_in">tie</span>(<span class="number">0</span>);</span><br><span class="line">    cout.<span class="built_in">tie</span>(<span class="number">0</span>);</span><br><span class="line">    cin&gt;&gt;n&gt;&gt;m;</span><br><span class="line">    <span class="type">int</span> u;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;i++){</span><br><span class="line">        cin&gt;&gt;fa[i];</span><br><span class="line">        <span class="keyword">if</span>(fa[i]==<span class="number">-1</span>)u=i;</span><br><span class="line">        <span class="keyword">else</span> g[fa[i]].<span class="built_in">push_back</span>(i);</span><br><span class="line">    }</span><br><span class="line">    <span class="built_in">dfs</span>(u);</span><br><span class="line">    vis[u]=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span>(m--){</span><br><span class="line">        cin&gt;&gt;x;</span><br><span class="line">        ans+=<span class="built_in">dfs</span>(x,<span class="number">0</span>);</span><br><span class="line">        <span class="comment">//cout&lt;&lt;"ans="&lt;&lt;ans&lt;&lt;" ma="&lt;&lt;ma&lt;&lt;endl;</span></span><br><span class="line">        cout&lt;&lt;ans-ma&lt;&lt;<span class="string">'\n'</span>;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><hr><h2 id="L2-4"><a href="#L2-4" class="headerlink" title="L2-4"></a>L2-4</h2><p>一样的代码，赛场上超时只有15分，现在一发满分，我tm当时还全删了重写浪费我时间！<br>傻逼东西rnm退钱！</p><figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N=<span class="number">550</span>;</span><br><span class="line"><span class="type">int</span> f[N][N],n,d[N],a[N];</span><br><span class="line"><span class="type">int</span> ans[N];</span><br><span class="line"><span class="function"><span class="type">signed</span> <span class="title">main</span><span class="params">()</span></span>{</span><br><span class="line">    ios::<span class="built_in">sync_with_stdio</span>(<span class="number">0</span>);</span><br><span class="line">    cin.<span class="built_in">tie</span>(<span class="number">0</span>);</span><br><span class="line">    cout.<span class="built_in">tie</span>(<span class="number">0</span>);</span><br><span class="line">    cin&gt;&gt;n;</span><br><span class="line">    <span class="built_in">memset</span>(f,<span class="number">0x3f</span>,<span class="keyword">sizeof</span> f);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;i++){</span><br><span class="line">        <span class="type">char</span> c;</span><br><span class="line">        cin&gt;&gt;c;</span><br><span class="line">        <span class="keyword">if</span>(c==<span class="string">'M'</span>)a[i]=<span class="number">1</span>;</span><br><span class="line">        <span class="type">int</span> m;</span><br><span class="line">        cin&gt;&gt;m;</span><br><span class="line">        <span class="keyword">while</span>(m--){</span><br><span class="line">            <span class="type">int</span> x,y;</span><br><span class="line">            cin&gt;&gt;x&gt;&gt;c&gt;&gt;y;</span><br><span class="line">            f[i][x]=y;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> k=<span class="number">1</span>;k&lt;=n;k++)f[k][k]=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> k=<span class="number">1</span>;k&lt;=n;k++){</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;i++){</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">1</span>;j&lt;=n;j++){</span><br><span class="line">                f[i][j]=<span class="built_in">min</span>(f[i][j],f[i][k]+f[k][j]);</span><br><span class="line">                <span class="comment">//f[j][i]=min(f[j][i],f[j][k]+f[k][i]);</span></span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    vector&lt;<span class="type">int</span>&gt;ans1,ans0;</span><br><span class="line">    <span class="type">int</span> a1=<span class="number">0x3f3f3f3f</span>;</span><br><span class="line">    <span class="type">int</span> a0=<span class="number">0x3f3f3f3f</span>;</span><br><span class="line">    <span class="comment">//memset(ans,0x3f,sizeof ans);</span></span><br><span class="line">    <span class="comment">//求到我的，且为异性的最大值</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;i++){</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">1</span>;j&lt;=n;j++){</span><br><span class="line">            <span class="keyword">if</span>(a[i]!=a[j])ans[j]=<span class="built_in">max</span>(ans[j],f[i][j]);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;i++){</span><br><span class="line">        <span class="keyword">if</span>(a[i])a1=<span class="built_in">min</span>(a1,ans[i]);</span><br><span class="line">        <span class="keyword">else</span> a0=<span class="built_in">min</span>(a0,ans[i]);</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;i++){</span><br><span class="line">        <span class="keyword">if</span>(a[i]&amp;&amp;ans[i]==a1)ans1.<span class="built_in">push_back</span>(i);</span><br><span class="line">        <span class="keyword">if</span>(!a[i]&amp;&amp;ans[i]==a0)ans0.<span class="built_in">push_back</span>(i);</span><br><span class="line">    }</span><br><span class="line">    <span class="built_in">swap</span>(ans1,ans0);</span><br><span class="line">    cout&lt;&lt;ans1[<span class="number">0</span>];</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;ans1.<span class="built_in">size</span>();i++)cout&lt;&lt;<span class="string">" "</span>&lt;&lt;ans1[i];</span><br><span class="line">    cout&lt;&lt;<span class="string">'\n'</span>;</span><br><span class="line">    cout&lt;&lt;ans0[<span class="number">0</span>];</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;ans0.<span class="built_in">size</span>();i++)cout&lt;&lt;<span class="string">" "</span>&lt;&lt;ans0[i];</span><br><span class="line">    </span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><hr><h2 id="L3-1"><a href="#L3-1" class="headerlink" title="L3-1"></a>L3-1</h2><p>比较裸的拓扑排序，根据数字的大小关系建边，如果我比你大，那么你会向我连一条边，我入度加加<br>入度相等的时候用字符串大小来排序，可以用优先队列来处理</p><p>我在打比赛的时候往L3瞄了一下，感觉第一题其实可以做，也对着样例一眼就看出来要纵向判断建边<br>但是“入度相等的时候用字符串大小来排序”，这里我脑抽了，没有想到用优先队列，加上前面的L2还没写完，因为分数没拿够L3不算分<br>所以跑去写L2了，这波属实是拉跨啊我靠，要是顺利切掉L2-1的话能水230分，百分百国二</p><figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line">unordered_map&lt;string,<span class="type">int</span>&gt;mp,d;</span><br><span class="line">string S[<span class="number">100010</span>];</span><br><span class="line">vector&lt;vector&lt;string&gt;&gt;ans;</span><br><span class="line">vector&lt;<span class="type">int</span>&gt;g[<span class="number">10010</span>];</span><br><span class="line"><span class="type">int</span> n,idx;</span><br><span class="line">vector&lt;string&gt;v,res;</span><br><span class="line">string s;</span><br><span class="line">priority_queue&lt;string,vector&lt;string&gt;,greater&lt;string&gt;&gt;q;</span><br><span class="line"><span class="function"><span class="type">signed</span> <span class="title">main</span><span class="params">()</span></span>{</span><br><span class="line">    ios::<span class="built_in">sync_with_stdio</span>(<span class="number">0</span>);</span><br><span class="line">    cin.<span class="built_in">tie</span>(<span class="number">0</span>);</span><br><span class="line">    cout.<span class="built_in">tie</span>(<span class="number">0</span>);</span><br><span class="line">    cin&gt;&gt;n;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;i++){</span><br><span class="line">        cin&gt;&gt;s;</span><br><span class="line">        s+=<span class="string">'.'</span>;</span><br><span class="line">        string t=<span class="string">""</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">auto</span> c:s){</span><br><span class="line">            <span class="keyword">if</span>(c==<span class="string">'.'</span>){</span><br><span class="line">                <span class="keyword">if</span>(!mp.<span class="built_in">count</span>(t))mp[t]=++idx,S[idx]=t;</span><br><span class="line">                v.<span class="built_in">push_back</span>(t),t=<span class="string">""</span>;</span><br><span class="line">            }</span><br><span class="line">            <span class="keyword">else</span> t+=c;</span><br><span class="line">        }</span><br><span class="line">        </span><br><span class="line">        ans.<span class="built_in">push_back</span>(v);</span><br><span class="line">        v.<span class="built_in">clear</span>();</span><br><span class="line">    }</span><br><span class="line"><span class="comment">//     for(auto v:ans){</span></span><br><span class="line"><span class="comment">//         for(auto t:v)cout&lt;&lt;t&lt;&lt;".";</span></span><br><span class="line"><span class="comment">//         cout&lt;&lt;endl;</span></span><br><span class="line"><span class="comment">//     }</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;n;i++){</span><br><span class="line">        <span class="keyword">if</span>(ans[i].<span class="built_in">size</span>()!=ans[i<span class="number">-1</span>].<span class="built_in">size</span>())<span class="keyword">continue</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">0</span>;j&lt;ans[i].<span class="built_in">size</span>();j++){</span><br><span class="line">            <span class="keyword">if</span>(ans[i<span class="number">-1</span>][j]!=ans[i][j]){</span><br><span class="line">                <span class="type">int</span> a=mp[ans[i<span class="number">-1</span>][j]];</span><br><span class="line">                <span class="type">int</span> b=mp[ans[i][j]];</span><br><span class="line">                g[a].<span class="built_in">push_back</span>(b);</span><br><span class="line">                d[ans[i][j]]++;</span><br><span class="line">                <span class="comment">//cout&lt;&lt;"aaa"&lt;&lt;endl;</span></span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"><span class="comment">//     for(int i=1;i&lt;=idx;i++){</span></span><br><span class="line"><span class="comment">//         cout&lt;&lt;S[i]&lt;&lt;": ";</span></span><br><span class="line"><span class="comment">//         for(auto j:g[i])cout&lt;&lt;i&lt;&lt;j&lt;&lt;" ";</span></span><br><span class="line"><span class="comment">//         cout&lt;&lt;endl;</span></span><br><span class="line"><span class="comment">//     }</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">auto</span> &amp;[k,v]:mp){</span><br><span class="line">        <span class="keyword">if</span>(d[k]==<span class="number">0</span>)q.<span class="built_in">push</span>(k);</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">while</span>(q.<span class="built_in">size</span>()){</span><br><span class="line">        string u=q.<span class="built_in">top</span>();</span><br><span class="line">        q.<span class="built_in">pop</span>();</span><br><span class="line">        res.<span class="built_in">push_back</span>(u);</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">auto</span> t:g[mp[u]]){</span><br><span class="line">            <span class="keyword">if</span>(--d[S[t]]==<span class="number">0</span>)q.<span class="built_in">push</span>(S[t]);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    cout&lt;&lt;res[<span class="number">0</span>];</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;res.<span class="built_in">size</span>();i++)cout&lt;&lt;<span class="string">"."</span>&lt;&lt;res[i];</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><hr><p>经典题<br>首先，我们对于这个树上两个结点的关系分为两类，一类是有直接父子或祖先关系的结点对，这样的结点对在DFS序中的顺序是确定的，一定是父亲在前面，儿子在后面，那么这样的结点对，如果是逆序对，一定会出现在每一种DFS序中，所以，这样的逆序对的贡献就是这个树的DFS序的种类数。另外一类就是不具有直接父子或祖先关系的结点对，这样的结点对在每种DFS序中的顺序不固定，但是我们经过观察完全可以发现（我发现不了，杜喻皓大爹说了我才知道 ），这样的结点对要不然是逆序对，要不然不是逆序对，概率都是1/2，那么从期望的角度考虑，这样的结点对对于答案的贡献其实就是这个树的DFS序的种类数除以2</p><p>那么如何求解一颗树的DFS序种类数呢，其实很简单对于一颗子树u，它的DFS序的种类数就是它的所有子树的方案数的乘积，再乘上u的子树个数的全排列（也就是阶乘），然后向上递推就行。第二个问题，如何求解两种点对的数目。首先我们知道，对于n个点能组合出来的总点对数是n*(n-1)/2，那么只要求出其中一类的个数，另外一类就知道了，我们选择求解上述第一类的个数，令 d[i] 表示以 i 为根节点的子树第一类结点对的数目，很容易观察得到，其实就是以 i 为根节点的子树中 i 有多少个孩子or孙子，那么这个自然也可以向上递推。第三个问题，如何计算第一类结点对中逆序对的个数，我们令 mx[i] 表示从结点 i 出发往上遍历直到根节点，有多少个比它大的结点数，这个在DFS的过程中在值域上建立树状数组就可以统计。</p><h2 id="L3-2"><a href="#L3-2" class="headerlink" title="L3-2"></a>L3-2</h2><figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="keyword">define</span> int long long</span></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N=<span class="number">1e6</span>+<span class="number">10</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> mod=<span class="number">1e9</span>+<span class="number">7</span>;</span><br><span class="line"><span class="type">int</span> n,root,tr[N],fac[N],A,B,K,son[N],f[N],mx[N],ans,d[N];</span><br><span class="line">vector&lt;<span class="type">int</span>&gt;g[N];</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">add</span><span class="params">(<span class="type">int</span> x,<span class="type">int</span> c)</span></span>{</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=x;i&lt;=n;i+=i&amp;-i)tr[i]+=c;</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">sum</span><span class="params">(<span class="type">int</span> x)</span></span>{</span><br><span class="line">    <span class="type">int</span> ans=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=x;i;i-=i&amp;-i)ans+=tr[i];</span><br><span class="line">    <span class="keyword">return</span> ans;</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">qpow</span><span class="params">(<span class="type">int</span> a,<span class="type">int</span> b)</span></span>{</span><br><span class="line">    <span class="type">int</span> ans=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span>(b){</span><br><span class="line">        <span class="keyword">if</span>(b&amp;<span class="number">1</span>)ans=(ans*a)%mod;</span><br><span class="line">        b/=<span class="number">2</span>;</span><br><span class="line">        a=(a*a)%mod;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> ans;</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">dfs</span><span class="params">(<span class="type">int</span> u,<span class="type">int</span> fa)</span></span>{</span><br><span class="line">    mx[u]=<span class="built_in">sum</span>(n)-<span class="built_in">sum</span>(u);</span><br><span class="line">    <span class="built_in">add</span>(u,<span class="number">1</span>);</span><br><span class="line">    f[u]=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">auto</span> j:g[u]){</span><br><span class="line">        <span class="keyword">if</span>(j==fa)<span class="keyword">continue</span>;</span><br><span class="line">        son[u]++;</span><br><span class="line">        <span class="built_in">dfs</span>(j,u);</span><br><span class="line">        f[u]=(f[u]*f[j])%mod;</span><br><span class="line">        d[u]+=d[j];</span><br><span class="line">    }</span><br><span class="line">    d[u]+=son[u];</span><br><span class="line">    f[u]=f[u]*fac[son[u]]%mod;</span><br><span class="line">    <span class="built_in">add</span>(u,<span class="number">-1</span>);</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="type">signed</span> <span class="title">main</span><span class="params">()</span></span>{</span><br><span class="line">    ios::<span class="built_in">sync_with_stdio</span>(<span class="number">0</span>);</span><br><span class="line">    cin.<span class="built_in">tie</span>(<span class="number">0</span>);</span><br><span class="line">    cout.<span class="built_in">tie</span>(<span class="number">0</span>);</span><br><span class="line">    cin&gt;&gt;n&gt;&gt;root;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;n;i++){</span><br><span class="line">        <span class="type">int</span> a,b;</span><br><span class="line">        cin&gt;&gt;a&gt;&gt;b;</span><br><span class="line">        g[a].<span class="built_in">push_back</span>(b);</span><br><span class="line">        g[b].<span class="built_in">push_back</span>(a);</span><br><span class="line">    }</span><br><span class="line">    fac[<span class="number">0</span>]=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;i++)fac[i]=fac[i<span class="number">-1</span>]*i%mod;</span><br><span class="line">    <span class="built_in">dfs</span>(root,<span class="number">-1</span>);</span><br><span class="line">    K=f[root];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//计算第一类节点对的贡献</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;i++)ans=(ans+mx[i]*K%mod)%mod;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//计算第二类节点对的贡献</span></span><br><span class="line">    <span class="type">int</span> t=n*(n<span class="number">-1</span>)%mod*<span class="built_in">qpow</span>(<span class="number">2</span>,mod<span class="number">-2</span>)%mod;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;i++)A=(A+d[i])%mod;</span><br><span class="line">    B=(t-A+mod)%mod;</span><br><span class="line">    B=(B*<span class="built_in">qpow</span>(<span class="number">2</span>,mod<span class="number">-2</span>)%mod)%mod;</span><br><span class="line">    ans=(ans+B*K%mod)%mod;</span><br><span class="line">    </span><br><span class="line">    cout&lt;&lt;ans;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>csoj还几乎有道原题<a href="http://csoj.scnu.edu.cn/problem/S0227">传送门</a><br>求期望的话不要计算dfs序种类数，删去取模操作</p><figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="keyword">define</span> int long long</span></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N=<span class="number">1e6</span>+<span class="number">10</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> mod=<span class="number">1e9</span>+<span class="number">7</span>;</span><br><span class="line"><span class="type">int</span> n,root,tr[N],fac[N],son[N],f[N],mx[N],d[N];</span><br><span class="line"><span class="type">double</span> A,B,K,ans;</span><br><span class="line">vector&lt;<span class="type">int</span>&gt;g[N];</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">add</span><span class="params">(<span class="type">int</span> x,<span class="type">int</span> c)</span></span>{</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=x;i&lt;=n;i+=i&amp;-i)tr[i]+=c;</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">sum</span><span class="params">(<span class="type">int</span> x)</span></span>{</span><br><span class="line">    <span class="type">int</span> ans=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=x;i;i-=i&amp;-i)ans+=tr[i];</span><br><span class="line">    <span class="keyword">return</span> ans;</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">qpow</span><span class="params">(<span class="type">int</span> a,<span class="type">int</span> b)</span></span>{</span><br><span class="line">    <span class="type">int</span> ans=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span>(b){</span><br><span class="line">        <span class="keyword">if</span>(b&amp;<span class="number">1</span>)ans=(ans*a)%mod;</span><br><span class="line">        b/=<span class="number">2</span>;</span><br><span class="line">        a=(a*a)%mod;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> ans;</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">dfs</span><span class="params">(<span class="type">int</span> u,<span class="type">int</span> fa)</span></span>{</span><br><span class="line">    mx[u]=<span class="built_in">sum</span>(n)-<span class="built_in">sum</span>(u);</span><br><span class="line">    <span class="built_in">add</span>(u,<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">auto</span> j:g[u]){</span><br><span class="line">        <span class="keyword">if</span>(j==fa)<span class="keyword">continue</span>;</span><br><span class="line">        son[u]++;</span><br><span class="line">        <span class="built_in">dfs</span>(j,u);</span><br><span class="line">        d[u]+=d[j];</span><br><span class="line">    }</span><br><span class="line">    d[u]+=son[u];</span><br><span class="line">    <span class="built_in">add</span>(u,<span class="number">-1</span>);</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="type">signed</span> <span class="title">main</span><span class="params">()</span></span>{</span><br><span class="line">    ios::<span class="built_in">sync_with_stdio</span>(<span class="number">0</span>);</span><br><span class="line">    cin.<span class="built_in">tie</span>(<span class="number">0</span>);</span><br><span class="line">    cout.<span class="built_in">tie</span>(<span class="number">0</span>);</span><br><span class="line">    cin&gt;&gt;n&gt;&gt;root;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;n;i++){</span><br><span class="line">        <span class="type">int</span> a,b;</span><br><span class="line">        cin&gt;&gt;a&gt;&gt;b;</span><br><span class="line">        g[a].<span class="built_in">push_back</span>(b);</span><br><span class="line">        g[b].<span class="built_in">push_back</span>(a);</span><br><span class="line">    }</span><br><span class="line">    <span class="built_in">dfs</span>(root,<span class="number">-1</span>);</span><br><span class="line">    <span class="comment">//计算第一类节点对的贡献</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;i++)ans+=mx[i];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//计算第二类节点对的贡献</span></span><br><span class="line">    <span class="type">double</span> t=(<span class="type">double</span>)n*(n<span class="number">-1</span>)/<span class="number">2</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;i++)A=(A+d[i]);</span><br><span class="line">    B=(t-A)/<span class="number">2</span>;</span><br><span class="line">    ans+=B;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"%.1lf"</span>,ans);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><hr><h2 id="L3-3"><a href="#L3-3" class="headerlink" title="L3-3"></a>L3-3</h2><figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></tbody></table></figure>]]></content>
      
      
      <categories>
          
          <category> 算法 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 拓扑排序 </tag>
            
            <tag> dfs序 </tag>
            
            <tag> 记忆化搜索 </tag>
            
            <tag> 剪枝 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>BZOJ4621:TC605</title>
      <link href="/2022/02/18/bzoj4621-tc605/"/>
      <url>/2022/02/18/bzoj4621-tc605/</url>
      
        <content type="html"><![CDATA[<p><a href="http://bzoj.noip.space/p/4621.html">题目传送门</a></p><p><a href="https://blog.csdn.net/supreme567/article/details/123011165">【BZOJ4621】Tc605_supreme567的博客-CSDN博客</a></p><h2 id="Description"><a href="#Description" class="headerlink" title="Description"></a>Description</h2><p>最初你有一个长度为 N 的数字序列 A。为了方便起见，序列 A 是一个排列。<br>你可以操作最多 K 次。每一次操作你可以先选定一个 A 的一个子串，然后将这个子串的数字全部变成原来这个子串的最大值。问最终有几种可能的数字序列。答案对 1e9+7 取模。</p><h2 id="Input"><a href="#Input" class="headerlink" title="Input"></a>Input</h2><p>第一行两个数 N 和 K。第二行 N 个数，描述一个排列 A。<br>N,K&lt;=500，</p><h2 id="Output"><a href="#Output" class="headerlink" title="Output"></a>Output</h2><p>输出一个数，表示答案在模域下的值。 </p><h2 id="Sample-Input"><a href="#Sample-Input" class="headerlink" title="Sample Input"></a>Sample Input</h2><p>3 2<br>3 1 2</p><h2 id="Sample-Output"><a href="#Sample-Output" class="headerlink" title="Sample Output"></a>Sample Output</h2><p>4</p><h2 id="思路"><a href="#思路" class="headerlink" title="思路"></a>思路</h2><p>这是一道求区间覆盖方案数的题目<br>首先第一点，要了解相对位置对答案的贡献<br>比如313和331和133是3个不同的状态<br>所谓相对位置就是样例中的312，2相对于1在它的右边，3相对于1和2在它们的左边<br><img src="https://img-blog.csdnimg.cn/25e81da425314d5db5dd3b3bd9ea87cf.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBA6IOhIOiAgOaWhw==,size_20,color_FFFFFF,t_70,g_se,x_16" alt="在这里插入图片描述"><br>我们把每个数字看成一个区间,问题转化为有n个区间覆盖m次求不同结果状态的数量<br>我们可以发现，每个数字的方案数=能覆盖的区间方案数之和<br>即<br>$$<br>f(i)=\sum_{k=l}^{k=r}f(k)<br>$$<br>比如上述就是$f(3)=f(1)+f(1),f(7)=f(3)+f(5)$</p><p>现在我们要考虑如何操作使得答案的统计<strong>不重不漏</strong></p><p>设$f[i][j]表示选择j个区间并且区间要刚好覆盖到第i个数字的方案数$</p><p><img src="https://img-blog.csdnimg.cn/edd95044205045d9997e3c0eee419cc5.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBA6IOhIOiAgOaWhw==,size_20,color_FFFFFF,t_70,g_se,x_16" alt="在这里插入图片描述"><br>把第j次操作的时候，选择的区间要从i-1，i-2，i-3……覆盖到 i<br>于是就有了状态转移方程$f[i][j]=\sum_{k=0}^{k=i-1}f[k][j-1]$<br>但是在最优情况下是不会选单个序列的，也就是说<br>$f[i-1][j-1]对f[i][j]没有意义，我是不会选择这个操作的，也就是说要保持这个状态我只需要j-1次操作$</p><p>前缀和优化<br>代码如下：</p><figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="keyword">define</span> int long long</span></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N=<span class="number">550</span>;</span><br><span class="line"><span class="type">int</span> f[N][N],a[N],n,m;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> mod=<span class="number">1e9</span>+<span class="number">7</span>;</span><br><span class="line"><span class="function"><span class="type">signed</span> <span class="title">main</span><span class="params">()</span></span>{</span><br><span class="line">    ios::<span class="built_in">sync_with_stdio</span>(<span class="number">0</span>);</span><br><span class="line">    cin.<span class="built_in">tie</span>(<span class="number">0</span>);</span><br><span class="line">    cin&gt;&gt;n&gt;&gt;m;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;i++)cin&gt;&gt;a[i];</span><br><span class="line">    f[<span class="number">0</span>][<span class="number">0</span>]=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;i++){</span><br><span class="line">        <span class="type">int</span> l=i,r=i;</span><br><span class="line">        <span class="keyword">while</span>(l&gt;<span class="number">1</span>&amp;&amp;a[i]&gt;a[l<span class="number">-1</span>])l--;</span><br><span class="line">        <span class="keyword">while</span>(r&lt;n&amp;&amp;a[i]&gt;a[r+<span class="number">1</span>])r++;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> j=m;j&gt;=<span class="number">0</span>;j--){</span><br><span class="line">            f[i][j]=(f[i][j]+f[i<span class="number">-1</span>][j])%mod;<span class="comment">//我选了j个区间覆盖到i-1了</span></span><br><span class="line">            <span class="keyword">if</span>(j==<span class="number">0</span>)<span class="keyword">continue</span>;</span><br><span class="line">            <span class="type">int</span> sum=<span class="number">0</span>;</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> k=l;k&lt;=r;k++){</span><br><span class="line">                sum=(sum+f[k<span class="number">-1</span>][j<span class="number">-1</span>])%mod;</span><br><span class="line">                f[k][j]=(f[k][j]+sum)%mod;</span><br><span class="line">            }</span><br><span class="line">            f[i][j]=(f[i][j]-f[i<span class="number">-1</span>][j<span class="number">-1</span>]+mod)%mod;<span class="comment">//减去不符合题意的答案</span></span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="type">int</span> ans=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> j=m;j&gt;=<span class="number">0</span>;j--)ans=(ans+f[n][j])%mod;</span><br><span class="line">    cout&lt;&lt;ans;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>想法：<br>它为什么是收敛的？也就是说随着可选区间数的不断增加它的方案数最终会趋向0？<br>小结：<br>dp牢记</p><ul><li>问题的转化</li><li>dp状态的定义要清晰！</li><li>dp状态的计算要怎样才能不重复不漏掉</li></ul>]]></content>
      
      
      <categories>
          
          <category> 算法 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> dp计数 </tag>
            
            <tag> 难题 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>0初识爬虫</title>
      <link href="/2022/02/08/0-chu-shi-pa-chong/"/>
      <url>/2022/02/08/0-chu-shi-pa-chong/</url>
      
        <content type="html"><![CDATA[<h1 id="0-认识爬虫"><a href="#0-认识爬虫" class="headerlink" title="0 认识爬虫"></a>0 认识爬虫</h1><p><a href="https://blog.csdn.net/supreme567/article/details/122831465">CSDN链接传送门</a></p><h2 id="笔记"><a href="#笔记" class="headerlink" title="笔记"></a>笔记</h2><p>什么是爬虫？<br>爬虫是什么？<br>了解浏览器的工作原理？<br>爬虫能做很多事，能做商业分析，也能做生活助手，比如：分析北京近两年二手房成交均价是多少？深圳的Python工程师平均薪资是多少？北京哪家餐厅粤菜最好吃？等等。<br>这是个人利用爬虫所做到的事情，而公司，同样可以利用爬虫来实现巨大的商业价值。比如你所熟悉的搜索引擎——百度和谷歌，它们的核心技术之一也是爬虫，而且是超级爬虫。<br>爬虫还让这些搜索巨头有机会朝着人工智能的未来迈进，因为人工智能的发展离不开海量的数据。而每天使用这些搜索网站的用户都是数以亿计的，产生的数据自然也是难以计量的。<br><img src="https://img-blog.csdnimg.cn/2fb29fcae457437f8606931be9f0c8d4.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBA6IOhIOiAgOaWhw==,size_20,color_FFFFFF,t_70,g_se,x_16" alt="浏览器的工作原理"></p><p><img src="https://img-blog.csdnimg.cn/b87a5a6fe4fa4481a5523173de2539ad.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBA6IOhIOiAgOaWhw==,size_20,color_FFFFFF,t_70,g_se,x_16" alt="在这里插入图片描述"></p><p>第0步：获取数据。爬虫程序会根据我们提供的网址，向服务器发起请求然后返回数据<br>第1步：解析数据。爬虫程序会把服务器返回的数据解析成我们能读懂的格式。<br>第2步：提取数据。爬虫程序再从中提取出我们需要的数据。<br>第3步：储存数据。爬虫程序把这些有用的数据保存起来，便于你日后的使用和分析。</p><p>requests库可以帮我们下载网页源代码、文本、图片，甚至是音频。其实，“下载”本质上是向服务器发送请求并得到响应。<br>Python是一门面向对象编程的语言，而在爬虫中，理解数据是什么对象是非常、特别、以及极其重要的一件事。因为只有知道了数据是什么对象，我们才知道对象有什么属性和方法可供我们操作。<br><img src="https://img-blog.csdnimg.cn/76ac042c658a44c9b000d1ffdee85db5.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBA6IOhIOiAgOaWhw==,size_20,color_FFFFFF,t_70,g_se,x_16" alt="在这里插入图片描述"><br><img src="https://img-blog.csdnimg.cn/94ca39b8c9fc4e61a4e11ec0ce82be58.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBA6IOhIOiAgOaWhw==,size_20,color_FFFFFF,t_70,g_se,x_16" alt="在这里插入图片描述"><br>解析文本为什么会出现一段乱码呢？<br>事情是这样的：首先，目标数据本身有它的编码类型，<br>获取目标数据后要知道相应的编码类型才能正确解码。<br>编解码要共享同一种编码类型，就像你给我传纸条用的编码方式如果是“拼音”，我收到后就要拼“拼音”来理解语意——若我以为是“英语”，去查英语字典，那必然看不懂你说了什么。</p><p>Python关于requests.exceptions.ProxyError异常的问题<br>把VPN关掉就好了</p><p>服务器其实就是一个超级电脑，拥有这个服务器的公司，对爬虫其实也有明确的态度。<br>通常情况下，服务器不太会在意小爬虫，但是，服务器会拒绝频率很高的大型爬虫和恶意爬虫，因为这会给服务器带来极大的压力或伤害。<br>不过，服务器在通常情况下，对搜索引擎是欢迎的态度（刚刚讲过，谷歌和百度的核心技术之一就是爬虫）。当然，这是有条件的，通常这些条件会写在robots协议里。</p><p>robots协议是互联网爬虫的一项公认的道德规范，它的全称是“网络爬虫排除标准”（robots exclusion protocol），这个协议用来告诉爬虫，哪些页面是可以抓取的，哪些不可以。<br>我们使用robots协议的场景通常是：看到想获取的内容后，检查一下网站是否允许爬取。因此我们只需要能找到、简单读懂robots协议就足够了。<br>域名中会藏着网站的国籍或功能领域等信息，那么.cn，.com，.gov结尾的域名分别代表了什么？<br>来看一个实例：我们截取了一部分淘宝的robots协议 （ <a href="http://www.taobao.com/robots.txt%EF%BC%89%E3%80%82%E5%9C%A8%E6%88%AA%E5%8F%96%E7%9A%84%E9%83%A8%E5%88%86%EF%BC%8C%E5%8F%AF%E4%BB%A5%E7%9C%8B%E5%88%B0%E6%B7%98%E5%AE%9D%E5%AF%B9%E7%99%BE%E5%BA%A6%E5%92%8C%E8%B0%B7%E6%AD%8C%E8%BF%99%E4%B8%A4%E4%B8%AA%E7%88%AC%E8%99%AB%E7%9A%84%E8%AE%BF%E9%97%AE%E8%A7%84%E5%AE%9A%EF%BC%8C%E4%BB%A5%E5%8F%8A%E5%AF%B9%E5%85%B6%E5%AE%83%E7%88%AC%E8%99%AB%E7%9A%84%E8%A7%84%E5%AE%9A%E3%80%82">http://www.taobao.com/robots.txt）。在截取的部分，可以看到淘宝对百度和谷歌这两个爬虫的访问规定，以及对其它爬虫的规定。</a></p><figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">User-agent:  Baiduspiderz # 百度爬虫</span><br><span class="line">Allow:  /article # 允许访问 article </span><br><span class="line">Allow:  /oshtml # 允许访问 oshtml </span><br><span class="line">Allow:  /ershou # 允许访问 ershou </span><br><span class="line">Allow: /$ # 允许访问根目录，即淘宝主页</span><br><span class="line">Disallow:  /product/ # 禁止访问product文件夹下面的所有文件，但是product文件夹本身允许被访问</span><br><span class="line">Disallow:  / # 禁止访问除 Allow 规定页面之外的其他所有页面</span><br><span class="line"></span><br><span class="line">User-Agent:  Googlebot # 谷歌爬虫</span><br><span class="line">Allow:  /article</span><br><span class="line">Allow:  /oshtml</span><br><span class="line">Allow:  /product # 允许访问product文件夹及product文件夹下面的所有文件</span><br><span class="line">Allow:  /spu</span><br><span class="line">Allow:  /dianpu</span><br><span class="line">Allow:  /oversea</span><br><span class="line">Allow:  /list</span><br><span class="line">Allow:  /ershou</span><br><span class="line">Allow: /$</span><br><span class="line">Disallow:  / # 禁止访问除 Allow 规定页面之外的其他所有页面</span><br><span class="line"></span><br><span class="line">…… # 文件太长，省略了对其它爬虫的规定，想看全文的话，点击上面的链接</span><br><span class="line"></span><br><span class="line">User-Agent:  * # 其他爬虫</span><br><span class="line">Disallow:  / # 禁止访问所有页面</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure><p>可以看出robots协议是“分段”的吗？每个段落都含有以下两种字段：一种是User-agent:，另一种是Allow:或Disallow:。<br>User-agent表示的是爬虫类型，上面的示例代码注释了“百度爬虫”和“谷歌爬虫”，我们自己写的爬虫一般要看User-Agent: <em>，</em>指向所有未被明确提及的爬虫。</p><p>Allow代表允许被访问，Disallow代表禁止被访问。字段对应的值都含有路径分隔符/，限制了哪些或哪一层目录的内容是允许或者禁止被访问的。可以对比上述百度爬虫Disallow: /product/和谷歌爬虫Allow: /product的注释行理解一下。<br>比如淘宝禁止其他爬虫访问所有页面，也就是说，我们自己写的爬虫不被欢迎爬取<a href="http://www.taobao.com域名下的任何网页./">www.taobao.com域名下的任何网页。</a><br>有趣的是，淘宝限制了百度对产品页面的爬虫，却允许谷歌访问。</p><p>所以，当你在百度搜索“淘宝网”时，会看到下图的这两行小字。</p><p><img src="https://img-blog.csdnimg.cn/6c805722d9924f498f69f8a3bc6a1785.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBA6IOhIOiAgOaWhw==,size_20,color_FFFFFF,t_70,g_se,x_16" alt="在这里插入图片描述"></p><p>因为百度很好地遵守了淘宝网的robots.txt协议，自然，你在百度中也查不到淘宝网的具体商品信息了。</p><p>互联网并非法外之地，和爬虫相关的法律也在建立和完善之中，目前通用的伦理规范就是robots协议，我们在爬取网络中的信息时，应该有意识地去遵守这个协议。</p><p>网站的服务器被爬虫爬得多了，也会受到较大的压力，因此，各大网站也会做一些反爬虫的措施。不过呢，有反爬虫，也就有相应的反反爬虫</p><p>爬虫就像是核技术，人们可以利用它去做有用的事，也能利用它去搞破坏。</p><p>恶意消耗别人的服务器资源，是一件不道德的事，恶意爬取一些不被允许的数据，还可能会引起严重的法律后果。</p><p>工具在你手中，如何利用它是你的选择。当你在爬取网站数据的时候，别忘了先看看网站的robots协议是否允许你去爬取。</p><p>同时，限制好爬虫的速度，对提供数据的服务器心存感谢，避免给它造成太大压力，维持良好的互联网秩序，也是我们该做的事。</p><h2 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h2><figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line">from requests.<span class="function">exceptions <span class="keyword">import</span> RequestException</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">def <span class="title">get_one_page</span><span class="params">(url)</span>:</span></span><br><span class="line"><span class="function">    headers =</span> {<span class="string">"user-agent"</span>: <span class="string">"Mizilla/5.0"</span>}</span><br><span class="line">    response = requests.<span class="built_in">get</span>(url,headers=headers)</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">if</span> response.status_code == <span class="number">200</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">"请求成功"</span>)</span><br><span class="line">            <span class="keyword">return</span> response</span><br><span class="line">        elif response.status_code == <span class="number">100</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">"继续提出请求"</span>)</span><br><span class="line">            <span class="keyword">return</span> None</span><br><span class="line">        elif response.status_code == <span class="number">305</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">"应使用代理访问"</span>)</span><br><span class="line">            <span class="keyword">return</span> None</span><br><span class="line">        elif response.status_code == <span class="number">403</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">"禁止访问"</span>)</span><br><span class="line">            <span class="keyword">return</span> None</span><br><span class="line">        elif response.status_code == <span class="number">503</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">"服务不可用"</span>)</span><br><span class="line">            <span class="keyword">return</span> None</span><br><span class="line"></span><br><span class="line">    except RequestException:</span><br><span class="line">        <span class="keyword">return</span> None</span><br><span class="line"></span><br><span class="line">def <span class="built_in">main</span>():</span><br><span class="line">    url = <span class="string">'https://localprod.pandateacher.com/python-manuscript/crawler-html/sanguo.md'</span></span><br><span class="line">    html = <span class="built_in">get_one_page</span>(url)</span><br><span class="line">    html.encoding = <span class="string">'utf-8'</span></span><br><span class="line">    novel = html.text</span><br><span class="line">    <span class="built_in">print</span>(novel[:<span class="number">100</span>])</span><br><span class="line">    f = <span class="built_in">open</span>(<span class="string">'《三国演义》.txt'</span>,<span class="string">'w'</span>)</span><br><span class="line">    f.<span class="built_in">write</span>(novel)</span><br><span class="line">    f.<span class="built_in">close</span>()</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    <span class="built_in">main</span>()</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure><hr><figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">'https://cdn.jsdelivr.net/gh/hyw200199/Figurebed@master/my_image/安智焕21.jpg'</span></span><br><span class="line"></span><br><span class="line">headers = {<span class="string">"user-agent"</span>: <span class="string">"Mizilla/5.0"</span>}</span><br><span class="line">res = requests.<span class="built_in">get</span>(url,headers=headers)</span><br><span class="line">pic = res.content # 把Reponse对象的内容以二进制数据的形式返回</span><br><span class="line"># 新建了一个文件ppt.jpg，这里的文件没加路径，它会被保存在程序运行的当前目录下。</span><br><span class="line"># 图片内容需要以二进制wb读写。你在学习<span class="built_in">open</span>()函数时接触过它。</span><br><span class="line">photo = <span class="built_in">open</span>(<span class="string">'girl1.jpg'</span>,<span class="string">'wb'</span>)</span><br><span class="line"># 获取pic的二进制内容</span><br><span class="line">photo.<span class="built_in">write</span>(pic)</span><br><span class="line"># 关闭文件</span><br><span class="line">photo.<span class="built_in">close</span>()</span><br></pre></td></tr></tbody></table></figure><hr><p><img src="https://img-blog.csdnimg.cn/img_convert/cfa71f586475cf580ec807e5c91c644a.png" alt="that_show"><img src="/0%E5%88%9D%E8%AF%86%E7%88%AC%E8%99%AB/cfa71f586475cf580ec807e5c91c644a.png" alt="that_show"></p>]]></content>
      
      
      <categories>
          
          <category> 爬虫 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 爬虫 </tag>
            
            <tag> python </tag>
            
            <tag> requests </tag>
            
            <tag> 协议 </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
